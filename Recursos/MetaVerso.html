<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MathVerse IA - A Plataforma Definitiva</title>
    <!-- Dependências Externas -->
    <script src="https://js.puter.com/v2/"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.20.0.min.js" charset="utf-8"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ESTILOS CSS COMPLETOS (Idênticos à versão anterior, garantindo a aparência correta) */
        :root {
            --bg-dark: #141e30; --bg-light: #243b55; --primary-color: #4a90e2; --secondary-color: #e74c3c;
            --text-light: #ecf0f1; --text-dark: #2c3e50; --border-color: #34495e; --bg-main: #f4f7f9;
            --correct-color: #27ae60; --incorrect-color: #c0392b;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg-main); color: var(--text-dark); overflow: hidden; }
        .container { display: flex; height: 100vh; }
        .sidebar { width: 420px; background: linear-gradient(180deg, #2c3e50, var(--bg-dark)); color: var(--text-light); overflow-y: auto; display: flex; flex-direction: column; }
        .sidebar-header { padding: 25px; text-align: center; background: rgba(0,0,0,0.3); border-bottom: 1px solid var(--border-color); position: sticky; top: 0; z-index: 10; }
        .sidebar-header h1 { font-size: 24px; }
        .area-section { border-bottom: 1px solid var(--border-color); }
        .area-header { padding: 15px 20px; cursor: pointer; display: flex; align-items: center; justify-content: space-between; transition: background 0.2s ease; border-left: 4px solid transparent; font-weight: 600; }
        .area-header:hover { background: rgba(74, 144, 226, 0.2); border-left-color: var(--primary-color); }
        .area-header.active { background: var(--primary-color); }
        .topics-list { max-height: 0; overflow: hidden; transition: max-height 0.4s ease-in-out; background: rgba(0,0,0,0.2); }
        .topics-list.active { max-height: 1500px; }
        .topic-item { padding: 12px 20px 12px 60px; cursor: pointer; transition: all 0.2s ease; border-left: 4px solid transparent; font-size: 14px; position: relative; }
        .topic-item::before { content: '›'; position: absolute; left: 40px; }
        .topic-item:hover { background: rgba(255,255,255,0.1); border-left-color: var(--primary-color); }
        .topic-item.selected { background: rgba(74, 144, 226, 0.3); border-left-color: var(--secondary-color); font-weight: bold; }
        .area-icon { width: 25px; margin-right: 15px; text-align: center; }
        .main-content { flex: 1; display: flex; flex-direction: column; position: relative; }
        #welcome-screen { display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100%; text-align: center; padding: 40px; }
        #welcome-screen h2 { font-size: 3em; margin-bottom: 20px; color: var(--text-dark); }
        #welcome-screen p { font-size: 1.2em; max-width: 600px; color: #555; }
        #topic-dashboard { display: none; height: 100%; flex-direction: column; }
        .dashboard-header { padding: 20px 25px; background: white; border-bottom: 1px solid #e0e0e0; box-shadow: 0 2px 5px rgba(0,0,0,0.05); flex-shrink: 0; }
        .dashboard-header h2 { font-size: 1.8em; } .dashboard-header p { color: #777; }
        .topic-tabs { display: flex; background: #e9ecef; padding: 0 25px; border-bottom: 1px solid #ddd; flex-shrink: 0; }
        .tab-button { padding: 15px 20px; cursor: pointer; border: none; background: transparent; font-size: 1em; font-weight: 600; color: #555; position: relative; transition: color 0.2s ease; }
        .tab-button::after { content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 3px; background: var(--primary-color); transform: scaleX(0); transition: transform 0.3s ease; }
        .tab-button.active { color: var(--primary-color); }
        .tab-button.active::after { transform: scaleX(1); }
        .content-pane-container { flex-grow: 1; overflow-y: auto; padding: 30px; position: relative; }
        .topic-content-pane { display: none; animation: fadeIn 0.5s ease; }
        .topic-content-pane.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .loader { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); border: 8px solid #f3f3f3; border-radius: 50%; border-top: 8px solid var(--primary-color); width: 60px; height: 60px; animation: spin 1s linear infinite; display: none; z-index: 20;}
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .content-output { line-height: 1.7; }
        .content-output h3 { margin-top: 20px; margin-bottom: 15px; border-bottom: 2px solid #eee; padding-bottom: 5px; }
        .content-output ul, .content-output ol { margin-left: 20px; margin-bottom: 15px; }
        .content-output code { background: #e9ecef; padding: 2px 5px; border-radius: 4px; font-family: 'Consolas', 'Courier New', monospace; }
        .content-output pre { background: #2d2d2d; color: #f8f8f2; padding: 15px; border-radius: 5px; overflow-x: auto; }
        .content-output blockquote { border-left: 4px solid #ccc; padding-left: 15px; margin: 15px 0; color: #555; font-style: italic; }
        .interactive-tool-container { display: none; }
        .interactive-tool-container.active { display: block; }
        .interactive-tool { background: white; padding: 25px; border-radius: 8px; border: 1px solid #ddd; margin-top: 20px; }
        .interactive-tool h4 { margin-bottom: 20px; }
        .tool-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .tool-group input, .tool-group textarea { width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ccc; font-family: monospace; }
        .btn { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: 600; transition: all 0.2s ease; }
        .btn-primary { background: var(--primary-color); color: white; }
        .tool-output { margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 5px; border: 1px solid #eee; min-height: 50px; font-family: monospace; white-space: pre-wrap; }
        #plot-container { width: 100%; height: 400px; }
        #quiz-container { background: white; padding: 25px; border-radius: 8px; border: 1px solid #ddd; }
        .quiz-question-text { font-size: 1.2em; font-weight: 600; margin-bottom: 20px; }
        .quiz-option { display: block; width: 100%; text-align: left; background: #f8f9fa; border: 2px solid #e9ecef; border-radius: 8px; padding: 15px; margin-bottom: 10px; cursor: pointer; transition: all 0.2s ease; }
        .quiz-option:hover:not([disabled]) { border-color: var(--primary-color); background: #eaf2fb; }
        .quiz-option.correct { border-color: var(--correct-color); background: #e8f8f0; }
        .quiz-option.incorrect { border-color: var(--incorrect-color); background: #fbecec; }
        .quiz-explanation { border-left: 4px solid var(--primary-color); background: #f8f9fa; padding: 15px; margin-top: 20px; display: none; }
        .quiz-results { text-align: center; padding: 20px; }
        #ai-chat-widget { position: fixed; bottom: 20px; right: 20px; width: 350px; max-height: 500px; background: white; border-radius: 10px; box-shadow: 0 5px 20px rgba(0,0,0,0.2); display: flex; flex-direction: column; overflow: hidden; transition: all 0.3s ease; z-index: 1000; }
        #ai-chat-widget.collapsed { max-height: 45px; }
        #ai-chat-header { background: var(--primary-color); color: white; padding: 10px 15px; font-weight: 600; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        #ai-chat-body { padding: 15px; flex-grow: 1; overflow-y: auto; }
        .chat-message { margin-bottom: 15px; display: flex; align-items: flex-start; }
        .chat-message .icon { margin-right: 10px; }
        .chat-message .text { background: #f1f1f1; padding: 10px; border-radius: 8px; max-width: 80%; line-height: 1.4; }
        .chat-message.user { flex-direction: row-reverse; }
        .chat-message.user .text { background: var(--primary-color); color: white; }
        .chat-message.user .icon { margin-left: 10px; margin-right: 0; }
        #ai-chat-form { display: flex; border-top: 1px solid #e0e0e0; padding: 10px; }
        #ai-chat-input { flex-grow: 1; border: 1px solid #ccc; padding: 8px; border-radius: 5px; }
        #ai-chat-send { margin-left: 10px; background: var(--primary-color); color: white; border: none; width: 40px; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <!-- BARRA LATERAL COM A LISTA COMPLETA (AGORA INCLUÍDA) -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h1><i class="fa-solid fa-infinity"></i> MathVerse IA</h1>
                <p>A Plataforma Definitiva</p>
            </div>
            
            <div class="area-section" data-area-id="matematica-elementar"><div class="area-header"><i class="fa-solid fa-calculator area-icon"></i> 1. Matemática Elementar <i class="fa-solid fa-chevron-down"></i></div><div class="topics-list"><div class="topic-item" data-topic="Aritmética">Aritmética</div><div class="topic-item" data-topic="Álgebra Elementar">Álgebra Elementar</div><div class="topic-item" data-topic="Geometria Elementar">Geometria Elementar</div><div class="topic-item" data-topic="Estatística Elementar">Estatística Elementar</div><div class="topic-item" data-topic="Matemática Financeira Básica">Matemática Financeira Básica</div><div class="topic-item" data-topic="Introdução à Lógica">Introdução à Lógica</div><div class="topic-item" data-topic="Matemática Discreta Elementar">Matemática Discreta Elementar</div></div></div>
            <div class="area-section" data-area-id="algebra"><div class="area-header"><i class="fa-solid fa-square-root-variable area-icon"></i> 2. Álgebra <i class="fa-solid fa-chevron-down"></i></div><div class="topics-list"><div class="topic-item" data-topic="Álgebra Linear">Álgebra Linear</div><div class="topic-item" data-topic="Álgebra Abstrata">Álgebra Abstrata</div><div class="topic-item" data-topic="Álgebra Comutativa">Álgebra Comutativa</div><div class="topic-item" data-topic="Álgebra Não-Comutativa">Álgebra Não-Comutativa</div><div class="topic-item" data-topic="Álgebras Universais">Álgebras Universais</div><div class="topic-item" data-topic="Teoria de Lie">Teoria de Lie</div><div class="topic-item" data-topic="Teoria de Operadores">Teoria de Operadores</div><div class="topic-item" data-topic="Teoria das Categorias">Teoria das Categorias</div><div class="topic-item" data-topic="Teoria Homológica">Teoria Homológica</div><div class="topic-item" data-topic="Álgebra Computacional">Álgebra Computacional</div></div></div>
            <div class="area-section" data-area-id="analise"><div class="area-header"><i class="fa-solid fa-chart-line area-icon"></i> 3. Análise <i class="fa-solid fa-chevron-down"></i></div><div class="topics-list"><div class="topic-item" data-topic="Cálculo Diferencial e Integral">Cálculo Diferencial e Integral</div><div class="topic-item" data-topic="Análise Real">Análise Real</div><div class="topic-item" data-topic="Análise Complexa">Análise Complexa</div><div class="topic-item" data-topic="Análise Funcional">Análise Funcional</div><div class="topic-item" data-topic="Análise Harmônica">Análise Harmônica</div><div class="topic-item" data-topic="Análise Não-Linear">Análise Não-Linear</div><div class="topic-item" data-topic="Cálculo Variacional">Cálculo Variacional</div><div class="topic-item" data-topic="Análise Numérica">Análise Numérica</div><div class="topic-item" data-topic="Análise Estocástica">Análise Estocástica</div></div></div>
            <div class="area-section" data-area-id="geometria"><div class="area-header"><i class="fa-solid fa-draw-polygon area-icon"></i> 4. Geometria <i class="fa-solid fa-chevron-down"></i></div><div class="topics-list"><div class="topic-item" data-topic="Geometria Euclidiana">Geometria Euclidiana</div><div class="topic-item" data-topic="Geometria Não-Euclidiana">Geometria Não-Euclidiana</div><div class="topic-item" data-topic="Geometria Diferencial">Geometria Diferencial</div><div class="topic-item" data-topic="Geometria Algébrica">Geometria Algébrica</div><div class="topic-item" data-topic="Geometria Riemanniana">Geometria Riemanniana</div><div class="topic-item" data-topic="Geometria Simplética">Geometria Simplética</div><div class="topic-item" data-topic="Geometria Computacional">Geometria Computacional</div><div class="topic-item" data-topic="Geometria Fractal">Geometria Fractal</div><div class="topic-item" data-topic="Geometria de Informação">Geometria de Informação</div></div></div>
            <div class="area-section" data-area-id="topologia"><div class="area-header"><i class="fa-solid fa-mug-hot area-icon"></i> 5. Topologia <i class="fa-solid fa-chevron-down"></i></div><div class="topics-list"><div class="topic-item" data-topic="Topologia Geral">Topologia Geral</div><div class="topic-item" data-topic="Topologia Algébrica">Topologia Algébrica</div><div class="topic-item" data-topic="Topologia Diferencial">Topologia Diferencial</div><div class="topic-item" data-topic="Topologia Geométrica e Teoria dos Nós">Topologia Geométrica e Teoria dos Nós</div><div class="topic-item" data-topic="Análise Topológica de Dados">Análise Topológica de Dados</div></div></div>
            <div class="area-section" data-area-id="prob-estatistica"><div class="area-header"><i class="fa-solid fa-dice area-icon"></i> 6. Probabilidade e Estatística <i class="fa-solid fa-chevron-down"></i></div><div class="topics-list"><div class="topic-item" data-topic="Teoria da Probabilidade">Teoria da Probabilidade</div><div class="topic-item" data-topic="Estatística Inferencial">Estatística Inferencial</div><div class="topic-item" data-topic="Estatística Bayesiana">Estatística Bayesiana</div><div class="topic-item" data-topic="Processos Estocásticos">Processos Estocásticos</div><div class="topic-item" data-topic="Estatística Computacional e Machine Learning">Estatística Computacional e Machine Learning</div></div></div>
            <div class="area-section" data-area-id="teoria-numeros"><div class="area-header"><i class="fa-solid fa-hashtag area-icon"></i> 7. Teoria dos Números <i class="fa-solid fa-chevron-down"></i></div><div class="topics-list"><div class="topic-item" data-topic="Teoria Elementar dos Números">Teoria Elementar dos Números</div><div class="topic-item" data-topic="Teoria Analítica dos Números">Teoria Analítica dos Números</div><div class="topic-item" data-topic="Teoria Algébrica dos Números">Teoria Algébrica dos Números</div><div class="topic-item" data-topic="Teoria Computacional dos Números">Teoria Computacional dos Números</div><div class="topic-item" data-topic="Teoria dos Números P-Ádica">Teoria dos Números P-Ádica</div></div></div>
            <div class="area-section" data-area-id="mat-discreta"><div class="area-header"><i class="fa-solid fa-cubes area-icon"></i> 8. Matemática Discreta <i class="fa-solid fa-chevron-down"></i></div><div class="topics-list"><div class="topic-item" data-topic="Combinatória">Combinatória</div><div class="topic-item" data-topic="Teoria dos Grafos">Teoria dos Grafos</div><div class="topic-item" data-topic="Teoria dos Conjuntos">Teoria dos Conjuntos</div><div class="topic-item" data-topic="Teoria da Computação">Teoria da Computação</div><div class="topic-item" data-topic="Teoria de Códigos">Teoria de Códigos</div></div></div>
            <div class="area-section" data-area-id="mat-aplicada"><div class="area-header"><i class="fa-solid fa-gears area-icon"></i> 9. Matemática Aplicada <i class="fa-solid fa-chevron-down"></i></div><div class="topics-list"><div class="topic-item" data-topic="Equações Diferenciais (EDO e EDP)">Equações Diferenciais (EDO e EDP)</div><div class="topic-item" data-topic="Teoria do Controle">Teoria do Controle</div><div class="topic-item" data-topic="Otimização e Pesquisa Operacional">Otimização e Pesquisa Operacional</div><div class="topic-item" data-topic="Teoria dos Jogos">Teoria dos Jogos</div><div class="topic-item" data-topic="Matemática Financeira Avançada">Matemática Financeira Avançada</div><div class="topic-item" data-topic="Teoria da Informação">Teoria da Informação</div></div></div>
            <div class="area-section" data-area-id="interdisciplinar"><div class="area-header"><i class="fa-solid fa-atom area-icon"></i> 10. Matemática Interdisciplinar <i class="fa-solid fa-chevron-down"></i></div><div class="topics-list"><div class="topic-item" data-topic="Física Matemática">Física Matemática</div><div class="topic-item" data-topic="Biomatemática">Biomatemática</div><div class="topic-item" data-topic="Econometria e Finanças Quantitativas">Econometria e Finanças Quantitativas</div><div class="topic-item" data-topic="Matemática da Computação (IA, Visão Comp.)">Matemática da Computação (IA, Visão Comp.)</div><div class="topic-item" data-topic="Matemática em Neurociência">Matemática em Neurociência</div></div></div>
            <div class="area-section" data-area-id="logica-fundamentos"><div class="area-header"><i class="fa-solid fa-book-skull area-icon"></i> 11. Lógica e Fundamentos <i class="fa-solid fa-chevron-down"></i></div><div class="topics-list"><div class="topic-item" data-topic="Teoria dos Conjuntos Axiomática">Teoria dos Conjuntos Axiomática</div><div class="topic-item" data-topic="Teoria da Prova">Teoria da Prova</div><div class="topic-item" data-topic="Teoria da Computabilidade (Recursão)">Teoria da Computabilidade (Recursão)</div><div class="topic-item" data-topic="Teoria dos Modelos">Teoria dos Modelos</div><div class="topic-item" data-topic="Teoria dos Tipos e Homotopia">Teoria dos Tipos e Homotopia</div><div class="topic-item" data-topic="Lógicas Não-Clássicas">Lógicas Não-Clássicas</div></div></div>
            <div class="area-section" data-area-id="historia-filosofia"><div class="area-header"><i class="fa-solid fa-landmark area-icon"></i> 12. História e Filosofia <i class="fa-solid fa-chevron-down"></i></div><div class="topics-list"><div class="topic-item" data-topic="História da Matemática">História da Matemática</div><div class="topic-item" data-topic="Filosofia da Matemática">Filosofia da Matemática</div></div></div>
            <div class="area-section" data-area-id="educacao-mat"><div class="area-header"><i class="fa-solid fa-chalkboard-user area-icon"></i> 13. Educação Matemática <i class="fa-solid fa-chevron-down"></i></div><div class="topics-list"><div class="topic-item" data-topic="Didática da Matemática">Didática da Matemática</div><div class="topic-item" data-topic="Psicologia da Educação Matemática">Psicologia da Educação Matemática</div><div class="topic-item" data-topic="Educação Matemática Crítica">Educação Matemática Crítica</div></div></div>
            <div class="area-section" data-area-id="mat-simbolica"><div class="area-header"><i class="fa-solid fa-pen-ruler area-icon"></i> 14. Matemática Simbólica <i class="fa-solid fa-chevron-down"></i></div><div class="topics-list"><div class="topic-item" data-topic="Álgebras Universais">Álgebras Universais</div><div class="topic-item" data-topic="Teoria de Reescrita">Teoria de Reescrita</div><div class="topic-item" data-topic="Verificação Formal e Provas Assistidas">Verificação Formal e Provas Assistidas</div></div></div>
            <div class="area-section" data-area-id="singularidades"><div class="area-header"><i class="fa-solid fa-burst area-icon"></i> 15. Teoria das Singularidades <i class="fa-solid fa-chevron-down"></i></div><div class="topics-list"><div class="topic-item" data-topic="Pontos Críticos e Bifurcações">Pontos Críticos e Bifurcações</div><div class="topic-item" data-topic="Singularidades em Variedades">Singularidades em Variedades</div></div></div>
            <div class="area-section" data-area-id="emergentes"><div class="area-header"><i class="fa-solid fa-rocket area-icon"></i> 16. Áreas Emergentes <i class="fa-solid fa-chevron-down"></i></div><div class="topics-list"><div class="topic-item" data-topic="Matemática em Computação Quântica">Matemática em Computação Quântica</div><div class="topic-item" data-topic="Matemática em Inteligência Artificial">Matemática em Inteligência Artificial</div><div class="topic-item" data-topic="Matemática em Blockchain e Criptomoedas">Matemática em Blockchain e Criptomoedas</div><div class="topic-item" data-topic="Matemática em Ética de IA">Matemática em Ética de IA</div></div></div>
            <div class="area-section" data-area-id="especiais"><div class="area-header"><i class="fa-solid fa-puzzle-piece area-icon"></i> 17. Disciplinas Especiais <i class="fa-solid fa-chevron-down"></i></div><div class="topics-list"><div class="topic-item" data-topic="Matemática Recreativa">Matemática Recreativa</div><div class="topic-item" data-topic="Teoria das Redes Complexas">Teoria das Redes Complexas</div><div class="topic-item" data-topic="Matemática da Arte e Música">Matemática da Arte e Música</div></div></div>

        </div>

        <!-- Área de Conteúdo Principal -->
        <div class="main-content">
            <div id="welcome-screen">
                <h2>Bem-vindo ao MathVerse IA</h2>
                <p>O portal definitivo para o universo da matemática. Selecione uma área e um tópico na barra lateral para iniciar uma jornada de aprendizado imersiva, guiada por uma Inteligência Artificial especialista.</p>
                <i class="fa-solid fa-atom fa-spin" style="font-size: 5em; margin-top: 40px; color: var(--primary-color); --fa-animation-duration: 15s;"></i>
            </div>
            <div id="topic-dashboard">
                <div class="dashboard-header">
                    <h2 id="dashboard-title"></h2><p id="dashboard-subtitle"></p>
                </div>
                <nav class="topic-tabs">
                    <button class="tab-button active" data-tab="overview">Visão Geral</button>
                    <button class="tab-button" data-tab="theory">Teoria</button>
                    <button class="tab-button" data-tab="examples">Exemplos</button>
                    <button class="tab-button" data-tab="applications">Aplicações</button>
                    <button class="tab-button" data-tab="tools">Ferramentas</button>
                    <button class="tab-button" data-tab="practice">Praticar</button>
                </nav>
                <div class="content-pane-container">
                    <div class="loader" id="content-loader"></div>
                    <div id="pane-overview" class="topic-content-pane active content-output"></div>
                    <div id="pane-theory" class="topic-content-pane content-output"></div>
                    <div id="pane-examples" class="topic-content-pane content-output"></div>
                    <div id="pane-applications" class="topic-content-pane content-output"></div>
                    <div id="pane-tools" class="topic-content-pane">
                        <div id="tool-analise" class="interactive-tool-container"><div class="interactive-tool"><h4>Plotador de Funções</h4><div class="tool-group"><label for="function-input">Função f(x):</label><input type="text" id="function-input" value="sin(x) * x"></div><button class="btn btn-primary" id="btn-plot-function">Plotar Gráfico</button><div id="plot-container" class="tool-output"></div></div></div>
                        <div id="tool-algebra" class="interactive-tool-container"><div class="interactive-tool"><h4>Calculadora de Matrizes</h4><div class="tool-grid"><div class="tool-group"><label>Matriz A (formato JSON)</label><textarea id="matrix-input-a">[[1, 2], [3, 4]]</textarea></div><div class="tool-group"><label>Matriz B (formato JSON)</label><textarea id="matrix-input-b">[[5, 6], [7, 8]]</textarea></div></div><button class="btn btn-primary" id="btn-matrix-sum">A + B</button><button class="btn btn-primary" id="btn-matrix-prod">A * B</button><div id="matrix-output" class="tool-output">Resultado...</div></div></div>
                        <div id="tool-default" class="interactive-tool-container"><div class="interactive-tool"><h4>Ferramenta Indisponível</h4><p>Ainda não há uma ferramenta interativa específica para este tópico. Peça ao nosso Tutor IA para simular um cálculo para você!</p></div></div>
                    </div>
                    <div id="pane-practice" class="topic-content-pane"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- WIDGET DE CHAT IA FUNCIONAL -->
    <div id="ai-chat-widget">
        <div id="ai-chat-header"><span><i class="fa-solid fa-robot"></i> Tutor Especialista</span><i class="fa-solid fa-chevron-down"></i></div>
        <div id="ai-chat-body"><div class="chat-message"><i class="fa-solid fa-robot icon"></i><div class="text">Olá! Selecione um tópico para que eu possa ajudá-lo.</div></div></div>
        <form id="ai-chat-form"><input type="text" id="ai-chat-input" placeholder="Faça uma pergunta..." autocomplete="off" disabled><button type="submit" id="ai-chat-send" disabled><i class="fa-solid fa-paper-plane"></i></button></form>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const welcomeScreen = document.getElementById('welcome-screen');
        const topicDashboard = document.getElementById('topic-dashboard');
        const contentLoader = document.getElementById('content-loader');
        const panePractice = document.getElementById('pane-practice');
        let currentTopic = null, currentArea = null, currentAreaId = null;
        let loadedTabs = {}, quizQuestions = [], currentQuizQuestionIndex = 0, quizScore = 0;

        document.querySelector('.sidebar').addEventListener('click', (e) => {
            const areaHeader = e.target.closest('.area-header');
            if (areaHeader) {
                areaHeader.classList.toggle('active');
                areaHeader.nextElementSibling.classList.toggle('active');
            }
            const topicItem = e.target.closest('.topic-item');
            if (topicItem) selectTopic(topicItem);
        });

        function selectTopic(topicElement) {
            document.querySelectorAll('.topic-item.selected').forEach(el => el.classList.remove('selected'));
            topicElement.classList.add('selected');
            currentTopic = topicElement.dataset.topic;
            const areaSection = topicElement.closest('.area-section');
            currentAreaId = areaSection.dataset.areaId;
            currentArea = areaSection.querySelector('.area-header').innerText.split('\n')[0].trim();
            updateDashboardUI();
            resetAndLoadFirstTab();
            updateInteractiveTools();
            updateChatContext();
            resetPracticeTab();
        }
        
        function updateDashboardUI() {
            welcomeScreen.style.display = 'none';
            topicDashboard.style.display = 'flex';
            document.getElementById('dashboard-title').innerText = currentTopic;
            document.getElementById('dashboard-subtitle').innerText = currentArea;
        }

        function resetAndLoadFirstTab() {
            document.querySelectorAll('.tab-button.active, .topic-content-pane.active').forEach(el => el.classList.remove('active'));
            const firstTab = document.querySelector('.tab-button');
            firstTab.classList.add('active');
            document.getElementById(`pane-${firstTab.dataset.tab}`).classList.add('active');
            loadedTabs = {};
            loadTabData(firstTab.dataset.tab);
        }

        document.querySelector('.topic-tabs').addEventListener('click', (e) => {
            if (e.target.classList.contains('tab-button')) switchTab(e.target.dataset.tab);
        });

        function switchTab(tabName) {
            document.querySelectorAll('.tab-button.active, .topic-content-pane.active').forEach(el => el.classList.remove('active'));
            document.querySelector(`.tab-button[data-tab="${tabName}"]`).classList.add('active');
            document.getElementById(`pane-${tabName}`).classList.add('active');
            if (!loadedTabs[tabName]) loadTabData(tabName);
        }

        async function loadTabData(tabName) {
            const staticTabs = ['tools', 'practice'];
            if (staticTabs.includes(tabName)) {
                loadedTabs[tabName] = true;
                return;
            }
            const pane = document.getElementById(`pane-${tabName}`);
            pane.innerHTML = '';
            contentLoader.style.display = 'block';
            const prompts = {
                overview: `Forneça uma **visão geral** clara e acessível sobre **"${currentTopic}"** (da área de "${currentArea}"). Explique o que é, sua importância fundamental e os conceitos centrais. Formate com Markdown.`,
                theory: `Detalhe a **teoria fundamental** de **"${currentTopic}"** em nível acadêmico. Apresente definições rigorosas, os teoremas mais importantes e os axiomas principais. Use Markdown e LaTeX para fórmulas (ex: $$ E=mc^2 $$).`,
                examples: `Apresente de 2 a 3 **exemplos práticos e resolvidos** de **"${currentTopic}"**. Inicie com um problema fundamental e avance para um mais complexo, explicando cada passo. Use Markdown e LaTeX para fórmulas.`,
                applications: `Descreva as **principais aplicações no mundo real** de **"${currentTopic}"**, citando exemplos específicos em ciência, tecnologia, engenharia, finanças, etc. Explique como o conceito é aplicado em cada caso. Use Markdown.`
            };
            try {
                const response = await puter.ai.chat([{ role: 'user', content: prompts[tabName] }]);
                pane.innerHTML = marked.parse(response.message.content);
                loadedTabs[tabName] = true;
            } catch (error) {
                console.error("Erro na IA:", error);
                pane.innerHTML = `<p style="color:red;">Ocorreu um erro ao carregar o conteúdo.</p>`;
            } finally {
                contentLoader.style.display = 'none';
            }
        }
        
        function resetPracticeTab() {
            panePractice.innerHTML = `<h3>Pratique com a IA</h3><p>Teste seus conhecimentos sobre <strong>${currentTopic}</strong>. A IA criará um quiz personalizado para você.</p><button class="btn btn-primary" id="btn-generate-quiz"><i class="fa-solid fa-bolt"></i> Gerar Quiz (5 Questões)</button>`;
            document.getElementById('btn-generate-quiz').onclick = generateQuiz;
        }

        async function generateQuiz() {
            panePractice.innerHTML = ''; contentLoader.style.display = 'block';
            const prompt = `Gere um quiz de 5 questões de múltipla escolha sobre o tópico de matemática "${currentTopic}". REGRAS ESTRITAS: 1. Cada questão deve ter 4 opções. 2. Apenas UMA opção correta. 3. Forneça uma explicação clara e concisa. 4. Responda APENAS com o JSON, dentro de um bloco de código. O formato JSON DEVE ser: \`\`\`json\n{"questions": [{"question": "...", "options": ["...", "...", "...", "..."], "correct_answer_index": 0, "explanation": "..."}]}\n\`\`\``;
            try {
                const response = await puter.ai.chat([{ role: 'user', content: prompt }]);
                const jsonMatch = response.message.content.match(/```json\s*([\s\S]*?)\s*```/);
                if (!jsonMatch || !jsonMatch[1]) throw new Error("A IA não retornou um JSON válido.");
                const quizData = JSON.parse(jsonMatch[1]);
                quizQuestions = quizData.questions;
                if (!quizQuestions || quizQuestions.length === 0) throw new Error("A IA retornou um quiz vazio.");
                startQuiz();
            } catch (error) {
                console.error("Erro ao gerar quiz:", error); panePractice.innerHTML = `<p style="color:red;">Erro ao gerar o quiz. Tente novamente. (${error.message})</p>`;
            } finally { contentLoader.style.display = 'none'; }
        }
        
        function startQuiz() { currentQuizQuestionIndex = 0; quizScore = 0; displayQuizQuestion(); }

        function displayQuizQuestion() {
            if (currentQuizQuestionIndex >= quizQuestions.length) { showQuizResults(); return; }
            const q = quizQuestions[currentQuizQuestionIndex];
            panePractice.innerHTML = `<div id="quiz-container"><h4>Questão ${currentQuizQuestionIndex + 1}/${quizQuestions.length}</h4><p class="quiz-question-text">${q.question}</p><div id="quiz-options">${q.options.map((opt, index) => `<button class="quiz-option" data-index="${index}">${opt}</button>`).join('')}</div><div class="quiz-explanation" id="quiz-explanation-text"><strong>Explicação:</strong> ${q.explanation}</div><button class="btn btn-primary" id="btn-next-quiz" style="display:none; margin-top: 20px;">Próxima Questão →</button></div>`;
            document.querySelectorAll('.quiz-option').forEach(btn => btn.onclick = (e) => selectQuizAnswer(e.target));
            document.getElementById('btn-next-quiz').onclick = () => { currentQuizQuestionIndex++; displayQuizQuestion(); };
        }
        
        function selectQuizAnswer(selectedButton) {
            const selectedIndex = parseInt(selectedButton.dataset.index), correctIndex = quizQuestions[currentQuizQuestionIndex].correct_answer_index;
            document.querySelectorAll('.quiz-option').forEach(btn => {
                btn.disabled = true;
                const btnIndex = parseInt(btn.dataset.index);
                if (btnIndex === correctIndex) btn.classList.add('correct');
                else if (btnIndex === selectedIndex) btn.classList.add('incorrect');
            });
            if (selectedIndex === correctIndex) quizScore++;
            document.getElementById('quiz-explanation-text').style.display = 'block';
            document.getElementById('btn-next-quiz').style.display = 'inline-block';
        }

        function showQuizResults() {
             panePractice.innerHTML = `<div class="quiz-results"><h3>Quiz Concluído!</h3><h2>Sua Pontuação: ${quizScore} de ${quizQuestions.length}</h2><p>Você acertou ${((quizScore / quizQuestions.length) * 100).toFixed(0)}% das questões.</p><button class="btn btn-primary" id="btn-restart-quiz">Gerar Novo Quiz</button></div>`;
             document.getElementById('btn-restart-quiz').onclick = generateQuiz;
        }

        function updateInteractiveTools() {
            document.querySelectorAll('.interactive-tool-container').forEach(c => c.classList.remove('active'));
            if (['analise', 'matematica-elementar'].includes(currentAreaId)) document.getElementById('tool-analise').classList.add('active');
            else if (currentAreaId === 'algebra') document.getElementById('tool-algebra').classList.add('active');
            else document.getElementById('tool-default').classList.add('active');
        }

        document.getElementById('btn-plot-function').addEventListener('click', () => {
            const funcStr = document.getElementById('function-input').value;
            try {
                const xValues = Array.from({length: 200}, (_, i) => (i - 100) / 10);
                const yValues = xValues.map(x => eval(funcStr.replace(/Math\.(\w+)/g, "$1").replace(/sin/g, 'Math.sin').replace(/cos/g, 'Math.cos').replace(/tan/g, 'Math.tan').replace(/exp/g, 'Math.exp').replace(/log/g, 'Math.log').replace(/\^/g, '**').replace(/x/g, `(${x})`)));
                Plotly.newPlot('plot-container', [{ x: xValues, y: yValues, mode: 'lines' }]);
            } catch (e) { document.getElementById('plot-container').innerHTML = `<p style="color:red">Erro na função: ${e.message}</p>`; }
        });
        document.getElementById('btn-matrix-sum').addEventListener('click', () => {
            try {
                const A = JSON.parse(document.getElementById('matrix-input-a').value), B = JSON.parse(document.getElementById('matrix-input-b').value);
                const C = A.map((row, i) => row.map((val, j) => val + B[i][j]));
                document.getElementById('matrix-output').textContent = JSON.stringify(C, null, 2);
            } catch (e) { document.getElementById('matrix-output').textContent = `Erro: ${e.message}`; }
        });
        
        const chatWidget = document.getElementById('ai-chat-widget'), chatHeader = document.getElementById('ai-chat-header'), chatBody = document.getElementById('ai-chat-body'), chatForm = document.getElementById('ai-chat-form'), chatInput = document.getElementById('ai-chat-input'), chatSendBtn = document.getElementById('ai-chat-send');
        chatHeader.onclick = () => chatWidget.classList.toggle('collapsed');
        chatForm.onsubmit = async (e) => {
            e.preventDefault(); const userInput = chatInput.value.trim(); if (!userInput) return;
            addChatMessage(userInput, 'user'); chatInput.value = ''; chatInput.disabled = true; chatSendBtn.disabled = true;
            try {
                const prompt = `Como um tutor de matemática especialista, responda a seguinte pergunta do aluno no contexto do tópico "${currentTopic}". Pergunta: "${userInput}"`;
                const response = await puter.ai.chat([{ role: 'user', content: prompt }]);
                addChatMessage(response.message.content, 'ai');
            } catch (error) { addChatMessage("Desculpe, ocorreu um erro. Por favor, tente novamente.", 'ai'); }
            finally { chatInput.disabled = false; chatSendBtn.disabled = false; chatInput.focus(); }
        };
        
        function addChatMessage(message, sender) {
            const msgDiv = document.createElement('div'); msgDiv.className = `chat-message ${sender}`;
            const iconClass = sender === 'user' ? 'fa-user' : 'fa-robot';
            const parsedMessage = sender === 'ai' ? marked.parse(message) : message.replace(/</g, "<").replace(/>/g, ">");
            msgDiv.innerHTML = `<i class="fa-solid ${iconClass} icon"></i><div class="text">${parsedMessage}</div>`;
            chatBody.appendChild(msgDiv); chatBody.scrollTop = chatBody.scrollHeight;
        }

        function updateChatContext() {
            chatInput.disabled = false; chatSendBtn.disabled = false;
            chatInput.placeholder = `Pergunte sobre ${currentTopic}...`;
            while (chatBody.children.length > 1) chatBody.removeChild(chatBody.lastChild);
            addChatMessage(`Olá! Sou seu tutor especialista em <strong>${currentTopic}</strong>. Como posso ajudar?`, 'ai');
        }
    });
    </script>
</body>
</html>
