<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Gerador de Quest√µes e Quiz Matem√°tico com Tutor</title>
    <!-- Script essencial para a IA funcionar -->
    <script src="https://js.puter.com/v2/"></script>
    <!-- MathJax para renderizar f√≥rmulas matem√°ticas -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f2f5;
            color: #1c1e21;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 20px auto;
            background-color: #ffffff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            color: #333;
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 25px;
        }
        select, input[type="number"] {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border-radius: 6px;
            border: 1px solid #ccc;
            margin-bottom: 10px;
            box-sizing: border-box;
        }
        .main-button {
            display: block;
            width: 100%;
            padding: 14px;
            font-size: 16px;
            font-weight: bold;
            color: #fff;
            background-color: #007bff;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 10px;
        }
        .main-button:disabled {
            background-color: #999;
            cursor: not-allowed;
        }
        #status {
            text-align: center;
            padding: 10px;
            margin-top: 20px;
            border-radius: 6px;
            display: none;
        }
        .status-success { background-color: #d4edda; color: #155724; }
        .status-error { background-color: #f8d7da; color: #721c24; }
        .status-info { background-color: #cce5ff; color: #004085; }
        #questions-container {
            margin-top: 30px;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }
        .question-card {
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .question-text {
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 10px;
        }
        .question-options label {
            display: block;
            margin: 10px 0;
        }
        .question-answer {
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px dashed #ccc;
            display: none;
        }
        .remove-btn, .check-btn, .tutor-btn {
            background-color: #dc3545;
            color: white;
            padding: 5px 10px;
            font-size: 12px;
            border-radius: 4px;
            cursor: pointer;
            border: none;
            margin-left: 10px;
        }
        .check-btn {
            background-color: #28a745;
        }
        .tutor-btn {
            background-color: #17a2b8;
        }
        #actions-container {
            display: none;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #007bff;
            display: flex;
            gap: 15px;
        }
        .action-button {
            flex: 1;
            padding: 12px;
            font-size: 15px;
            font-weight: bold;
            color: #fff;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }
        .pdf-button { background-color: #28a745; }
        .clear-button { background-color: #6c757d; }
        .tutor-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .tutor-modal-content {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        .tutor-modal-content h2 {
            margin-top: 0;
            color: #333;
        }
        .tutor-modal-content textarea {
            width: 100%;
            height: 100px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            margin-bottom: 10px;
            resize: vertical;
        }
        .tutor-modal-content select {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 6px;
            border: 1px solid #ccc;
        }
        .tutor-response {
            background-color: #f9f9f9;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            margin-top: 10px;
        }
        .close-modal {
            background-color: #dc3545;
            color: white;
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            float: right;
        }
        #tutor-history-container {
            margin-top: 30px;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }
        .tutor-history-item {
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Gerador de Quest√µes e Quiz Matem√°tico com Tutor</h1>
        <p class="subtitle">Escolha um t√≥pico, tipo (perguntas ou quiz) e a quantidade de quest√µes.</p>

        <div>
            <select id="topic" onchange="updateSubtopics()">
                <option value="">Selecione um t√≥pico</option>
            </select>
            <select id="subtopic">
                <option value="">Selecione um subtema</option>
            </select>
            <select id="type">
                <option value="questions">Perguntas (Estudo)</option>
                <option value="quiz">Quiz Interativo</option>
            </select>
            <input type="number" id="quantity" min="1" max="10" placeholder="Quantidade de quest√µes (1-10)">
            <button id="generate-btn" class="main-button">üöÄ Gerar</button>
        </div>

        <div id="status"></div>
        
        <div id="actions-container">
            <button id="pdf-btn" class="action-button pdf-button">üìÑ Salvar em PDF</button>
            <button id="clear-btn" class="action-button clear-button">üóëÔ∏è Limpar Tudo</button>
        </div>

        <div id="questions-container">
            <p style="text-align:center; color:#888;">Suas quest√µes ou quiz aparecer√£o aqui.</p>
        </div>

        <div id="tutor-history-container">
            <h2>Hist√≥rico do Tutor</h2>
            <p style="text-align:center; color:#888;">Suas d√∫vidas e respostas aparecer√£o aqui.</p>
        </div>

        <div id="tutor-modal" class="tutor-modal">
            <div class="tutor-modal-content">
                <button class="close-modal" onclick="closeTutorModal()">Fechar</button>
                <h2>Perguntar ao Tutor</h2>
                <p id="tutor-question-context"></p>
                <select id="tutor-level">
                    <option value="beginner">Iniciante</option>
                    <option value="intermediate">Intermedi√°rio</option>
                    <option value="advanced">Avan√ßado</option>
                </select>
                <textarea id="tutor-question" placeholder="Digite sua d√∫vida sobre a quest√£o ou tema..."></textarea>
                <button class="main-button" onclick="submitTutorQuestion()">Enviar D√∫vida</button>
                <div id="tutor-response" class="tutor-response"></div>
            </div>
        </div>
    </div>

    <script>
        // === DADOS DA GRADE DE CONTE√öDOS ===
        const curriculum = [
            {
                section: "Se√ß√£o 1: O Mundo da Matem√°tica - Parte 1",
                topics: [
                    "Bem-vindo ao curso O Mundo da Matem√°tica!",
                    "O Teorema de Pit√°goras",
                    "O Teorema do Resto Chin√™s",
                    "O Teorema Fundamental da √Ålgebra",
                    "Desvendando a Estat√≠stica Descritiva",
                    "A Vida e Conquistas de Nikolai Lobachevsky",
                    "Os Segredos dos N√∫meros Primos de Mersenne",
                    "Probabilidade e Dados: Uma Jornada Matem√°tica",
                    "O Enigma de Goldbach: Mist√©rio Matem√°tico Antigo",
                    "S√©ries Num√©ricas Infinitas: Uma Jornada ao Infinito Matem√°tico",
                    "O Enigma de P versus NP: Explorando os Limites da Computa√ß√£o"
                ]
            },
            {
                section: "Se√ß√£o 2: O Mundo da Matem√°tica - Parte 2",
                topics: [
                    "O Problema do Caixeiro Viajante",
                    "Os Problemas de Otimiza√ß√£o Simples",
                    "Equa√ß√µes: Desafios e Solu√ß√µes Matem√°ticas!",
                    "Os Segredos da Trigonometria: Uma Jornada Matem√°tica",
                    "O Teorema do Valor Intermedi√°rio: Uma Jornada Matem√°tica",
                    "Fibonacci e a Magia na Natureza: Uma Jornada Matem√°tica",
                    "O Encanto dos N√∫meros Primos: Mist√©rio, Beleza e Utilidade",
                    "Matem√°tica Financeira para Todos: Simplificando o Complexo",
                    "Matem√°tica das Redes Sociais: Modelagem, An√°lise e Impacto",
                    "Explorando a Conjectura de Collatz: Uma Viagem pela Matem√°tica"
                ]
            },
            {
                section: "Se√ß√£o 3: O Mundo da Matem√°tica - Parte 3",
                topics: [
                    "Pit√°goras de Samos",
                    "Hist√≥ria da Matem√°tica: A Evolu√ß√£o do Conceito de Ponto",
                    "Aritm√©tica Elementar: Descobrindo Seu Poder e Aplica√ß√µes!",
                    "O Algoritmo RSA Fundamentos e Import√¢ncia na Criptografia",
                    "Ontologia e Exist√™ncia: A Natureza dos Pontos Matem√°ticos",
                    "Explorando a Topologia: A Matem√°tica das Formas e Espa√ßos",
                    "Os Enigmas Matem√°ticos: Uma Jornada de L√≥gica e Criatividade",
                    "A Beleza Oculta da Matem√°tica: Explorando o Universo com N√∫meros",
                    "John Nash e o Equil√≠brio de Nash: Revolucionando a Teoria dos Jogos",
                    "Os N√∫meros Primos e a Criptografia: Protegendo Dados na Era Digital"
                ]
            },
            {
                section: "Se√ß√£o 4: O Mundo da Matem√°tica - Parte 4",
                topics: [
                    "√Ålgebra: Da Teoria √† Pr√°tica",
                    "A Geometria Fractal na Natureza",
                    "A Geometria Fractal e Sua Beleza",
                    "A Magia dos Fractais Geom√©tricos",
                    "A Geometria Euclidiana: Fundamentos e Aplica√ß√µes",
                    "A Harmonia Oculta: Descobrindo a Matem√°tica na M√∫sica",
                    "A Fascinante Jornada dos N√∫meros Complexos na Matem√°tica",
                    "A Geometria do Universo: Explorando as Estruturas Cosmol√≥gicas",
                    "Tend√™ncias em Educa√ß√£o STEM: Realidade Aumentada, Rob√≥tica e Mais!",
                    "A Fascinante Hist√≥ria da Matem√°tica: De Civiliza√ß√µes Antigas √† Era Moderna"
                ]
            },
            {
                section: "Se√ß√£o 5: O Mundo da Matem√°tica - Parte 5",
                topics: [
                    "O Paradoxo do Barbeiro",
                    "Hist√≥ria da Matem√°tica Indiana",
                    "O Enigma dos N√∫meros Primos",
                    "O Mundo dos N√∫meros Perfeitos",
                    "A Beleza das Equa√ß√µes Diferenciais",
                    "A Matem√°tica por Tr√°s das Artes Visuais",
                    "Revolu√ß√£o na Educa√ß√£o IA e Matem√°tica",
                    "A Vida e o Legado de Srinivasa Ramanujan",
                    "A Fascinante Hist√≥ria da Conjectura de Collatz",
                    "Como a Intelig√™ncia Artificial Est√° Revolucionando a Matem√°tica"
                ]
            },
            {
                section: "Se√ß√£o 6: O Mundo da Matem√°tica - Parte 6",
                topics: [
                    "Descobrindo Padr√µes na Matem√°tica",
                    "Desvendando o Problema do Caixeiro Viajante",
                    "A Revolu√ß√£o da Matem√°tica Digital: Impactos e Inova√ß√µes",
                    "A Magia dos N√∫meros Irracionais: Uma Jornada Matem√°tica",
                    "Ubiratan D'Ambrosio: O Matem√°tico que Humanizou a Educa√ß√£o",
                    "A Matem√°tica √© Para os Fortes: Desvendando Mitos e Realidades",
                    "A Olimp√≠ada Internacional de Matem√°tica: Uma Jornada de G√™nios",
                    "Segredos da Criptografia Moderna: A Arte de Proteger Informa√ß√µes",
                    "A Teoria dos Conjuntos: Uma Jornada Matem√°tica com Georg Cantor",
                    "A Magia dos Fractais Geom√©tricos: Explorando Infinitas Complexidades"
                ]
            },
            {
                section: "Se√ß√£o 7: O Mundo da Matem√°tica - Parte 7",
                topics: [
                    "Paradoxos Matem√°ticos: De Zeno a Russell",
                    "A Quarta Dimens√£o: Explorando Hipercubos",
                    "A Hist√≥ria do Zero: Uma Revolu√ß√£o Matem√°tica",
                    "Como Vencer no Jogo da Velha com Matem√°tica",
                    "A Matem√°tica Por Tr√°s do Aprendizado de M√°quina",
                    "N√∫meros Complexos: Aplica√ß√µes Imagin√°rias e Reais",
                    "Explorando a Teoria dos Grafos: Conceitos e Aplica√ß√µes",
                    "A Hip√≥tese de Riemann: O Maior Mist√©rio da Matem√°tica",
                    "Explorando a Geometria N√£o Euclidiana: Uma Nova Perspectiva",
                    "A Matem√°tica do Crescimento Populacional: Entenda os Modelos Exponencial e Log√≠stico"
                ]
            },
            {
                section: "Se√ß√£o 8: O Mundo da Matem√°tica - Parte 8",
                topics: [
                    "John Playfair",
                    "Ada Lovelace",
                    "Isaac Newton",
                    "Thomas Bayes",
                    "Leonhard Euler",
                    "Girolamo Cardano",
                    "Hip√°tia de Alexandria",
                    "Pierre-Simon Laplace",
                    "Euclides de Alexandria",
                    "Joseph-Louis Lagrange"
                ]
            },
            {
                section: "Se√ß√£o 9: O Mundo da Matem√°tica - Parte 9",
                topics: [
                    "A Propor√ß√£o √Åurea: Est√©tica na Matem√°tica",
                    "A Identidade de Euler: A Equa√ß√£o Mais Bonita",
                    "Explorando os N√∫meros Primos e Suas Propriedades",
                    "A Beleza da Sequ√™ncia de Fibonacci e a Propor√ß√£o √Åurea",
                    "Matem√°tica na Vida Real: Aplica√ß√µes Pr√°ticas no Dia a Dia",
                    "Introdu√ß√£o √† Teoria dos Jogos e o Pensamento Estrat√©gico",
                    "Teoria do Caos e o Efeito Borboleta: Entenda a Complexidade",
                    "Criptografia: Como a Matem√°tica Mant√©m Seus Dados Seguros",
                    "A Matem√°tica dos Fractais e a Auto-Similaridade: Explorando Padr√µes Infinitos",
                    "A Beleza Matem√°tica da Natureza: Explorando a Geometria das Formas Naturais"
                ]
            },
            {
                section: "Se√ß√£o 10: O Mundo da Matem√°tica - Parte 10",
                topics: [
                    "Medalha Fields",
                    "O Enigma de Russell",
                    "Hip√≥tese de Riemann",
                    "Os Cortes de Dedekind",
                    "Paradoxo de Monty Hall",
                    "Paradoxo do Hotel de Hilbert",
                    "As Sete Pontes de K√∂nigsberg",
                    "Hist√≥ria da Teoria dos N√∫meros",
                    "A Vida e o Legado de Alan Turing",
                    "Provas Matem√°ticas: L√≥gica e Racioc√≠nio Desvendados"
                ]
            },
            {
                section: "Se√ß√£o 11: O Mundo da Matem√°tica - Parte 11",
                topics: [
                    "Os N√∫meros: A Linguagem Universal que Conecta o Mundo",
                    "C√°lculo Fracion√°rio: Novas Fronteiras na F√≠sica e Engenharia",
                    "Matem√°tica do Caos: Pequenos Desvios, Grandes Mudan√ßas",
                    "Matem√°tica Qu√¢ntica: Explorando Computa√ß√£o e F√≠sica Qu√¢ntica",
                    "Matem√°tica das Redes Neurais: Como Equa√ß√µes Modelam e Treinam",
                    "Matem√°tica Financeira e Criptomoedas: Modelos para Prever Flutua√ß√µes",
                    "Topologia e Ci√™ncias dos Dados: Analisando Grandes Conjuntos de Dados",
                    "Geometria Alg√©brica: Um campo em crescimento com aplica√ß√µes fascinantes",
                    "Intelig√™ncia Artificial e Machine Learning: Aplica√ß√µes de Matem√°tica Avan√ßada",
                    "Teoria da Complexidade Computacional: Entendendo a Efici√™ncia dos Algoritmos"
                ]
            },
            {
                section: "Se√ß√£o 12: O Mundo da Matem√°tica - Parte 12",
                topics: [
                    "A Conjectura de Poincar√©",
                    "O Papel da Simetria na Matem√°tica",
                    "Explorando a Topologia: A Forma do Espa√ßo",
                    "Como Funciona o GPS: Matem√°tica na Navega√ß√£o",
                    "Otimiza√ß√£o Matem√°tica: A Arte de Resolver Problemas",
                    "A Matem√°tica da M√∫sica e do Som: Descubra a Conex√£o!",
                    "O Legado de Fibonacci: A Dan√ßa dos N√∫meros e da Natureza",
                    "Como Economistas Usam a Matem√°tica para Prever Mercados",
                    "Entendendo a Probabilidade: Dados, Cartas e Eventos Aleat√≥rios",
                    "A Matem√°tica Por Tr√°s da F√≠sica Qu√¢ntica: Desvendando os Mist√©rios do Universo"
                ]
            },
            {
                section: "Se√ß√£o 13: O Mundo da Matem√°tica - Parte 13",
                topics: [
                    "A Jornada de Leibniz",
                    "O Paradoxo de Zeno",
                    "A Matem√°tica Est√° em Tudo!",
                    "Tend√™ncias em Educa√ß√£o STEM",
                    "Desenvolvendo a Intui√ß√£o Matem√°tica: Guia Completo",
                    "Os Sete Desafios Matem√°ticos de Um Milh√£o de D√≥lares",
                    "Matem√°ticos Americanos Not√°veis e Suas Contribui√ß√µes",
                    "Matem√°tica Aplicada √† Gen√¥mica: Decifrando Dados Gen√©ticos",
                    "Grigori Perelman: O G√™nio que Resolveu a Conjectura de Poincar√©",
                    "Teoria dos N√∫meros em Criptografia: Como a Matem√°tica Protege Seus Dados"
                ]
            },
            {
                section: "Se√ß√£o 14: O Mundo da Matem√°tica - Parte 14",
                topics: [
                    "Sequ√™ncia de Estudos",
                    "Algoritmos",
                    "Teoria de Grupos",
                    "Teoria dos N√∫meros",
                    "Conjunto de Mandelbrot",
                    "Estat√≠stica na Medicina e Pesquisa",
                    "Intelig√™ncia Artificial e Matem√°tica",
                    "A matem√°tica foi inventada ou criada?",
                    "Explorando a Topologia: A Forma do Espa√ßo",
                    "Por Que a Matem√°tica Prediz T√£o Bem o Futuro",
                    "Como Matrizes S√£o Usadas em Gr√°ficos Computacionais"
                ]
            },
            {
                section: "Se√ß√£o 15: O Mundo da Matem√°tica - Parte 15",
                topics: [
                    "Teorema Binomial",
                    "C√≥digo Matem√°tico",
                    "Recurs√£o e Matem√°tica",
                    "A sequ√™ncia de Fibonacci",
                    "Caleidosc√≥pio da Matem√°tica",
                    "Como Usar Geometria no Dia a Dia",
                    "A import√¢ncia dos pequenos passos",
                    "A Matem√°tica da Explora√ß√£o Espacial",
                    "A Matem√°tica da Criptografia Computacional",
                    "Entendendo Estruturas Alg√©bricas: Grupos, An√©is e Corpos"
                ]
            },
            {
                section: "Se√ß√£o 16: O Mundo da Matem√°tica - Parte 16",
                topics: [
                    "Sistemas Din√¢micos e Caos",
                    "Grigori Yakovlevich Perelman",
                    "Geometria Anal√≠tica e Vetores",
                    "Teoria da Medida e Integra√ß√£o",
                    "An√°lise Funcional e Operadores",
                    "F√≠sica Matem√°tica e Modelagem",
                    "Teoria da Informa√ß√£o e Codifica√ß√£o",
                    "L√≥gica Fuzzy e Sistemas Nebulosos",
                    "Matem√°tica Computacional e Simula√ß√£o",
                    "Modelos Estoc√°sticos e Processos Aleat√≥rios"
                ]
            },
            {
                section: "Se√ß√£o 17: O Mundo da Matem√°tica - Parte 17",
                topics: [
                    "An√°lise Real e Complexa",
                    "Teoria de Galois e Equa√ß√µes",
                    "An√°lise de S√©ries Temporais",
                    "C√°lculo Variacional e Otimiza√ß√£o",
                    "Transformadas de Fourier e Laplace",
                    "Processamento de Imagens e Sinais",
                    "Modelagem Matem√°tica em Biologia",
                    "Matem√°tica em Intelig√™ncia Artificial",
                    "Equa√ß√µes Diferenciais com Retardamento",
                    "Modelagem Matem√°tica em Epidemiologia"
                ]
            },
            {
                section: "Se√ß√£o 18: O Mundo da Matem√°tica - Parte 18",
                topics: [
                    "An√°lise de Dados",
                    "Infra√ß√£o Temporal",
                    "A filosofia do Ponto",
                    "Hist√≥ria da Geometria",
                    "Modelagem Matem√°tica",
                    "√Ålgebra Linear e Matricial",
                    "Din√¢mica dos Fluidos e Equa√ß√µes",
                    "Teoria de Aproxima√ß√£o e Interpola√ß√£o",
                    "Matem√°tica de Redes Neurais: O C√©rebro das M√°quinas",
                    "Combinat√≥ria e An√°lise Enumerativa: Explorando o Fasc√≠nio da Contagem"
                ]
            },
            {
                section: "Se√ß√£o 19: O Mundo da Matem√°tica - Parte 19",
                topics: [
                    "Teoria dos N√∫meros Primos",
                    "L√≥gica Matem√°tica e Provas",
                    "Lev Semenovich Pontryagin",
                    "C√°lculo Diferencial e Integral",
                    "Teoria dos Conjuntos e Fun√ß√µes",
                    "Matem√°tica Recreativa e Paradoxos",
                    "Matem√°tica Discreta e Combinat√≥ria",
                    "Geometria Euclidiana e N√£o-Euclidiana",
                    "Equa√ß√µes Diferenciais Parciais e Ordin√°rias",
                    "A Matem√°tica da Internet: Algoritmos e Dados"
                ]
            },
            {
                section: "Se√ß√£o 20: O Mundo da Matem√°tica - Parte 20",
                topics: [
                    "Infra√ß√£o Temporal",
                    "A hist√≥ria do Zero",
                    "Caleidosc√≥pio da Matem√°tica",
                    "Explorando a Quinta Dimens√£o",
                    "O feedback eficaz na Avalia√ß√£o Matem√°tica",
                    "Estat√≠stica Bayesiana e Infer√™ncia",
                    "Teoria de Sistemas e Controle",
                    "Leviat√£ da Matem√°tica",
                    "Os Matem√°ticos",
                    "PSA"
                ]
            },
            {
                section: "Se√ß√£o 21: O Mundo da Matem√°tica - Parte 21",
                topics: [
                    "Educa√ß√£o Matem√°tica",
                    "Conceitos b√°sicos de educa√ß√£o matem√°tica",
                    "Papel do educador na promo√ß√£o da aprendizagem matem√°tica",
                    "Hist√≥ria da educa√ß√£o matem√°tica",
                    "Principais teorias da aprendizagem aplicadas √† matem√°tica",
                    "Construtivismo, socioculturalismo, e outras abordagens relevantes",
                    "Implica√ß√µes das teorias da aprendizagem na pr√°tica pedag√≥gica",
                    "Abordagens pr√°ticas para promover a participa√ß√£o ativa dos alunos",
                    "Aprendizagem baseada em problemas",
                    "Aprendizagem colaborativa e cooperativa",
                    "Uso de tecnologias digitais e ferramentas online para o ensino",
                    "Softwares educacionais e aplicativos m√≥veis",
                    "Ensino h√≠brido e aprendizagem online em matem√°tica",
                    "Tipos de avalia√ß√£o em matem√°tica: formativa, somativa, diagn√≥stica",
                    "Desafios e estrat√©gias para avaliar habilidades matem√°ticas",
                    "Feedback eficaz na avalia√ß√£o matem√°tica"
                ]
            }
        ];

        // === VARI√ÅVEIS GLOBAIS ===
        let questionsDatabase = [];
        let tutorHistory = [];
        let currentQuestionId = null;
        const topicSelect = document.getElementById('topic');
        const subtopicSelect = document.getElementById('subtopic');
        const typeSelect = document.getElementById('type');
        const quantityInput = document.getElementById('quantity');
        const generateBtn = document.getElementById('generate-btn');
        const statusDiv = document.getElementById('status');
        const questionsContainer = document.getElementById('questions-container');
        const actionsContainer = document.getElementById('actions-container');
        const pdfBtn = document.getElementById('pdf-btn');
        const clearBtn = document.getElementById('clear-btn');
        const tutorModal = document.getElementById('tutor-modal');
        const tutorQuestionContext = document.getElementById('tutor-question-context');
        const tutorLevelSelect = document.getElementById('tutor-level');
        const tutorQuestionInput = document.getElementById('tutor-question');
        const tutorResponseDiv = document.getElementById('tutor-response');
        const tutorHistoryContainer = document.getElementById('tutor-history-container');

        // === FUN√á√ïES DE L√ìGICA ===

        // Preenche o dropdown de t√≥picos
        function populateTopics() {
            curriculum.forEach((section, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = section.section;
                topicSelect.appendChild(option);
            });
        }

        // Atualiza o dropdown de subtemas com base no t√≥pico selecionado
        function updateSubtopics() {
            const sectionIndex = topicSelect.value;
            subtopicSelect.innerHTML = '<option value="">Selecione um subtema</option>';
            if (sectionIndex !== "") {
                curriculum[sectionIndex].topics.forEach(topic => {
                    const option = document.createElement('option');
                    option.value = topic;
                    option.textContent = topic;
                    subtopicSelect.appendChild(option);
                });
            }
        }

        // Mostra uma mensagem para o usu√°rio
        function showStatus(message, type = 'info') {
            statusDiv.textContent = message;
            statusDiv.className = `status-${type}`;
            statusDiv.style.display = 'block';
            setTimeout(() => { statusDiv.style.display = 'none'; }, 3000);
        }

        // Gera um ID √∫nico para cada quest√£o ou intera√ß√£o
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        // Fun√ß√£o principal que gera as quest√µes ou quiz
        async function generateQuestions() {
            const subtopic = subtopicSelect.value;
            const type = typeSelect.value;
            const quantity = parseInt(quantityInput.value);

            if (!subtopic) {
                showStatus('Por favor, selecione um subtema.', 'error');
                return;
            }
            if (!quantity || quantity < 1 || quantity > 10) {
                showStatus('Por favor, insira uma quantidade v√°lida (1-10).', 'error');
                return;
            }

            generateBtn.disabled = true;
            generateBtn.textContent = 'Gerando...';
            showStatus('Gerando conte√∫do. Aguarde...', 'info');

            try {
                const finalPrompt = `
                    Voc√™ √© um especialista em criar material educacional de matem√°tica. Gere ${quantity} quest√µes baseadas no t√≥pico "${subtopic}".
                    TIPO: ${type === 'questions' ? 'Perguntas para estudo (m√∫ltipla escolha ou verdadeiro/falso, com respostas e explica√ß√µes)' : 'Quiz interativo (m√∫ltipla escolha ou verdadeiro/falso, com respostas e explica√ß√µes)'}.
                    REGRAS DE FORMATA√á√ÉO:
                    Responda APENAS com um objeto JSON:
                    {
                      "questions": [
                        {
                          "text": "Texto da quest√£o.",
                          "options": ["A) Op√ß√£o 1", "B) Op√ß√£o 2", "C) Op√ß√£o 3", "D) Op√ß√£o 4"],
                          "correct_answer": "A letra ou texto da resposta correta.",
                          "explanation": "Explica√ß√£o da resposta correta, usando LaTeX para f√≥rmulas (ex.: \\(x^2\\))."
                        }
                      ]
                    }
                    - Para verdadeiro/falso, use ["Verdadeiro", "Falso"].
                    - As quest√µes devem ser claras e educacionais.
                    - Use LaTeX para todas as f√≥rmulas matem√°ticas.
                `;
                
                const response = await puter.ai.chat([{ role: 'user', content: finalPrompt }]);
                
                if (!response || !response.message || !response.message.content) {
                    throw new Error('A IA n√£o retornou uma resposta v√°lida.');
                }

                const jsonStart = response.message.content.indexOf('{');
                const jsonEnd = response.message.content.lastIndexOf('}') + 1;
                const jsonString = response.message.content.substring(jsonStart, jsonEnd);
                const parsed = JSON.parse(jsonString);

                const newQuestions = parsed.questions ? parsed.questions.map(q => ({ ...q, id: generateId(), type, subtopic })) : [];

                if (newQuestions.length > 0) {
                    questionsDatabase.unshift(...newQuestions);
                    saveToLocalStorage();
                    renderQuestions();
                    MathJax.typeset(); // Renderiza as f√≥rmulas com MathJax
                    showStatus(`${newQuestions.length} quest√£o(√µes) gerada(s) com sucesso!`, 'success');
                } else {
                    throw new Error('N√£o foi poss√≠vel extrair quest√µes da resposta da IA.');
                }

            } catch (error) {
                console.error('Erro na gera√ß√£o:', error);
                showStatus(`Ocorreu um erro: ${error.message}`, 'error');
            } finally {
                generateBtn.disabled = false;
                generateBtn.textContent = 'üöÄ Gerar';
            }
        }

        // Exibe as quest√µes na tela
        function renderQuestions() {
            if (questionsDatabase.length === 0) {
                questionsContainer.innerHTML = '<p style="text-align:center; color:#888;">Nenhuma quest√£o ou quiz gerado.</p>';
                actionsContainer.style.display = 'none';
                return;
            }

            actionsContainer.style.display = 'flex';
            questionsContainer.innerHTML = '';
            questionsDatabase.forEach(q => {
                const card = document.createElement('div');
                card.className = 'question-card';
                let optionsHTML = '';
                if (q.options && q.options.length > 0) {
                    if (q.type === 'quiz') {
                        optionsHTML = `<div class="question-options">`;
                        q.options.forEach((opt, index) => {
                            optionsHTML += `
                                <label>
                                    <input type="radio" name="answer-${q.id}" value="${opt}"> ${opt}
                                </label>`;
                        });
                        optionsHTML += `</div>`;
                    } else {
                        optionsHTML = `<div class="question-options"><ul>${q.options.map(opt => `<li>${opt}</li>`).join('')}</ul></div>`;
                    }
                }

                card.innerHTML = `
                    <button class="remove-btn" onclick="removeQuestion('${q.id}')">Remover</button>
                    ${q.type === 'quiz' ? `<button class="check-btn" onclick="checkAnswer('${q.id}')">Verificar Resposta</button>` : ''}
                    <button class="tutor-btn" onclick="openTutorModal('${q.id}')">Perguntar ao Tutor</button>
                    <div class="question-text">${q.text}</div>
                    ${optionsHTML}
                    <div class="question-answer" id="answer-${q.id}">
                        <strong>Resposta:</strong> ${q.correct_answer}<br>
                        <strong>Explica√ß√£o:</strong> ${q.explanation || 'N√£o fornecida.'}
                    </div>
                `;
                questionsContainer.appendChild(card);
            });
            MathJax.typeset(); // Renderiza as f√≥rmulas com MathJax ap√≥s adicionar quest√µes
        }

        // Verifica a resposta no modo quiz
        function checkAnswer(questionId) {
            const question = questionsDatabase.find(q => q.id === questionId);
            const selectedOption = document.querySelector(`input[name="answer-${questionId}"]:checked`);
            const answerDiv = document.getElementById(`answer-${questionId}`);
            
            if (!selectedOption) {
                showStatus('Por favor, selecione uma op√ß√£o.', 'error');
                return;
            }

            answerDiv.style.display = 'block';
            if (selectedOption.value === question.correct_answer) {
                showStatus('Correto! Veja a explica√ß√£o abaixo.', 'success');
            } else {
                showStatus('Incorreto. Veja a resposta correta e a explica√ß√£o abaixo.', 'error');
            }
            MathJax.typeset(); // Renderiza f√≥rmulas na explica√ß√£o
        }

        // Remove uma quest√£o da lista
        function removeQuestion(questionId) {
            questionsDatabase = questionsDatabase.filter(q => q.id !== questionId);
            saveToLocalStorage();
            renderQuestions();
            showStatus('Quest√£o removida.', 'info');
        }

        // Limpa todas as quest√µes da lista
        function clearAllQuestions() {
            if (confirm('Tem certeza que deseja apagar TODAS as quest√µes?')) {
                questionsDatabase = [];
                saveToLocalStorage();
                renderQuestions();
                showStatus('Lista limpa.', 'info');
            }
        }

        // === FUN√á√ïES DO TUTOR ===

        // Abre o modal do tutor
        function openTutorModal(questionId) {
            currentQuestionId = questionId;
            const question = questionsDatabase.find(q => q.id === questionId);
            tutorQuestionContext.innerHTML = `<strong>Quest√£o:</strong> ${question.text}<br><strong>Tema:</strong> ${question.subtopic}`;
            tutorQuestionInput.value = '';
            tutorResponseDiv.innerHTML = '';
            tutorModal.style.display = 'flex';
            MathJax.typeset(); // Renderiza f√≥rmulas no contexto da quest√£o
        }

        // Fecha o modal do tutor
        function closeTutorModal() {
            tutorModal.style.display = 'none';
            currentQuestionId = null;
        }

        // Envia a d√∫vida ao tutor
        async function submitTutorQuestion() {
            const question = questionsDatabase.find(q => q.id === currentQuestionId);
            const doubt = tutorQuestionInput.value.trim();
            const level = tutorLevelSelect.value;

            if (!doubt) {
                showStatus('Por favor, digite uma d√∫vida.', 'error');
                return;
            }

            try {
                const tutorPrompt = `
                    Voc√™ √© um tutor especializado em matem√°tica. Responda √† d√∫vida do usu√°rio de forma clara, educacional e adaptada ao n√≠vel de conhecimento "${level}" (iniciante, intermedi√°rio ou avan√ßado).
                    Contexto da quest√£o:
                    - Tema: ${question.subtopic}
                    - Quest√£o: ${question.text}
                    - Resposta correta: ${question.correct_answer}
                    - Explica√ß√£o original: ${question.explanation || 'N√£o fornecida.'}
                    D√∫vida do usu√°rio: ${doubt}
                    Forne√ßa uma explica√ß√£o detalhada, com exemplos pr√°ticos, e, se aplic√°vel, sugira um exerc√≠cio adicional relacionado ao tema. Responda em portugu√™s e use LaTeX para todas as f√≥rmulas matem√°ticas (ex.: \\(x^2\\)).
                `;
                
                const response = await puter.ai.chat([{ role: 'user', content: tutorPrompt }]);
                
                if (!response || !response.message || !response.message.content) {
                    throw new Error('A IA n√£o retornou uma resposta v√°lida.');
                }

                const tutorResponse = response.message.content;
                tutorResponseDiv.innerHTML = tutorResponse;
                saveTutorHistory(doubt, tutorResponse, question.subtopic, question.text);
                renderTutorHistory();
                showStatus('D√∫vida respondida com sucesso!', 'success');
                MathJax.typeset(); // Renderiza f√≥rmulas na resposta do tutor

            } catch (error) {
                console.error('Erro na consulta ao tutor:', error);
                showStatus(`Ocorreu um erro: ${error.message}`, 'error');
            }
        }

        // Salva o hist√≥rico de intera√ß√µes do tutor
        function saveTutorHistory(doubt, response, subtopic, questionText) {
            tutorHistory.unshift({
                id: generateId(),
                doubt,
                response,
                subtopic,
                questionText,
                timestamp: new Date().toLocaleString('pt-BR')
            });
            localStorage.setItem('tutorHistory', JSON.stringify(tutorHistory));
        }

        // Carrega o hist√≥rico do tutor do localStorage
        function loadTutorHistory() {
            const saved = localStorage.getItem('tutorHistory');
            if (saved) {
                tutorHistory = JSON.parse(saved);
            }
        }

        // Exibe o hist√≥rico do tutor
        function renderTutorHistory() {
            if (tutorHistory.length === 0) {
                tutorHistoryContainer.innerHTML = '<h2>Hist√≥rico do Tutor</h2><p style="text-align:center; color:#888;">Nenhuma d√∫vida registrada.</p>';
                return;
            }

            tutorHistoryContainer.innerHTML = '<h2>Hist√≥rico do Tutor</h2>';
            tutorHistory.forEach(item => {
                const historyItem = document.createElement('div');
                historyItem.className = 'tutor-history-item';
                historyItem.innerHTML = `
                    <p><strong>Tema:</strong> ${item.subtopic}</p>
                    <p><strong>Quest√£o:</strong> ${item.questionText}</p>
                    <p><strong>D√∫vida:</strong> ${item.doubt}</p>
                    <p><strong>Resposta:</strong> ${item.response}</p>
                    <p><strong>Data:</strong> ${item.timestamp}</p>
                    <button class="remove-btn" onclick="removeTutorHistory('${item.id}')">Remover</button>
                `;
                tutorHistoryContainer.appendChild(historyItem);
            });
            MathJax.typeset(); // Renderiza f√≥rmulas no hist√≥rico
        }

        // Remove uma entrada do hist√≥rico do tutor
        function removeTutorHistory(historyId) {
            tutorHistory = tutorHistory.filter(item => item.id !== historyId);
            localStorage.setItem('tutorHistory', JSON.stringify(tutorHistory));
            renderTutorHistory();
            showStatus('Entrada do hist√≥rico removida.', 'info');
        }

        // === FUN√á√ïES DE ARMAZENAMENTO E PDF ===
        function saveToLocalStorage() {
            localStorage.setItem('simpleQuestionsDB', JSON.stringify(questionsDatabase));
        }

        function loadFromLocalStorage() {
            const saved = localStorage.getItem('simpleQuestionsDB');
            if (saved) {
                questionsDatabase = JSON.parse(saved);
            }
        }

        // Gera o HTML para o arquivo PDF
        function generatePrintHTML() {
            const questionsSection = questionsDatabase.map((q, index) => {
                let optionsHTML = '';
                if (q.options && q.options.length > 0) {
                    optionsHTML = `<ul>${q.options.map(opt => `<li>${opt}</li>`).join('')}</ul>`;
                } else {
                    optionsHTML = '<p>R: ________________________________________________</p>';
                }
                return `
                    <div class="item">
                        <p><strong>${index + 1}.</strong> ${q.text}</p>
                        ${optionsHTML}
                    </div>
                `;
            }).join('');
            
            const answersSection = questionsDatabase.map((q, index) => `
                <div class="item">
                    <p><strong>Quest√£o ${index + 1}:</strong></p>
                    <p><strong>Resposta:</strong> ${q.correct_answer}</p>
                    <p><strong>Explica√ß√£o:</strong> ${q.explanation || 'N√£o fornecida.'}</p>
                </div>
            `).join('');

            return `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Lista de Quest√µes</title>
                    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
                    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
                    <style>
                        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
                        .page-title { text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 30px; }
                        .section-title { font-size: 1.5em; margin-top: 40px; }
                        .item { margin-bottom: 25px; }
                        .answers-section { page-break-before: always; }
                        ul { list-style-type: none; padding-left: 20px; }
                    </style>
                </head>
                <body>
                    <h1 class="page-title">Avalia√ß√£o / Lista de Exerc√≠cios</h1>
                    <h2 class="section-title">üìù Quest√µes</h2>
                    ${questionsSection}
                    <div class="answers-section">
                        <h2 class="section-title">‚úÖ Gabarito e Resolu√ß√µes</h2>
                        ${answersSection}
                    </div>
                    <script>
                        MathJax.typeset();
                    </script>
                </body>
                </html>
            `;
        }

        // Abre a janela de impress√£o para salvar como PDF
        function exportToPDF() {
            if (questionsDatabase.length === 0) {
                showStatus('N√£o h√° quest√µes para salvar em PDF.', 'error');
                return;
            }
            const printContent = generatePrintHTML();
            const printWindow = window.open('', '_blank');
            printWindow.document.write(printContent);
            printWindow.document.close();
            printWindow.focus();
            setTimeout(() => {
                printWindow.print();
            }, 500);
        }

        // === INICIALIZA√á√ÉO ===
        function initializeApp() {
            populateTopics();
            generateBtn.addEventListener('click', generateQuestions);
            pdfBtn.addEventListener('click', exportToPDF);
            clearBtn.addEventListener('click', clearAllQuestions);
            window.removeQuestion = removeQuestion;
            window.checkAnswer = checkAnswer;
            window.openTutorModal = openTutorModal;
            window.closeTutorModal = closeTutorModal;
            window.submitTutorQuestion = submitTutorQuestion;
            window.removeTutorHistory = removeTutorHistory;
            loadFromLocalStorage();
            loadTutorHistory();
            renderQuestions();
            renderTutorHistory();
        }
        
        initializeApp();
    </script>
</body>
</html>
