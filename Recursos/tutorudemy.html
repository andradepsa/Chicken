<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Gerador de Quest√µes e Quiz Matem√°tico</title>
    <!-- Script essencial para a IA funcionar -->
    <script src="https://js.puter.com/v2/"></script>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f2f5;
            color: #1c1e21;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 20px auto;
            background-color: #ffffff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        .login-container {
            max-width: 400px;
            margin: 100px auto;
            background-color: #ffffff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            text-align: center;
        }
        h1 {
            text-align: center;
            color: #333;
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 25px;
        }
        .user-info {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .user-info h3 {
            margin: 0;
            font-size: 18px;
        }
        .logout-btn {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }
        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
        }
        select, input[type="number"] {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border-radius: 6px;
            border: 1px solid #ccc;
            margin-bottom: 10px;
            box-sizing: border-box;
        }
        .main-button, .login-button {
            display: block;
            width: 100%;
            padding: 14px;
            font-size: 16px;
            font-weight: bold;
            color: #fff;
            background-color: #007bff;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 10px;
        }
        .main-button:disabled {
            background-color: #999;
            cursor: not-allowed;
        }
        .login-button {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            font-size: 18px;
            padding: 16px;
        }
        #status {
            text-align: center;
            padding: 10px;
            margin-top: 20px;
            border-radius: 6px;
            display: none;
        }
        .status-success { background-color: #d4edda; color: #155724; }
        .status-error { background-color: #f8d7da; color: #721c24; }
        .status-info { background-color: #cce5ff; color: #004085; }
        #questions-container {
            margin-top: 30px;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }
        .question-card {
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .question-text {
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 10px;
        }
        .question-options label {
            display: block;
            margin: 10px 0;
        }
        .question-answer {
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px dashed #ccc;
            display: none;
        }
        .remove-btn, .check-btn {
            background-color: #dc3545;
            color: white;
            padding: 5px 10px;
            font-size: 12px;
            border-radius: 4px;
            cursor: pointer;
            border: none;
            margin-left: 10px;
        }
        .check-btn {
            background-color: #28a745;
        }
        #actions-container {
            display: none;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #007bff;
            display: flex;
            gap: 15px;
        }
        .action-button {
            flex: 1;
            padding: 12px;
            font-size: 15px;
            font-weight: bold;
            color: #fff;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }
        .pdf-button { background-color: #28a745; }
        .clear-button { background-color: #6c757d; }
        .loading {
            text-align: center;
            padding: 50px;
            font-size: 18px;
            color: #666;
        }
    </style>
</head>
<body>
    <!-- Tela de Loading -->
    <div id="loading-screen" class="loading">
        <h2>Carregando...</h2>
        <p>Verificando autentica√ß√£o do usu√°rio...</p>
    </div>

    <!-- Tela de Login -->
    <div id="login-screen" class="login-container" style="display: none;">
        <h1>üîê Login Necess√°rio</h1>
        <p>Para usar o Gerador de Quest√µes e Quiz Matem√°tico, voc√™ precisa estar logado no Puter.</p>
        <button id="login-btn" class="login-button">üöÄ Fazer Login no Puter</button>
    </div>

    <!-- Aplica√ß√£o Principal -->
    <div id="main-app" class="container" style="display: none;">
        <!-- Informa√ß√µes do Usu√°rio -->
        <div id="user-info" class="user-info">
            <h3>üëã Bem-vindo, <span id="username"></span>!</h3>
            <button id="logout-btn" class="logout-btn">üö™ Sair</button>
        </div>

        <h1>Gerador de Quest√µes e Quiz Matem√°tico</h1>
        <p class="subtitle">Escolha um t√≥pico, tipo (perguntas ou quiz) e a quantidade de quest√µes.</p>

        <div>
            <select id="topic" onchange="updateSubtopics()">
                <option value="">Selecione um t√≥pico</option>
                <!-- T√≥picos ser√£o preenchidos via JavaScript -->
            </select>
            <select id="subtopic">
                <option value="">Selecione um subtema</option>
            </select>
            <select id="type">
                <option value="questions">Perguntas (Estudo)</option>
                <option value="quiz">Quiz Interativo</option>
            </select>
            <input type="number" id="quantity" min="1" max="10" placeholder="Quantidade de quest√µes (1-10)">
            <button id="generate-btn" class="main-button">üöÄ Gerar</button>
        </div>

        <div id="status"></div>
        
        <div id="actions-container">
            <button id="pdf-btn" class="action-button pdf-button">üìÑ Salvar em PDF</button>
            <button id="clear-btn" class="action-button clear-button">üóëÔ∏è Limpar Tudo</button>
        </div>

        <div id="questions-container">
            <p style="text-align:center; color:#888;">Suas quest√µes ou quiz aparecer√£o aqui.</p>
        </div>
    </div>

    <script>
        // === DADOS DA GRADE DE CONTE√öDOS ===
        const curriculum = [
            {
                section: "Se√ß√£o 1: O Mundo da Matem√°tica - Parte 1",
                topics: [
                    "Bem-vindo ao curso O Mundo da Matem√°tica!",
                    "O Teorema de Pit√°goras",
                    "O Teorema do Resto Chin√™s",
                    "O Teorema Fundamental da √Ålgebra",
                    "Desvendando a Estat√≠stica Descritiva",
                    "A Vida e Conquistas de Nikolai Lobachevsky",
                    "Os Segredos dos N√∫meros Primos de Mersenne",
                    "Probabilidade e Dados: Uma Jornada Matem√°tica",
                    "O Enigma de Goldbach: Mist√©rio Matem√°tico Antigo",
                    "S√©ries Num√©ricas Infinitas: Uma Jornada ao Infinito Matem√°tico",
                    "O Enigma de P versus NP: Explorando os Limites da Computa√ß√£o"
                ]
            },
            {
                section: "Se√ß√£o 2: O Mundo da Matem√°tica - Parte 2",
                topics: [
                    "O Problema do Caixeiro Viajante",
                    "Os Problemas de Otimiza√ß√£o Simples",
                    "Equa√ß√µes: Desafios e Solu√ß√µes Matem√°ticas!",
                    "Os Segredos da Trigonometria: Uma Jornada Matem√°tica",
                    "O Teorema do Valor Intermedi√°rio: Uma Jornada Matem√°tica",
                    "Fibonacci e a Magia na Natureza: Uma Jornada Matem√°tica",
                    "O Encanto dos N√∫meros Primos: Mist√©rio, Beleza e Utilidade",
                    "Matem√°tica Financeira para Todos: Simplificando o Complexo",
                    "Matem√°tica das Redes Sociais: Modelagem, An√°lise e Impacto",
                    "Explorando a Conjectura de Collatz: Uma Viagem pela Matem√°tica"
                ]
            },
            {
                section: "Se√ß√£o 3: O Mundo da Matem√°tica - Parte 3",
                topics: [
                    "Pit√°goras de Samos",
                    "Hist√≥ria da Matem√°tica: A Evolu√ß√£o do Conceito de Ponto",
                    "Aritm√©tica Elementar: Descobrindo Seu Poder e Aplica√ß√µes!",
                    "O Algoritmo RSA Fundamentos e Import√¢ncia na Criptografia",
                    "Ontologia e Exist√™ncia: A Natureza dos Pontos Matem√°ticos",
                    "Explorando a Topologia: A Matem√°tica das Formas e Espa√ßos",
                    "Os Enigmas Matem√°ticos: Uma Jornada de L√≥gica e Criatividade",
                    "A Beleza Oculta da Matem√°tica: Explorando o Universo com N√∫meros",
                    "John Nash e o Equil√≠brio de Nash: Revolucionando a Teoria dos Jogos",
                    "Os N√∫meros Primos e a Criptografia: Protegendo Dados na Era Digital"
                ]
            },
            {
                section: "Se√ß√£o 4: O Mundo da Matem√°tica - Parte 4",
                topics: [
                    "√Ålgebra: Da Teoria √† Pr√°tica",
                    "A Geometria Fractal na Natureza",
                    "A Geometria Fractal e Sua Beleza",
                    "A Magia dos Fractais Geom√©tricos",
                    "A Geometria Euclidiana: Fundamentos e Aplica√ß√µes",
                    "A Harmonia Oculta: Descobrindo a Matem√°tica na M√∫sica",
                    "A Fascinante Jornada dos N√∫meros Complexos na Matem√°tica",
                    "A Geometria do Universo: Explorando as Estruturas Cosmol√≥gicas",
                    "Tend√™ncias em Educa√ß√£o STEM: Realidade Aumentada, Rob√≥tica e Mais!",
                    "A Fascinante Hist√≥ria da Matem√°tica: De Civiliza√ß√µes Antigas √† Era Moderna"
                ]
            },
            {
                section: "Se√ß√£o 5: O Mundo da Matem√°tica - Parte 5",
                topics: [
                    "O Paradoxo do Barbeiro",
                    "Hist√≥ria da Matem√°tica Indiana",
                    "O Enigma dos N√∫meros Primos",
                    "O Mundo dos N√∫meros Perfeitos",
                    "A Beleza das Equa√ß√µes Diferenciais",
                    "A Matem√°tica por Tr√°s das Artes Visuais",
                    "Revolu√ß√£o na Educa√ß√£o IA e Matem√°tica",
                    "A Vida e o Legado de Srinivasa Ramanujan",
                    "A Fascinante Hist√≥ria da Conjectura de Collatz",
                    "Como a Intelig√™ncia Artificial Est√° Revolucionando a Matem√°tica"
                ]
            },
            {
                section: "Se√ß√£o 6: O Mundo da Matem√°tica - Parte 6",
                topics: [
                    "Descobrindo Padr√µes na Matem√°tica",
                    "Desvendando o Problema do Caixeiro Viajante",
                    "A Revolu√ß√£o da Matem√°tica Digital: Impactos e Inova√ß√µes",
                    "A Magia dos N√∫meros Irracionais: Uma Jornada Matem√°tica",
                    "Ubiratan D'Ambrosio: O Matem√°tico que Humanizou a Educa√ß√£o",
                    "A Matem√°tica √© Para os Fortes: Desvendando Mitos e Realidades",
                    "A Olimp√≠ada Internacional de Matem√°tica: Uma Jornada de G√™nios",
                    "Segredos da Criptografia Moderna: A Arte de Proteger Informa√ß√µes",
                    "A Teoria dos Conjuntos: Uma Jornada Matem√°tica com Georg Cantor",
                    "A Magia dos Fractais Geom√©tricos: Explorando Infinitas Complexidades"
                ]
            },
            {
                section: "Se√ß√£o 7: O Mundo da Matem√°tica - Parte 7",
                topics: [
                    "Paradoxos Matem√°ticos: De Zeno a Russell",
                    "A Quarta Dimens√£o: Explorando Hipercubos",
                    "A Hist√≥ria do Zero: Uma Revolu√ß√£o Matem√°tica",
                    "Como Vencer no Jogo da Velha com Matem√°tica",
                    "A Matem√°tica Por Tr√°s do Aprendizado de M√°quina",
                    "N√∫meros Complexos: Aplica√ß√µes Imagin√°rias e Reais",
                    "Explorando a Teoria dos Grafos: Conceitos e Aplica√ß√µes",
                    "A Hip√≥tese de Riemann: O Maior Mist√©rio da Matem√°tica",
                    "Explorando a Geometria N√£o Euclidiana: Uma Nova Perspectiva",
                    "A Matem√°tica do Crescimento Populacional: Entenda os Modelos Exponencial e Log√≠stico"
                ]
            },
            {
                section: "Se√ß√£o 8: O Mundo da Matem√°tica - Parte 8",
                topics: [
                    "John Playfair",
                    "Ada Lovelace",
                    "Isaac Newton",
                    "Thomas Bayes",
                    "Leonhard Euler",
                    "Girolamo Cardano",
                    "Hip√°tia de Alexandria",
                    "Pierre-Simon Laplace",
                    "Euclides de Alexandria",
                    "Joseph-Louis Lagrange"
                ]
            },
            {
                section: "Se√ß√£o 9: O Mundo da Matem√°tica - Parte 9",
                topics: [
                    "A Propor√ß√£o √Åurea: Est√©tica na Matem√°tica",
                    "A Identidade de Euler: A Equa√ß√£o Mais Bonita",
                    "Explorando os N√∫meros Primos e Suas Propriedades",
                    "A Beleza da Sequ√™ncia de Fibonacci e a Propor√ß√£o √Åurea",
                    "Matem√°tica na Vida Real: Aplica√ß√µes Pr√°ticas no Dia a Dia",
                    "Introdu√ß√£o √† Teoria dos Jogos e o Pensamento Estrat√©gico",
                    "Teoria do Caos e o Efeito Borboleta: Entenda a Complexidade",
                    "Criptografia: Como a Matem√°tica Mant√©m Seus Dados Seguros",
                    "A Matem√°tica dos Fractais e a Auto-Similaridade: Explorando Padr√µes Infinitos",
                    "A Beleza Matem√°tica da Natureza: Explorando a Geometria das Formas Naturais"
                ]
            },
            {
                section: "Se√ß√£o 10: O Mundo da Matem√°tica - Parte 10",
                topics: [
                    "Medalha Fields",
                    "O Enigma de Russell",
                    "Hip√≥tese de Riemann",
                    "Os Cortes de Dedekind",
                    "Paradoxo de Monty Hall",
                    "Paradoxo do Hotel de Hilbert",
                    "As Sete Pontes de K√∂nigsberg",
                    "Hist√≥ria da Teoria dos N√∫meros",
                    "A Vida e o Legado de Alan Turing",
                    "Provas Matem√°ticas: L√≥gica e Racioc√≠nio Desvendados"
                ]
            },
            {
                section: "Se√ß√£o 11: O Mundo da Matem√°tica - Parte 11",
                topics: [
                    "Os N√∫meros: A Linguagem Universal que Conecta o Mundo",
                    "C√°lculo Fracion√°rio: Novas Fronteiras na F√≠sica e Engenharia",
                    "Matem√°tica do Caos: Pequenos Desvios, Grandes Mudan√ßas",
                    "Matem√°tica Qu√¢ntica: Explorando Computa√ß√£o e F√≠sica Qu√¢ntica",
                    "Matem√°tica das Redes Neurais: Como Equa√ß√µes Modelam e Treinam",
                    "Matem√°tica Financeira e Criptomoedas: Modelos para Prever Flutua√ß√µes",
                    "Topologia e Ci√™ncias dos Dados: Analisando Grandes Conjuntos de Dados",
                    "Geometria Alg√©brica: Um campo em crescimento com aplica√ß√µes fascinantes",
                    "Intelig√™ncia Artificial e Machine Learning: Aplica√ß√µes de Matem√°tica Avan√ßada",
                    "Teoria da Complexidade Computacional: Entendendo a Efici√™ncia dos Algoritmos"
                ]
            },
            {
                section: "Se√ß√£o 12: O Mundo da Matem√°tica - Parte 12",
                topics: [
                    "A Conjectura de Poincar√©",
                    "O Papel da Simetria na Matem√°tica",
                    "Explorando a Topologia: A Forma do Espa√ßo",
                    "Como Funciona o GPS: Matem√°tica na Navega√ß√£o",
                    "Otimiza√ß√£o Matem√°tica: A Arte de Resolver Problemas",
                    "A Matem√°tica da M√∫sica e do Som: Descubra a Conex√£o!",
                    "O Legado de Fibonacci: A Dan√ßa dos N√∫meros e da Natureza",
                    "Como Economistas Usam a Matem√°tica para Prever Mercados",
                    "Entendendo a Probabilidade: Dados, Cartas e Eventos Aleat√≥rios",
                    "A Matem√°tica Por Tr√°s da F√≠sica Qu√¢ntica: Desvendando os Mist√©rios do Universo"
                ]
            },
            {
                section: "Se√ß√£o 13: O Mundo da Matem√°tica - Parte 13",
                topics: [
                    "A Jornada de Leibniz",
                    "O Paradoxo de Zeno",
                    "A Matem√°tica Est√° em Tudo!",
                    "Tend√™ncias em Educa√ß√£o STEM",
                    "Desenvolvendo a Intui√ß√£o Matem√°tica: Guia Completo",
                    "Os Sete Desafios Matem√°ticos de Um Milh√£o de D√≥lares",
                    "Matem√°ticos Americanos Not√°veis e Suas Contribui√ß√µes",
                    "Matem√°tica Aplicada √† Gen√¥mica: Decifrando Dados Gen√©ticos",
                    "Grigori Perelman: O G√™nio que Resolveu a Conjectura de Poincar√©",
                    "Teoria dos N√∫meros em Criptografia: Como a Matem√°tica Protege Seus Dados"
                ]
            },
            {
                section: "Se√ß√£o 14: O Mundo da Matem√°tica - Parte 14",
                topics: [
                    "Sequ√™ncia de Estudos",
                    "Algoritmos",
                    "Teoria de Grupos",
                    "Teoria dos N√∫meros",
                    "Conjunto de Mandelbrot",
                    "Estat√≠stica na Medicina e Pesquisa",
                    "Intelig√™ncia Artificial e Matem√°tica",
                    "A matem√°tica foi inventada ou criada?",
                    "Explorando a Topologia: A Forma do Espa√ßo",
                    "Por Que a Matem√°tica Prediz T√£o Bem o Futuro",
                    "Como Matrizes S√£o Usadas em Gr√°ficos Computacionais"
                ]
            },
            {
                section: "Se√ß√£o 15: O Mundo da Matem√°tica - Parte 15",
                topics: [
                    "Teorema Binomial",
                    "C√≥digo Matem√°tico",
                    "Recurs√£o e Matem√°tica",
                    "A sequ√™ncia de Fibonacci",
                    "Caleidosc√≥pio da Matem√°tica",
                    "Como Usar Geometria no Dia a Dia",
                    "A import√¢ncia dos pequenos passos",
                    "A Matem√°tica da Explora√ß√£o Espacial",
                    "A Matem√°tica da Criptografia Computacional",
                    "Entendendo Estruturas Alg√©bricas: Grupos, An√©is e Corpos"
                ]
            },
            {
                section: "Se√ß√£o 16: O Mundo da Matem√°tica - Parte 16",
                topics: [
                    "Sistemas Din√¢micos e Caos",
                    "Grigori Yakovlevich Perelman",
                    "Geometria Anal√≠tica e Vetores",
                    "Teoria da Medida e Integra√ß√£o",
                    "An√°lise Funcional e Operadores",
                    "F√≠sica Matem√°tica e Modelagem",
                    "Teoria da Informa√ß√£o e Codifica√ß√£o",
                    "L√≥gica Fuzzy e Sistemas Nebulosos",
                    "Matem√°tica Computacional e Simula√ß√£o",
                    "Modelos Estoc√°sticos e Processos Aleat√≥rios"
                ]
            },
            {
                section: "Se√ß√£o 17: O Mundo da Matem√°tica - Parte 17",
                topics: [
                    "An√°lise Real e Complexa",
                    "Teoria de Galois e Equa√ß√µes",
                    "An√°lise de S√©ries Temporais",
                    "C√°lculo Variacional e Otimiza√ß√£o",
                    "Transformadas de Fourier e Laplace",
                    "Processamento de Imagens e Sinais",
                    "Modelagem Matem√°tica em Biologia",
                    "Matem√°tica em Intelig√™ncia Artificial",
                    "Equa√ß√µes Diferenciais com Retardamento",
                    "Modelagem Matem√°tica em Epidemiologia"
                ]
            },
            {
                section: "Se√ß√£o 18: O Mundo da Matem√°tica - Parte 18",
                topics: [
                    "An√°lise de Dados",
                    "Infra√ß√£o Temporal",
                    "A filosofia do Ponto",
                    "Hist√≥ria da Geometria",
                    "Modelagem Matem√°tica",
                    "√Ålgebra Linear e Matricial",
                    "Din√¢mica dos Fluidos e Equa√ß√µes",
                    "Teoria de Aproxima√ß√£o e Interpola√ß√£o",
                    "Matem√°tica de Redes Neurais: O C√©rebro das M√°quinas",
                    "Combinat√≥ria e An√°lise Enumerativa: Explorando o Fasc√≠nio da Contagem"
                ]
            },
            {
                section: "Se√ß√£o 19: O Mundo da Matem√°tica - Parte 19",
                topics: [
                    "Teoria dos N√∫meros Primos",
                    "L√≥gica Matem√°tica e Provas",
                    "Lev Semenovich Pontryagin",
                    "C√°lculo Diferencial e Integral",
                    "Teoria dos Conjuntos e Fun√ß√µes",
                    "Matem√°tica Recreativa e Paradoxos",
                    "Matem√°tica Discreta e Combinat√≥ria",
                    "Geometria Euclidiana e N√£o-Euclidiana",
                    "Equa√ß√µes Diferenciais Parciais e Ordin√°rias",
                    "A Matem√°tica da Internet: Algoritmos e Dados"
                ]
            },
            {
                section: "Se√ß√£o 20: O Mundo da Matem√°tica - Parte 20",
                topics: [
                    "Infra√ß√£o Temporal",
                    "A hist√≥ria do Zero",
                    "Caleidosc√≥pio da Matem√°tica",
                    "Explorando a Quinta Dimens√£o",
                    "O feedback eficaz na Avalia√ß√£o Matem√°tica",
                    "Estat√≠stica Bayesiana e Infer√™ncia",
                    "Teoria de Sistemas e Controle",
                    "Leviat√£ da Matem√°tica",
                    "Os Matem√°ticos",
                    "PSA"
                ]
            },
            {
                section: "Se√ß√£o 21: O Mundo da Matem√°tica - Parte 21",
                topics: [
                    "Educa√ß√£o Matem√°tica",
                    "Conceitos b√°sicos de educa√ß√£o matem√°tica",
                    "Papel do educador na promo√ß√£o da aprendizagem matem√°tica",
                    "Hist√≥ria da educa√ß√£o matem√°tica",
                    "Principais teorias da aprendizagem aplicadas √† matem√°tica",
                    "Construtivismo, socioculturalismo, e outras abordagens relevantes",
                    "Implica√ß√µes das teorias da aprendizagem na pr√°tica pedag√≥gica",
                    "Abordagens pr√°ticas para promover a participa√ß√£o ativa dos alunos",
                    "Aprendizagem baseada em problemas",
                    "Aprendizagem colaborativa e cooperativa",
                    "Uso de tecnologias digitais e ferramentas online para o ensino",
                    "Softwares educacionais e aplicativos m√≥veis",
                    "Ensino h√≠brido e aprendizagem online em matem√°tica",
                    "Tipos de avalia√ß√£o em matem√°tica: formativa, somativa, diagn√≥stica",
                    "Desafios e estrat√©gias para avaliar habilidades matem√°ticas",
                    "Feedback eficaz na avalia√ß√£o matem√°tica"
                ]
            }
        ];

        // === VARI√ÅVEIS GLOBAIS ===
        let questionsDatabase = [];
        let currentUser = null;
        const topicSelect = document.getElementById('topic');
        const subtopicSelect = document.getElementById('subtopic');
        const typeSelect = document.getElementById('type');
        const quantityInput = document.getElementById('quantity');
        const generateBtn = document.getElementById('generate-btn');
        const statusDiv = document.getElementById('status');
        const questionsContainer = document.getElementById('questions-container');
        const actionsContainer = document.getElementById('actions-container');
        const pdfBtn = document.getElementById('pdf-btn');
        const clearBtn = document.getElementById('clear-btn');

        // === ELEMENTOS DA INTERFACE ===
        const loadingScreen = document.getElementById('loading-screen');
        const loginScreen = document.getElementById('login-screen');
        const mainApp = document.getElementById('main-app');
        const loginBtn = document.getElementById('login-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const usernameSpan = document.getElementById('username');

        // === FUN√á√ïES DE AUTENTICA√á√ÉO ===
        
        // Verifica se o usu√°rio est√° autenticado
        async function checkAuthentication() {
            try {
                const user = await puter.auth.getUser();
                if (user && user.username) {
                    currentUser = user;
                    showMainApp();
                    return true;
                } else {
                    showLoginScreen();
                    return false;
                }
            } catch (error) {
                console.log('Usu√°rio n√£o autenticado:', error);
                showLoginScreen();
                return false;
            }
        }

        // Faz o login do usu√°rio
        async function loginUser() {
            try {
                loginBtn.textContent = 'Fazendo login...';
                loginBtn.disabled = true;
                
                const user = await puter.auth.signIn();
                if (user && user.username) {
                    currentUser = user;
                    showMainApp();
                    showStatus('Login realizado com sucesso!', 'success');
                }
            } catch (error) {
                console.error('Erro no login:', error);
                showStatus('Erro ao fazer login. Tente novamente.', 'error');
            } finally {
                loginBtn.textContent = 'üöÄ Fazer Login no Puter';
                loginBtn.disabled = false;
            }
        }

        // Faz o logout do usu√°rio
        async function logoutUser() {
            try {
                await puter.auth.signOut();
                currentUser = null;
                questionsDatabase = [];
                showLoginScreen();
                showStatus('Logout realizado com sucesso!', 'info');
            } catch (error) {
                console.error('Erro no logout:', error);
                showStatus('Erro ao fazer logout.', 'error');
            }
        }

        // === FUN√á√ïES DE INTERFACE ===
        
        function showLoadingScreen() {
            loadingScreen.style.display = 'block';
            loginScreen.style.display = 'none';
            mainApp.style.display = 'none';
        }

        function showLoginScreen() {
            loadingScreen.style.display = 'none';
            loginScreen.style.display = 'block';
            mainApp.style.display = 'none';
        }

        function showMainApp() {
            loadingScreen.style.display = 'none';
            loginScreen.style.display = 'none';
            mainApp.style.display = 'block';
            
            if (currentUser) {
                usernameSpan.textContent = currentUser.username;
                loadUserData();
            }
        }

        // === FUN√á√ïES DE ARMAZENAMENTO POR USU√ÅRIO ===
        
        // Salva os dados do usu√°rio no Puter
        async function saveUserData() {
            if (!currentUser) return;
            
            try {
                const dataToSave = {
                    questions: questionsDatabase,
                    lastUpdated: new Date().toISOString()
                };
                
                await puter.fs.write(
                    `math-quiz-${currentUser.username}.json`,
                    JSON.stringify(dataToSave),
                    { overwrite: true }
                );
            } catch (error) {
                console.error('Erro ao salvar dados do usu√°rio:', error);
                // Fallback para localStorage se falhar
                const storageKey = `math-quiz-${currentUser.username}`;
                localStorage.setItem(storageKey, JSON.stringify(questionsDatabase));
            }
        }

        // Carrega os dados do usu√°rio do Puter
        async function loadUserData() {
            if (!currentUser) return;
            
            try {
                const fileContent = await puter.fs.read(`math-quiz-${currentUser.username}.json`);
                const userData = JSON.parse(fileContent);
                
                if (userData && userData.questions) {
                    questionsDatabase = userData.questions;
                    renderQuestions();
                }
            } catch (error) {
                console.log('Arquivo de dados n√£o encontrado, criando novo...');
                // Fallback para localStorage se o arquivo n√£o existir
                try {
                    const storageKey = `math-quiz-${currentUser.username}`;
                    const saved = localStorage.getItem(storageKey);
                    if (saved) {
                        questionsDatabase = JSON.parse(saved);
                        renderQuestions();
                        // Migra para o Puter
                        await saveUserData();
                        localStorage.removeItem(storageKey);
                    }
                } catch (fallbackError) {
                    console.log('Iniciando com dados vazios');
                    questionsDatabase = [];
                }
            }
        }

        // === FUN√á√ïES DE L√ìGICA ===

        // Preenche o dropdown de t√≥picos
        function populateTopics() {
            curriculum.forEach((section, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = section.section;
                topicSelect.appendChild(option);
            });
        }

        // Atualiza o dropdown de subtemas com base no t√≥pico selecionado
        function updateSubtopics() {
            const sectionIndex = topicSelect.value;
            subtopicSelect.innerHTML = '<option value="">Selecione um subtema</option>';
            if (sectionIndex !== "") {
                curriculum[sectionIndex].topics.forEach(topic => {
                    const option = document.createElement('option');
                    option.value = topic;
                    option.textContent = topic;
                    subtopicSelect.appendChild(option);
                });
            }
        }

        // Mostra uma mensagem para o usu√°rio
        function showStatus(message, type = 'info') {
            statusDiv.textContent = message;
            statusDiv.className = `status-${type}`;
            statusDiv.style.display = 'block';
        }

        // Gera um ID √∫nico para cada quest√£o
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        // Fun√ß√£o principal que gera as quest√µes ou quiz
        async function generateQuestions() {
            const subtopic = subtopicSelect.value;
            const type = typeSelect.value;
            const quantity = parseInt(quantityInput.value);

            if (!subtopic) {
                showStatus('Por favor, selecione um subtema.', 'error');
                return;
            }
            if (!quantity || quantity < 1 || quantity > 10) {
                showStatus('Por favor, insira uma quantidade v√°lida (1-10).', 'error');
                return;
            }

            generateBtn.disabled = true;
            generateBtn.textContent = 'Gerando...';
            showStatus('Gerando conte√∫do. Aguarde...', 'info');

            try {
                const finalPrompt = `
                    Voc√™ √© um especialista em criar material educacional de matem√°tica. Gere ${quantity} quest√µes baseadas no t√≥pico "${subtopic}".
                    TIPO: ${type === 'questions' ? 'Perguntas para estudo (m√∫ltipla escolha ou verdadeiro/falso, com respostas e explica√ß√µes)' : 'Quiz interativo (m√∫ltipla escolha ou verdadeiro/falso, com respostas e explica√ß√µes)'}.
                    REGRAS DE FORMATA√á√ÉO:
                    Responda APENAS com um objeto JSON:
                    {
                      "questions": [
                        {
                          "text": "Texto da quest√£o.",
                          "options": ["A) Op√ß√£o 1", "B) Op√ß√£o 2", "C) Op√ß√£o 3", "D) Op√ß√£o 4"],
                          "correct_answer": "A letra ou texto da resposta correta.",
                          "explanation": "Explica√ß√£o da resposta correta."
                        }
                      ]
                    }
                    - Para verdadeiro/falso, use ["Verdadeiro", "Falso"].
                    - As quest√µes devem ser claras e educacionais.
                `;
                
                const response = await puter.ai.chat([{ role: 'user', content: finalPrompt }]);
                
                if (!response || !response.message || !response.message.content) {
                    throw new Error('A IA n√£o retornou uma resposta v√°lida.');
                }

                const jsonStart = response.message.content.indexOf('{');
                const jsonEnd = response.message.content.lastIndexOf('}') + 1;
                const jsonString = response.message.content.substring(jsonStart, jsonEnd);
                const parsed = JSON.parse(jsonString);

                const newQuestions = parsed.questions ? parsed.questions.map(q => ({ ...q, id: generateId(), type })) : [];

                if (newQuestions.length > 0) {
                    questionsDatabase.unshift(...newQuestions);
                    await saveUserData();
                    renderQuestions();
                    showStatus(`${newQuestions.length} quest√£o(√µes) gerada(s) com sucesso!`, 'success');
                } else {
                    throw new Error('N√£o foi poss√≠vel extrair quest√µes da resposta da IA.');
                }

            } catch (error) {
                console.error('Erro na gera√ß√£o:', error);
                showStatus(`Ocorreu um erro: ${error.message}`, 'error');
            } finally {
                generateBtn.disabled = false;
                generateBtn.textContent = 'üöÄ Gerar';
            }
        }

        // Exibe as quest√µes na tela
        function renderQuestions() {
            if (questionsDatabase.length === 0) {
                questionsContainer.innerHTML = '<p style="text-align:center; color:#888;">Nenhuma quest√£o ou quiz gerado.</p>';
                actionsContainer.style.display = 'none';
                return;
            }

            actionsContainer.style.display = 'flex';
            questionsContainer.innerHTML = '';
            questionsDatabase.forEach(q => {
                const card = document.createElement('div');
                card.className = 'question-card';
                let optionsHTML = '';
                if (q.options && q.options.length > 0) {
                    if (q.type === 'quiz') {
                        optionsHTML = `<div class="question-options">`;
                        q.options.forEach((opt, index) => {
                            optionsHTML += `
                                <label>
                                    <input type="radio" name="answer-${q.id}" value="${opt}"> ${opt}
                                </label>`;
                        });
                        optionsHTML += `</div>`;
                    } else {
                        optionsHTML = `<div class="question-options"><ul>${q.options.map(opt => `<li>${opt}</li>`).join('')}</ul></div>`;
                    }
                }

                card.innerHTML = `
                    <button class="remove-btn" onclick="removeQuestion('${q.id}')">Remover</button>
                    ${q.type === 'quiz' ? `<button class="check-btn" onclick="checkAnswer('${q.id}')">Verificar Resposta</button>` : ''}
                    <div class="question-text">${q.text}</div>
                    ${optionsHTML}
                    <div class="question-answer" id="answer-${q.id}">
                        <strong>Resposta:</strong> ${q.correct_answer}<br>
                        <strong>Explica√ß√£o:</strong> ${q.explanation || 'N√£o fornecida.'}
                    </div>
                `;
                questionsContainer.appendChild(card);
            });
        }

        // Verifica a resposta no modo quiz
        function checkAnswer(questionId) {
            const question = questionsDatabase.find(q => q.id === questionId);
            const selectedOption = document.querySelector(`input[name="answer-${questionId}"]:checked`);
            const answerDiv = document.getElementById(`answer-${questionId}`);
            
            if (!selectedOption) {
                showStatus('Por favor, selecione uma op√ß√£o.', 'error');
                return;
            }

            answerDiv.style.display = 'block';
            if (selectedOption.value === question.correct_answer) {
                showStatus('Correto! Veja a explica√ß√£o abaixo.', 'success');
            } else {
                showStatus('Incorreto. Veja a resposta correta e a explica√ß√£o abaixo.', 'error');
            }
        }

        // Remove uma quest√£o da lista
        async function removeQuestion(questionId) {
            questionsDatabase = questionsDatabase.filter(q => q.id !== questionId);
            await saveUserData();
            renderQuestions();
            showStatus('Quest√£o removida.', 'info');
        }

        // Limpa todas as quest√µes da lista
        async function clearAllQuestions() {
            if (confirm('Tem certeza que deseja apagar TODAS as quest√µes?')) {
                questionsDatabase = [];
                await saveUserData();
                renderQuestions();
                showStatus('Lista limpa.', 'info');
            }
        }

        // === FUN√á√ïES DE PDF ===

        // Gera o HTML para o arquivo PDF
        function generatePrintHTML() {
            const questionsSection = questionsDatabase.map((q, index) => {
                let optionsHTML = '';
                if (q.options && q.options.length > 0) {
                    optionsHTML = `<ul>${q.options.map(opt => `<li>${opt}</li>`).join('')}</ul>`;
                } else {
                    optionsHTML = '<p>R: ________________________________________________</p>';
                }
                return `
                    <div class="item">
                        <p><strong>${index + 1}.</strong> ${q.text}</p>
                        ${optionsHTML}
                    </div>
                `;
            }).join('');
            
            const answersSection = questionsDatabase.map((q, index) => `
                <div class="item">
                    <p><strong>Quest√£o ${index + 1}:</strong></p>
                    <p><strong>Resposta:</strong> ${q.correct_answer}</p>
                    <p><strong>Explica√ß√£o:</strong> ${q.explanation || 'N√£o fornecida.'}</p>
                </div>
            `).join('');

            return `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Lista de Quest√µes - ${currentUser ? currentUser.username : 'Usu√°rio'}</title>
                    <style>
                        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
                        .page-title { text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 30px; }
                        .user-info { text-align: center; margin-bottom: 20px; color: #666; }
                        .section-title { font-size: 1.5em; margin-top: 40px; }
                        .item { margin-bottom: 25px; }
                        .answers-section { page-break-before: always; }
                        ul { list-style-type: none; padding-left: 20px; }
                    </style>
                </head>
                <body>
                    <h1 class="page-title">Avalia√ß√£o / Lista de Exerc√≠cios</h1>
                    <p class="user-info">Usu√°rio: ${currentUser ? currentUser.username : 'N/A'} | Data: ${new Date().toLocaleDateString('pt-BR')}</p>
                    <h2 class="section-title">üìù Quest√µes</h2>
                    ${questionsSection}
                    <div class="answers-section">
                        <h2 class="section-title">‚úÖ Gabarito e Resolu√ß√µes</h2>
                        ${answersSection}
                    </div>
                </body>
                </html>
            `;
        }

        // Abre a janela de impress√£o para salvar como PDF
        function exportToPDF() {
            if (questionsDatabase.length === 0) {
                showStatus('N√£o h√° quest√µes para salvar em PDF.', 'error');
                return;
            }
            const printContent = generatePrintHTML();
            const printWindow = window.open('', '_blank');
            printWindow.document.write(printContent);
            printWindow.document.close();
            printWindow.focus();
            setTimeout(() => {
                printWindow.print();
            }, 500);
        }

        // === INICIALIZA√á√ÉO ===
        async function initializeApp() {
            // Mostra tela de loading
            showLoadingScreen();
            
            // Configura eventos
            loginBtn.addEventListener('click', loginUser);
            logoutBtn.addEventListener('click', logoutUser);
            generateBtn.addEventListener('click', generateQuestions);
            pdfBtn.addEventListener('click', exportToPDF);
            clearBtn.addEventListener('click', clearAllQuestions);
            
            // Torna as fun√ß√µes globais
            window.removeQuestion = removeQuestion;
            window.checkAnswer = checkAnswer;
            window.updateSubtopics = updateSubtopics;
            
            // Preenche os t√≥picos
            populateTopics();
            
            // Verifica autentica√ß√£o
            await checkAuthentication();
        }
        
        // Inicia a aplica√ß√£o quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
