<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Gerador de Biografias</title>
    <script src="https://js.puter.com/v2/"></script>
    <style>
        body { font-family: Arial, sans-serif; background: #667eea; color: #333; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; }
        h1 { text-align: center; margin-bottom: 30px; }
        .search { display: flex; gap: 10px; margin-bottom: 20px; }
        input { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 5px; }
        button { padding: 12px 20px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; text-align: center; display: none; }
        .status.error { background: #f8d7da; color: #721c24; }
        .status.info { background: #cce5ff; color: #004085; }
        .status.success { background: #d4edda; color: #155724; }
        .bio { margin-top: 20px; display: none; }
        .info { background: #f8f9fa; border: 2px solid #667eea; border-radius: 8px; padding: 20px; margin-bottom: 20px; display: grid; grid-template-columns: 1fr 150px; gap: 15px; }
        .photo { width: 150px; height: 180px; background: #667eea; color: white; display: flex; align-items: center; justify-content: center; font-size: 36px; font-weight: bold; border-radius: 8px; }
        .photo img { width: 100%; height: 100%; object-fit: cover; border-radius: 8px; }
        h3 { color: #667eea; margin: 0 0 10px 0; }
        .item { margin-bottom: 8px; }
        .label { font-weight: bold; }
        .bio-text p { margin-bottom: 10px; text-align: justify; }
        @media (max-width: 600px) { .info { grid-template-columns: 1fr; text-align: center; } }
    </style>
</head>
<body>
    <div class="container">
        <h1>📚 Biografias</h1>
        <div class="search">
            <input id="input" placeholder="Digite o nome de uma pessoa...">
            <button onclick="generate()">Gerar</button>
        </div>
        <div id="status" class="status"></div>
        <div id="bio" class="bio"></div>
    </div>

    <script>
        const input = document.getElementById('input');
        const status = document.getElementById('status');
        const bio = document.getElementById('bio');

        function show(msg, type) {
            status.textContent = msg;
            status.className = `status ${type}`;
            status.style.display = 'block';
        }

        async function generate() {
            const name = input.value.trim();
            if (!name) return show('Digite um nome', 'error');

            show('Gerando...', 'info');
            bio.style.display = 'none';

            try {
                if (!puter || !puter.ai) throw new Error('Serviço indisponível');

                const response = await puter.ai.chat([{
                    role: 'user',
                    content: `Crie uma biografia acadêmica completa e detalhada para: ${name}

A biografia deve seguir este modelo acadêmico com 5-6 parágrafos extensos:

1º PARÁGRAFO: Nascimento, família, contexto social, primeiros anos, educação inicial
2º PARÁGRAFO: Formação acadêmica/profissional, primeiras experiências, descobertas iniciais  
3º PARÁGRAFO: Principais realizações, obras, teorias, contribuições mais importantes
4º PARÁGRAFO: Contexto histórico da época, influências recebidas e exercidas sobre outros
5º PARÁGRAFO: Legado, impacto na posteridade, reconhecimento, morte (se aplicável)
6º PARÁGRAFO: Curiosidades, aspectos pessoais menos conhecidos, outras atividades

Responda APENAS com JSON limpo:
{"name":"Nome completo","born":"DD de mês de AAAA","born_place":"Cidade, País","died":"DD de mês de AAAA ou Ainda vivo","died_place":"Cidade, País ou N/A","summary":"Resumo de uma linha sobre suas principais contribuições","bio":"Biografia acadêmica completa com 6 parágrafos extensos de pelo menos 4-5 frases cada, escrita em linguagem erudita como enciclopédia universitária"}

Se não existir: {"error":"NOT_FOUND"}`
                }]);

                let content = response.message.content.trim();
                
                // Limpa o conteúdo
                content = content.replace(/```json|```/g, '');
                content = content.replace(/[\n\r\t]/g, ' ');
                content = content.replace(/\s+/g, ' ');
                
                const start = content.indexOf('{');
                const end = content.lastIndexOf('}') + 1;
                
                if (start === -1) throw new Error('JSON não encontrado');
                
                let jsonStr = content.substring(start, end);
                
                // Remove caracteres problemáticos
                jsonStr = jsonStr.replace(/[\x00-\x1F\x7F]/g, '');
                
                const data = JSON.parse(jsonStr);
                
                if (data.error) return show('Pessoa não encontrada', 'error');

                const initials = data.name.split(' ').map(n => n[0]).join('').substring(0, 2);
                const photoId = 'photo' + Date.now();
                
                bio.innerHTML = `
                    <h2>${data.name}</h2>
                    <div class="info">
                        <div>
                            <h3>Informações</h3>
                            <div class="item"><span class="label">Nascimento:</span> ${data.born}</div>
                            <div class="item"><span class="label">Local:</span> ${data.born_place}</div>
                            ${data.died !== 'Vivo' ? `<div class="item"><span class="label">Morte:</span> ${data.died}</div>` : ''}
                            ${data.died_place !== 'N/A' ? `<div class="item"><span class="label">Local:</span> ${data.died_place}</div>` : ''}
                            <div class="item"><span class="label">Resumo:</span> ${data.summary}</div>
                        </div>
                        <div class="photo" id="${photoId}">${initials}</div>
                    </div>
                    <div class="bio-text">
                        <h3>Biografia</h3>
                        ${data.bio.replace(/(\. )([A-Z])/g, '.</p><p>$2').split('<p>').map(p => p.trim() ? `<p>${p.replace('</p>', '')}</p>` : '').join('')}
                    </div>
                `;
                
                bio.style.display = 'block';
                show('Sucesso!', 'success');
                
                // Foto melhorada
                const photoEl = document.getElementById(photoId);
                loadPhoto(data.name, photoEl);

            } catch (error) {
                show('Erro: ' + error.message, 'error');
            }
        }

        async function loadPhoto(personName, photoElement) {
            const queries = [
                personName,
                personName.replace(/\s+de\s+/g, ' '),
                personName.split(' ').slice(0, 2).join(' ')
            ];

            for (const query of queries) {
                try {
                    const response = await fetch(`https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(query)}`);
                    if (response.ok) {
                        const data = await response.json();
                        if (data.thumbnail?.source) {
                            const img = new Image();
                            img.onload = () => {
                                photoElement.innerHTML = `<img src="${data.thumbnail.source}" alt="${personName}">`;
                            };
                            img.onerror = () => {
                                console.log('Erro ao carregar:', data.thumbnail.source);
                            };
                            img.src = data.thumbnail.source;
                            return;
                        }
                    }
                } catch (e) {
                    console.log('Tentativa falhou:', query);
                }
            }
            
            // Tenta Wikipedia em português
            try {
                const response = await fetch(`https://pt.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(personName)}`);
                if (response.ok) {
                    const data = await response.json();
                    if (data.thumbnail?.source) {
                        const img = new Image();
                        img.onload = () => {
                            photoElement.innerHTML = `<img src="${data.thumbnail.source}" alt="${personName}">`;
                        };
                        img.src = data.thumbnail.source;
                    }
                }
            } catch (e) {
                console.log('Wikipedia PT falhou');
            }
        }

        input.addEventListener('keypress', e => e.key === 'Enter' && generate());
        input.focus();
    </script>
</body>
</html>
