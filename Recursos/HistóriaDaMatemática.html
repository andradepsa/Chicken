<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Gerador de Biografias</title>
    <!-- Script essencial para a IA funcionar -->
    <script src="https://js.puter.com/v2/"></script>
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #1c1e21;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 20px auto;
            background-color: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        
        h1 {
            text-align: center;
            color: #333;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1rem;
            line-height: 1.6;
        }
        
        .search-section {
            background: rgba(102, 126, 234, 0.1);
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            border: 1px solid rgba(102, 126, 234, 0.2);
        }
        
        .search-input {
            width: 100%;
            padding: 15px;
            font-size: 16px;
            border-radius: 8px;
            border: 2px solid #e1e5e9;
            box-sizing: border-box;
            outline: none;
            transition: all 0.3s ease;
        }
        
        .search-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .main-button {
            display: block;
            width: 100%;
            padding: 15px;
            font-size: 16px;
            font-weight: bold;
            color: #fff;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s ease;
        }
        
        .main-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .main-button:disabled {
            background: #999;
            cursor: not-allowed;
            transform: none;
        }
        
        #status {
            text-align: center;
            padding: 15px;
            margin-top: 20px;
            border-radius: 8px;
            display: none;
        }
        
        .status-success { background-color: #d4edda; color: #155724; }
        .status-error { background-color: #f8d7da; color: #721c24; }
        .status-info { background-color: #cce5ff; color: #004085; }
        
        .biography-container {
            margin-top: 30px;
            display: none;
        }
        
        .biography-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            border-left: 5px solid #667eea;
        }
        
        .mathematician-header {
            display: flex;
            gap: 30px;
            margin-bottom: 30px;
            align-items: flex-start;
        }
        
        .mathematician-photo {
            flex-shrink: 0;
            width: 200px;
            height: 250px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            object-fit: cover;
            border: 3px solid #fff;
            background: #f0f2f5;
            overflow: hidden;
        }
        
        .photo-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            font-size: 18px;
            text-align: center;
            border-radius: 7px;
        }
        
        .loading-photo {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 10px auto;
        }
        
        .mathematician-info {
            flex: 1;
        }
        
        .mathematician-name {
            font-size: 2.2rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
        }
        
        .basic-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .info-item {
            display: flex;
            margin-bottom: 10px;
        }
        
        .info-label {
            font-weight: bold;
            color: #667eea;
            min-width: 140px;
        }
        
        .info-value {
            color: #333;
        }
        
        .biography-content {
            line-height: 1.8;
            color: #444;
        }
        
        .biography-section {
            margin-bottom: 25px;
        }
        
        .section-title {
            font-size: 1.4rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 15px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 5px;
        }
        
        .contributions-list {
            list-style: none;
            padding: 0;
        }
        
        .contributions-list li {
            background: rgba(102, 126, 234, 0.1);
            padding: 10px 15px;
            margin-bottom: 8px;
            border-radius: 5px;
            border-left: 3px solid #667eea;
        }
        
        .timeline-item {
            padding: 15px;
            border-left: 3px solid #667eea;
            margin-bottom: 15px;
            background: rgba(102, 126, 234, 0.05);
            border-radius: 0 8px 8px 0;
        }
        
        .timeline-year {
            font-weight: bold;
            color: #667eea;
            font-size: 1.1rem;
        }
        
        .timeline-event {
            margin-top: 5px;
            color: #444;
        }
        
        .clear-button {
            background: #6c757d;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            float: right;
            margin-top: 10px;
        }
        
        .clear-button:hover {
            background: #5a6268;
        }
        
        .examples-section {
            background: rgba(40, 167, 69, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid rgba(40, 167, 69, 0.2);
        }
        
        .example-queries {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .example-query {
            background: white;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid #ddd;
        }
        
        .example-query:hover {
            background: #f8f9fa;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .photo-error {
            font-size: 12px;
            color: #dc3545;
            margin-top: 5px;
        }

        .photo-retry-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
            margin-top: 5px;
        }

        .photo-retry-btn:hover {
            background: #218838;
        }

        .suggestions-container {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            display: none;
        }

        .suggestions-title {
            color: #856404;
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .suggestions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .suggestion-item {
            background: white;
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid #ddd;
            text-align: center;
            font-weight: 500;
        }

        .suggestion-item:hover {
            background: #f8f9fa;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-color: #667eea;
        }

        .auto-complete-container {
            position: relative;
            width: 100%;
        }

        .auto-complete-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .auto-complete-item {
            padding: 12px 15px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
            transition: background-color 0.3s ease;
        }

        .auto-complete-item:hover,
        .auto-complete-item.selected {
            background-color: #f8f9fa;
        }

        .auto-complete-item:last-child {
            border-bottom: none;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .mathematician-header {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }
            .mathematician-photo {
                width: 150px;
                height: 190px;
            }
            .example-queries {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>📚 Gerador de Biografias</h1>
        <p class="subtitle">
            Descubra a vida e a obra de personalidades notáveis da história. 
            Digite o nome de qualquer pessoa e obtenha uma biografia completa e detalhada.
        </p>

        <div class="examples-section">
            <h3 style="margin-top: 0; color: #28a745;">💡 Exemplos de Pesquisa</h3>
            <p>Clique em um exemplo ou digite o nome de qualquer pessoa que desejar:</p>
            <div class="example-queries">
                <div class="example-query" onclick="fillExample('Leonardo da Vinci')">🎨 Leonardo da Vinci</div>
                <div class="example-query" onclick="fillExample('Marie Curie')">🔬 Marie Curie</div>
                <div class="example-query" onclick="fillExample('Santos Dumont')">✈️ Santos Dumont</div>
                <div class="example-query" onclick="fillExample('Pelé')">⚽ Pelé</div>
                <div class="example-query" onclick="fillExample('Clarice Lispector')">✍️ Clarice Lispector</div>
                <div class="example-query" onclick="fillExample('Nelson Mandela')">🕊️ Nelson Mandela</div>
            </div>
        </div>

        <div class="search-section">
            <div class="auto-complete-container">
                <input type="text" id="person-input" class="search-input" 
                       placeholder="Digite o nome de qualquer pessoa (ex: Albert Einstein, Cleópatra...)" autocomplete="off">
                <div id="auto-complete-suggestions" class="auto-complete-suggestions"></div>
            </div>
            <button id="generate-btn" class="main-button">🔍 Gerar Biografia Completa</button>
        </div>
        
        <div id="status"></div>
        
        <div id="suggestions-container" class="suggestions-container">
            <div class="suggestions-title">🤔 Talvez você quis dizer:</div>
            <div id="suggestions-grid" class="suggestions-grid"></div>
        </div>
        
        <div class="biography-container" id="biography-container">
            <!-- A biografia gerada aparecerá aqui -->
        </div>
    </div>

    <script>
        // === VARIÁVEIS GLOBAIS ===
        const generateBtn = document.getElementById('generate-btn');
        const personInput = document.getElementById('person-input');
        const statusDiv = document.getElementById('status');
        const biographyContainer = document.getElementById('biography-container');
        const suggestionsContainer = document.getElementById('suggestions-container');
        const suggestionsGrid = document.getElementById('suggestions-grid');
        const autoCompleteSuggestions = document.getElementById('auto-complete-suggestions');

        let currentSuggestionIndex = -1;
        let autoCompleteTimeout = null;

        // === BASE DE DADOS DE PESSOAS FAMOSAS ===
        const famousPeople = [
            // Cientistas
            'Albert Einstein', 'Marie Curie', 'Isaac Newton', 'Charles Darwin', 'Galileu Galilei', 
            'Nikola Tesla', 'Stephen Hawking', 'Leonardo da Vinci', 'Aristoteles', 'Platão',
            
            // Políticos e Líderes
            'Nelson Mandela', 'Mahatma Gandhi', 'Winston Churchill', 'Abraham Lincoln', 'John F. Kennedy',
            'Cleopatra', 'Julio César', 'Napoleon Bonaparte', 'George Washington', 'Martin Luther King Jr.',
            
            // Artistas e Escritores
            'William Shakespeare', 'Pablo Picasso', 'Vincent van Gogh', 'Frida Kahlo', 'Mozart',
            'Beethoven', 'Michelangelo', 'Clarice Lispector', 'Machado de Assis', 'Oscar Wilde',
            
            // Brasileiros
            'Santos Dumont', 'Pelé', 'Ayrton Senna', 'Carmen Miranda', 'Caetano Veloso',
            'Gilberto Gil', 'Chico Buarque', 'Tarsila do Amaral', 'Oscar Niemeyer', 'Ronaldinho',
            
            // Inventores e Empresários
            'Thomas Edison', 'Steve Jobs', 'Bill Gates', 'Henry Ford', 'Alexander Graham Bell',
            
            // Filósofos
            'Socrates', 'Confucio', 'Friedrich Nietzsche', 'Immanuel Kant', 'Jean-Paul Sartre',
            
            // Exploradores
            'Cristovão Colombo', 'Vasco da Gama', 'Marco Polo', 'Fernão de Magalhães',
            
            // Outros
            'Anne Frank', 'Mother Teresa', 'Walt Disney', 'Coco Chanel', 'Marilyn Monroe'
        ];

        // === FUNÇÕES AUXILIARES ===
        function showStatus(message, type = 'info') {
            statusDiv.textContent = message;
            statusDiv.className = `status-${type}`;
            statusDiv.style.display = 'block';
            suggestionsContainer.style.display = 'none';
        }
        
        function fillExample(name) {
            personInput.value = name;
            personInput.focus();
            hideAutoComplete();
            hideSuggestions();
        }

        function hideSuggestions() {
            suggestionsContainer.style.display = 'none';
        }

        function hideAutoComplete() {
            autoCompleteSuggestions.style.display = 'none';
            currentSuggestionIndex = -1;
        }

        // === FUNÇÕES DE SUGESTÃO ===
        function calculateDistance(str1, str2) {
            const matrix = [];
            const len1 = str1.length;
            const len2 = str2.length;

            for (let i = 0; i <= len2; i++) {
                matrix[i] = [i];
            }

            for (let j = 0; j <= len1; j++) {
                matrix[0][j] = j;
            }

            for (let i = 1; i <= len2; i++) {
                for (let j = 1; j <= len1; j++) {
                    if (str2.charAt(i - 1) === str1.charAt(j - 1)) {
                        matrix[i][j] = matrix[i - 1][j - 1];
                    } else {
                        matrix[i][j] = Math.min(
                            matrix[i - 1][j - 1] + 1,
                            matrix[i][j - 1] + 1,
                            matrix[i - 1][j] + 1
                        );
                    }
                }
            }

            return matrix[len2][len1];
        }

        function findSimilarNames(input, maxSuggestions = 6) {
            const inputLower = input.toLowerCase().trim();
            if (inputLower.length < 2) return [];

            const suggestions = [];
            
            for (const person of famousPeople) {
                const personLower = person.toLowerCase();
                const distance = calculateDistance(inputLower, personLower);
                const maxLen = Math.max(inputLower.length, personLower.length);
                const similarity = 1 - (distance / maxLen);
                
                // Inclui se tem similaridade > 0.4 ou se contém as palavras
                if (similarity > 0.4 || 
                    personLower.includes(inputLower) || 
                    inputLower.split(' ').every(word => personLower.includes(word))) {
                    suggestions.push({
                        name: person,
                        similarity: similarity,
                        distance: distance
                    });
                }
            }

            return suggestions
                .sort((a, b) => b.similarity - a.similarity)
                .slice(0, maxSuggestions)
                .map(s => s.name);
        }

        function showSuggestions(suggestions) {
            if (suggestions.length === 0) {
                suggestionsContainer.style.display = 'none';
                return;
            }

            suggestionsGrid.innerHTML = suggestions
                .map(name => `
                    <div class="suggestion-item" onclick="selectSuggestion('${name}')">
                        ${name}
                    </div>
                `).join('');

            suggestionsContainer.style.display = 'block';
        }

        function selectSuggestion(name) {
            personInput.value = name;
            hideSuggestions();
            hideAutoComplete();
            generateBiography();
        }

        function showAutoComplete(suggestions) {
            if (suggestions.length === 0) {
                hideAutoComplete();
                return;
            }

            autoCompleteSuggestions.innerHTML = suggestions
                .map((name, index) => `
                    <div class="auto-complete-item" onclick="selectSuggestion('${name}')" data-index="${index}">
                        ${name}
                    </div>
                `).join('');

            autoCompleteSuggestions.style.display = 'block';
        }

        // === FUNÇÃO PRINCIPAL ===
        async function generateBiography() {
            const personName = personInput.value.trim();
            if (!personName) {
                showStatus('Por favor, digite o nome de uma pessoa.', 'error');
                return;
            }

            generateBtn.disabled = true;
            generateBtn.textContent = 'Pesquisando...';
            showStatus('Coletando informações... Isso pode levar um momento.', 'info');
            biographyContainer.style.display = 'none';
            hideSuggestions();
            hideAutoComplete();

            try {
                const prompt = `
                Você é um biógrafo e historiador especialista. Sua tarefa é criar uma biografia detalhada e factualmente precisa sobre a seguinte pessoa: "${personName}".

                Se a pessoa não existir, for desconhecida, ou se o nome estiver claramente incorreto, responda com um JSON contendo apenas:
                {
                  "error": "PERSON_NOT_FOUND",
                  "message": "Pessoa não encontrada ou nome incorreto"
                }

                Caso contrário, responda **EXCLUSIVAMENTE** com um objeto JSON válido no seguinte formato. Não inclua texto ou explicações antes ou depois do JSON.

                {
                  "name": "Nome completo e correto da pessoa",
                  "birth_date": "Data de nascimento (DD/MM/AAAA)",
                  "birth_place": "Local de nascimento (Cidade, País)",
                  "death_date": "Data da morte (DD/MM/AAAA) ou 'Ainda vivo(a)'",
                  "death_place": "Local da morte ou 'N/A' se vivo(a)",
                  "nationality": "Nacionalidade(s)",
                  "main_areas": ["Área 1 de atuação", "Área 2 de atuação"],
                  "biography": "Uma biografia rica e detalhada (mínimo de 3 parágrafos) cobrindo sua vida, carreira, realizações importantes e legado. O texto deve ser bem escrito e envolvente.",
                  "major_contributions": [
                    "Primeira contribuição ou feito principal, com uma breve explicação.",
                    "Segundo feito principal, com uma breve explicação.",
                    "Terceiro feito principal, com uma breve explicação."
                  ],
                  "timeline": [
                    {"year": "AAAA", "event": "Um evento marcante na vida ou carreira."},
                    {"year": "AAAA", "event": "Outro evento importante."},
                    {"year": "AAAA", "event": "Mais um evento cronológico."}
                  ],
                  "curiosities": [
                    "Uma curiosidade ou fato interessante sobre a pessoa.",
                    "Outra curiosidade."
                  ]
                }

                Instruções Importantes:
                - Verifique as informações para garantir precisão. Se uma informação não estiver disponível, use "Informação não disponível".
                - A biografia deve ter um tom educativo e ser acessível a um público geral.
                - Se houver qualquer dúvida sobre a existência da pessoa, prefira retornar o erro.
                `;

                const response = await puter.ai.chat([{ role: 'user', content: prompt }]);
                
                if (!response || !response.message || !response.message.content) {
                    throw new Error('A IA não retornou uma resposta válida.');
                }

                const content = response.message.content;
                const jsonStart = content.indexOf('{');
                const jsonEnd = content.lastIndexOf('}') + 1;
                if (jsonStart === -1 || jsonEnd === 0) {
                    throw new Error('A resposta da IA não continha um JSON válido.');
                }
                const jsonString = content.substring(jsonStart, jsonEnd);
                const biographyData = JSON.parse(jsonString);

                // Verifica se é um erro (pessoa não encontrada)
                if (biographyData.error === 'PERSON_NOT_FOUND') {
                    showStatus('Pessoa não encontrada. Veja as sugestões abaixo:', 'error');
                    const suggestions = findSimilarNames(personName, 8);
                    showSuggestions(suggestions);
                    return;
                }

                displayBiography(biographyData);
                showStatus('Biografia gerada com sucesso!', 'success');

            } catch (error) {
                console.error('Erro na geração:', error);
                
                // Em caso de erro, também mostra sugestões
                showStatus(`Erro ao gerar biografia. Veja as sugestões abaixo:`, 'error');
                const suggestions = findSimilarNames(personName, 8);
                if (suggestions.length > 0) {
                    showSuggestions(suggestions);
                } else {
                    // Se não há sugestões, mostra algumas pessoas famosas aleatórias
                    const randomSuggestions = famousPeople
                        .sort(() => 0.5 - Math.random())
                        .slice(0, 6);
                    showSuggestions(randomSuggestions);
                }
            } finally {
                generateBtn.disabled = false;
                generateBtn.textContent = '🔍 Gerar Biografia Completa';
            }
        }

        // === FUNÇÃO DE EXIBIÇÃO ===
        function displayBiography(data) {
            const photoId = `photo-${Date.now()}`;
            const biographyHTML = `
                <div class="biography-card">
                    <button class="clear-button" onclick="clearBiography()">Limpar Biografia</button>
                    
                    <div class="mathematician-header">
                        <div class="mathematician-photo" id="${photoId}">
                            <div class="photo-placeholder">
                                <div class="loading-photo"></div>
                                <div>Procurando foto...</div>
                            </div>
                        </div>
                        
                        <div class="mathematician-info">
                            <h2 class="mathematician-name">${data.name || 'Nome não encontrado'}</h2>
                            
                            <div class="basic-info">
                                <div class="info-item">
                                    <span class="info-label">📅 Nascimento:</span>
                                    <span class="info-value">${data.birth_date || 'N/A'} em ${data.birth_place || 'N/A'}</span>
                                </div>
                                ${data.death_date && !data.death_date.toLowerCase().includes('vivo') ? `
                                <div class="info-item">
                                    <span class="info-label">⚰️ Falecimento:</span>
                                    <span class="info-value">${data.death_date || 'N/A'} em ${data.death_place || 'N/A'}</span>
                                </div>
                                ` : ''}
                                <div class="info-item">
                                    <span class="info-label">🌍 Nacionalidade:</span>
                                    <span class="info-value">${data.nationality || 'N/A'}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">🏆 Atuação:</span>
                                    <span class="info-value">${(data.main_areas || []).join(', ')}</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="biography-content">
                        ${data.biography ? `
                        <div class="biography-section">
                            <div class="section-title">📖 Biografia</div>
                            <p>${data.biography.replace(/\n/g, '<br>')}</p>
                        </div>` : ''}

                        ${data.major_contributions && data.major_contributions.length > 0 ? `
                        <div class="biography-section">
                            <div class="section-title">🏆 Principais Feitos</div>
                            <ul class="contributions-list">
                                ${data.major_contributions.map(contrib => `<li>${contrib}</li>`).join('')}
                            </ul>
                        </div>` : ''}

                        ${data.timeline && data.timeline.length > 0 ? `
                        <div class="biography-section">
                            <div class="section-title">📅 Linha do Tempo</div>
                            ${data.timeline.map(item => `
                                <div class="timeline-item">
                                    <div class="timeline-year">${item.year}</div>
                                    <div class="timeline-event">${item.event}</div>
                                </div>
                            `).join('')}
                        </div>` : ''}

                        ${data.curiosities && data.curiosities.length > 0 ? `
                        <div class="biography-section">
                            <div class="section-title">🔍 Curiosidades</div>
                            <ul class="contributions-list">
                                ${data.curiosities.map(curiosity => `<li>${curiosity}</li>`).join('')}
                            </ul>
                        </div>` : ''}
                    </div>
                </div>
            `;

            biographyContainer.innerHTML = biographyHTML;
            biographyContainer.style.display = 'block';
            window.scrollTo({ top: biographyContainer.offsetTop - 20, behavior: 'smooth' });
            
            loadPersonPhoto(data.name, photoId);
        }

        // === FUNÇÃO MELHORADA PARA CARREGAR FOTOS ===
        async function loadPersonPhoto(personName, photoElementId) {
            const photoElement = document.getElementById(photoElementId);
            if (!photoElement) {
                console.error('Elemento da foto não encontrado:', photoElementId);
                return;
            }

            console.log(`Tentando carregar foto para: ${personName}`);
            
            // Array de diferentes fontes de imagem para tentar
            const imageSources = [
                () => tryWikipediaAPI(personName),
                () => tryWikipediaDirectSearch(personName),
                () => tryWikimediaCommons(personName)
            ];

            let photoLoaded = false;
            let attemptCount = 0;

            for (const sourceFunction of imageSources) {
                if (photoLoaded) break;
                
                attemptCount++;
                updatePhotoStatus(photoElement, `Tentativa ${attemptCount}/3...`);
                
                try {
                    const imageUrl = await sourceFunction();
                    if (imageUrl) {
                        const success = await loadImageWithFallback(imageUrl, personName, photoElement);
                        if (success) {
                            photoLoaded = true;
                            console.log(`Foto carregada com sucesso na tentativa ${attemptCount}:`, imageUrl);
                        }
                    }
                } catch (error) {
                    console.warn(`Erro na tentativa ${attemptCount} para ${personName}:`, error.message);
                }
                
                // Pequena pausa entre tentativas
                if (!photoLoaded && attemptCount < imageSources.length) {
                    await new Promise(resolve => setTimeout(resolve, 500));
                }
            }

            if (!photoLoaded) {
                console.log(`Nenhuma foto encontrada para ${personName}, usando placeholder`);
                showCustomPlaceholder(personName, photoElementId, 'Foto não encontrada');
            }
        }

        // === MÉTODOS DE BUSCA DE IMAGENS ===
        async function tryWikipediaAPI(personName) {
            console.log('Tentando Wikipedia API...');
            
            // Tenta múltiplas variações do nome
            const nameVariations = [
                personName,
                personName.replace(/\s+/g, '_'),
                personName.split(' ').join('_')
            ];

            for (const name of nameVariations) {
                try {
                    const url = `https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(name)}`;
                    console.log('URL da Wikipedia:', url);
                    
                    const response = await fetch(url, {
                        headers: {
                            'User-Agent': 'BiographyGenerator/1.0 (https://biography-generator.com)'
                        }
                    });
                    
                    if (!response.ok) {
                        throw new Error(`Status ${response.status}: ${response.statusText}`);
                    }
                    
                    const data = await response.json();
                    console.log('Resposta da Wikipedia:', data);
                    
                    if (data.thumbnail && data.thumbnail.source) {
                        return data.thumbnail.source.replace(/\/\d+px-/, '/300px-'); // Aumenta resolução
                    }
                } catch (error) {
                    console.warn(`Erro com variação "${name}":`, error.message);
                }
            }
            
            return null;
        }

        async function tryWikipediaDirectSearch(personName) {
            console.log('Tentando busca direta Wikipedia...');
            
            try {
                const searchUrl = `https://en.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(personName)}&format=json&origin=*`;
                
                const searchResponse = await fetch(searchUrl);
                if (!searchResponse.ok) throw new Error('Falha na busca');
                
                const searchData = await searchResponse.json();
                
                if (searchData.query && searchData.query.search && searchData.query.search.length > 0) {
                    const firstResult = searchData.query.search[0];
                    return await tryWikipediaAPI(firstResult.title);
                }
            } catch (error) {
                console.warn('Erro na busca direta:', error.message);
            }
            
            return null;
        }

        async function tryWikimediaCommons(personName) {
            console.log('Tentando Wikimedia Commons...');
            
            try {
                const searchUrl = `https://commons.wikimedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(personName)}&srnamespace=6&format=json&origin=*`;
                
                const response = await fetch(searchUrl);
                if (!response.ok) throw new Error('Falha no Wikimedia Commons');
                
                const data = await response.json();
                
                if (data.query && data.query.search && data.query.search.length > 0) {
                    const fileName = data.query.search[0].title;
                    const imageUrl = `https://commons.wikimedia.org/wiki/Special:FilePath/${encodeURIComponent(fileName)}?width=300`;
                    return imageUrl;
                }
            } catch (error) {
                console.warn('Erro no Wikimedia Commons:', error.message);
            }
            
            return null;
        }

        // === FUNÇÃO PARA CARREGAR IMAGEM COM FALLBACK ===
        async function loadImageWithFallback(imageUrl, personName, photoElement) {
            return new Promise((resolve) => {
                const img = new Image();
                
                img.onload = () => {
                    console.log('Imagem carregada com sucesso:', imageUrl);
                    photoElement.innerHTML = `
                        <img src="${imageUrl}" 
                             alt="Foto de ${personName}" 
                             style="width: 100%; height: 100%; object-fit: cover; border-radius: 7px;"
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <div class="photo-placeholder" style="display: none;">
                            <div style="font-size: 48px; font-weight: bold;">${getInitials(personName)}</div>
                            <div style="font-size: 12px; opacity: 0.8;">Erro ao carregar</div>
                        </div>
                    `;
                    resolve(true);
                };
                
                img.onerror = (error) => {
                    console.warn('Erro ao carregar imagem:', imageUrl, error);
                    resolve(false);
                };
                
                // Timeout de 10 segundos
                setTimeout(() => {
                    console.warn('Timeout ao carregar imagem:', imageUrl);
                    resolve(false);
                }, 10000);
                
                img.src = imageUrl;
            });
        }

        // === FUNÇÕES AUXILIARES ===
        function updatePhotoStatus(photoElement, message) {
            photoElement.innerHTML = `
                <div class="photo-placeholder">
                    <div class="loading-photo"></div>
                    <div>${message}</div>
                </div>
            `;
        }

        function getInitials(name) {
            return name.split(' ')
                      .map(n => n[0])
                      .join('')
                      .substring(0, 2)
                      .toUpperCase();
        }

        function showCustomPlaceholder(name, elementId, message = 'Foto não encontrada') {
            const photoElement = document.getElementById(elementId);
            if (!photoElement) return;

            const initials = getInitials(name);
            const colors = ['#667eea', '#764ba2', '#f093fb', '#4facfe', '#43e97b', '#fa709a'];
            const color = colors[name.length % colors.length];

            photoElement.innerHTML = `
                <div class="photo-placeholder" style="background: ${color};">
                    <div style="font-size: 48px; font-weight: bold;">${initials}</div>
                    <div style="font-size: 12px; opacity: 0.8; margin-top: 5px;">${message}</div>
                    <button class="photo-retry-btn" onclick="retryPhotoLoad('${name}', '${elementId}')">
                        Tentar novamente
                    </button>
                </div>
            `;
        }

        function retryPhotoLoad(personName, photoElementId) {
            console.log('Tentando recarregar foto para:', personName);
            loadPersonPhoto(personName, photoElementId);
        }

        function clearBiography() {
            biographyContainer.style.display = 'none';
            biographyContainer.innerHTML = '';
            personInput.value = '';
            statusDiv.style.display = 'none';
            hideSuggestions();
            hideAutoComplete();
            personInput.focus();
        }
        
        // === INICIALIZAÇÃO E EVENTOS ===
        generateBtn.addEventListener('click', generateBiography);
        
        personInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                if (currentSuggestionIndex >= 0) {
                    const suggestions = Array.from(autoCompleteSuggestions.children);
                    if (suggestions[currentSuggestionIndex]) {
                        const name = suggestions[currentSuggestionIndex].textContent;
                        selectSuggestion(name);
                        return;
                    }
                }
                generateBiography();
            }
        });

        // Auto-complete enquanto digita
        personInput.addEventListener('input', function(e) {
            const input = e.target.value.trim();
            
            if (autoCompleteTimeout) {
                clearTimeout(autoCompleteTimeout);
            }
            
            if (input.length < 2) {
                hideAutoComplete();
                return;
            }
            
            autoCompleteTimeout = setTimeout(() => {
                const suggestions = findSimilarNames(input, 5);
                showAutoComplete(suggestions);
            }, 300);
        });

        // Navegação com teclado no auto-complete
        personInput.addEventListener('keydown', function(e) {
            const suggestions = Array.from(autoCompleteSuggestions.children);
            
            if (suggestions.length === 0) return;
            
            if (e.key === 'ArrowDown') {
                e.preventDefault();
                currentSuggestionIndex = Math.min(currentSuggestionIndex + 1, suggestions.length - 1);
                updateSuggestionSelection(suggestions);
            } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                currentSuggestionIndex = Math.max(currentSuggestionIndex - 1, -1);
                updateSuggestionSelection(suggestions);
            } else if (e.key === 'Escape') {
                hideAutoComplete();
            }
        });

        function updateSuggestionSelection(suggestions) {
            suggestions.forEach((item, index) => {
                item.classList.toggle('selected', index === currentSuggestionIndex);
            });
        }

        // Clica fora para fechar
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.auto-complete-container')) {
                hideAutoComplete();
            }
            if (!e.target.closest('.suggestions-container') && !e.target.closest('.search-section')) {
                hideSuggestions();
            }
        });

        // Torna as funções disponíveis globalmente
        window.fillExample = fillExample;
        window.clearBiography = clearBiography;
        window.retryPhotoLoad = retryPhotoLoad;
        window.selectSuggestion = selectSuggestion;

        personInput.focus();
    </script>
</body>
</html>
