<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Gerador de Artigo Cient√≠fico com IA do Puter</title>
    <script src="https://js.puter.com/v2/"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Arial&display=swap');
        body { background-color: #e0e0e0; font-family: Arial, sans-serif; padding: 20px; }
        .main-container { display: flex; justify-content: center; align-items: flex-start; gap: 20px; }
        
        @page {
            size: A4;
            margin-top: 3cm; margin-bottom: 2cm; margin-left: 3cm; margin-right: 2cm;
            @bottom-center { content: element(footer); font-family: Arial, sans-serif; font-size: 10pt; color: #000; text-align: center; }
        }
        #footer { position: running(footer); font-family: Arial, sans-serif; font-size: 10pt; text-align: center; width: 100%; display: none; }

        @media print {
            body { background-color: #fff; padding: 0; margin: 0; }
            .control-panel, #reference-modal, #topic-suggestion-modal, #save-controls { display: none !important; }
            .page-container { box-shadow: none; margin: 0; padding: 0; width: 100%; min-height: auto; border: none; }
            .email-autor { display: none !important; }
            #footer { display: block; }
        }
        
        .control-panel { position: sticky; top: 20px; width: 400px; background: #f9f9f9; padding: 20px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); z-index: 10; }
        .control-panel h2 { margin-top: 0; text-align: center; color: #333; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-group input, .form-group button { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: 14px; }
        .control-panel button { background-color: #1a73e8; color: white; font-weight: bold; cursor: pointer; }
        .control-panel button:hover:not(:disabled) { filter: brightness(90%); }
        .control-panel button:disabled { background-color: #999; cursor: not-allowed; }
        
        #interactive-controls button { margin-top: 10px; }
        #startSectionBtn { background-color: #1a73e8; } /* Azul para Iniciar */
        #developSectionBtn { background-color: #28a745; } /* Verde para Desenvolver */
        #endSectionBtn { background-color: #fd7e14; } /* Laranja para Concluir */
        #finishBtn { background-color: #dc3545; } /* Vermelho para Finalizar Artigo */

        #status { font-weight: bold; text-align: center; margin-top: 10px; min-height: 20px; font-size: 12px; padding: 10px; border-radius: 4px; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background-color: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        
        .page-container { width: 21cm; min-height: 29.7cm; padding: 3cm 2cm 2cm 3cm; background: white; box-shadow: 0 0 10px rgba(0,0,0,0.5); box-sizing: border-box; }
        .abnt-content { font-family: Arial, sans-serif; font-size: 12pt; line-height: 1.5; text-align: justify; }
        .abnt-content p { margin-bottom: 1.5em; cursor: pointer; text-indent: 1.25cm; line-height: 1.5; text-align: justify; }
        .abnt-content p:hover { background-color: #f0f8ff; }
        .section-title { font-weight: bold; text-transform: uppercase; text-align: left; font-size: 12pt; margin-top: 2em; margin-bottom: 1em; }

        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 100; justify-content: center; align-items: center; }
        .modal-content { background: white; padding: 20px; border-radius: 8px; width: 700px; max-height: 80vh; overflow-y: auto; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="control-panel">
            <div id="initial-form">
                <h2>üéì Gerador de Artigo ABNT</h2>
                <p style="text-align:center; font-size:12px; margin-top:-10px; margin-bottom:20px; color:#6f42c1;"><strong>Powered by Puter.ai</strong></p>
                
                <div class="form-group"><label>Universidade:</label><input id="universidade" type="text" value="Universidade Federal"></div>
                <div class="form-group"><label>T√≠tulo do Trabalho:</label><input id="titulo" type="text" placeholder="Escreva um tema, mesmo que com erros"></div>
                <div class="form-group"><label>Autor(es):</label><input id="autor" type="text" placeholder="Nome Sobrenome"></div>
                <div class="form-group"><label>Email do Autor:</label><input id="email" type="email" value="seu.email@exemplo.com"></div>
                <button id="startBtn">üöÄ Iniciar e Otimizar Tema</button>
            </div>
            
            <div id="interactive-controls" style="display: none;">
                <h2>üìù Escrevendo: <strong id="current-section-name"></strong></h2>
                <button id="startSectionBtn">‚ñ∂Ô∏è Iniciar Se√ß√£o</button>
                <button id="developSectionBtn">‚ûï Desenvolver Ideia</button>
                <button id="endSectionBtn">üèÅ Concluir Se√ß√£o</button>
                <button id="finishBtn" style="display: none;">‚úÖ Finalizar Artigo</button>
                <div style="text-align: center; margin-top: 10px; font-size: 11px; color: #666;">üí° Clique nos par√°grafos para adicionar refer√™ncias</div>
            </div>

            <div id="save-controls" style="margin-top: 20px; border-top: 1px solid #ccc; padding-top: 15px;"><button id="savePdfBtn">üìÑ Salvar como PDF</button></div>
            <div id="status" class="info">üéØ Preencha os dados e clique em "Iniciar"</div>
        </div>
        
        <div class="page-container">
            <div class="abnt-content" id="content-output"><!-- Conte√∫do Gerado --></div>
            <div id="footer"></div>
        </div>
        
        <!-- Modais (refer√™ncias e sugest√£o de tema) aqui -->
    </div>

    <script>
        // --- ELEMENTOS DA UI ---
        const elements = {
            // Bot√µes de controle
            startBtn: document.getElementById('startBtn'),
            startSectionBtn: document.getElementById('startSectionBtn'),
            developSectionBtn: document.getElementById('developSectionBtn'),
            endSectionBtn: document.getElementById('endSectionBtn'),
            finishBtn: document.getElementById('finishBtn'),
            savePdfBtn: document.getElementById('savePdfBtn'),
            // Divs e Spans
            outputDiv: document.getElementById('content-output'),
            statusDiv: document.getElementById('status'),
            currentSectionNameSpan: document.getElementById('current-section-name'),
            initialForm: document.getElementById('initial-form'),
            interactiveControls: document.getElementById('interactive-controls'),
        };

        // --- ESTADO DA APLICA√á√ÉO ---
        let userInputs = {};
        let articleContent = { introducao: [], desenvolvimento: [], conclusao: [] };
        let finalReferences = []; 
        let currentSection = 'introducao';
        const sectionOrder = ['introducao', 'desenvolvimento', 'conclusao'];
        const sectionDisplayNames = { 'introducao': 'Introdu√ß√£o', 'desenvolvimento': 'Desenvolvimento', 'conclusao': 'Conclus√£o' };

        // --- FUN√á√ïES DE GERA√á√ÉO E L√ìGICA PRINCIPAL (resumidas para clareza) ---
        async function callPuterAI(prompt) {
            try {
                log('ü§ñ Gerando conte√∫do com a IA...', 'info');
                const response = await puter.ai.chat([{ role: 'user', content: prompt }]);
                if (!response || !response.message || !response.message.content) throw new Error('Resposta inv√°lida da IA.');
                return response.message.content.trim();
            } catch (error) {
                log(`‚ùå Erro na IA: ${error.message || 'Erro desconhecido.'}`, 'error');
                throw error;
            }
        }
        
        function log(message, type = 'info') {
            const icons = { success: '‚úÖ', error: '‚ùå', warning: '‚ö†Ô∏è', info: '‚ÑπÔ∏è' };
            elements.statusDiv.className = type;
            elements.statusDiv.innerHTML = `<div>${icons[type] || '‚ÑπÔ∏è'} ${message}</div>`;
        }

        // --- L√ìGICA DE CONTROLE DA UI INTERATIVA ---
        function updateInteractiveUIState(state) {
            const { startSectionBtn, developSectionBtn, endSectionBtn } = elements;
            startSectionBtn.disabled = true;
            developSectionBtn.disabled = true;
            endSectionBtn.disabled = true;

            switch (state) {
                case 'ready_to_start_section':
                    startSectionBtn.disabled = false;
                    log(`Pronto para iniciar a se√ß√£o: ${sectionDisplayNames[currentSection]}`, 'info');
                    break;
                case 'developing_section':
                    developSectionBtn.disabled = false;
                    endSectionBtn.disabled = false;
                    log(`Desenvolvendo a se√ß√£o. Adicione par√°grafos ou conclua.`, 'info');
                    break;
                case 'section_concluded':
                    // Todos ficam desabilitados enquanto a pr√≥xima se√ß√£o √© preparada
                    log(`Se√ß√£o "${sectionDisplayNames[currentSection]}" conclu√≠da!`, 'success');
                    break;
                case 'article_finished':
                    elements.interactiveControls.style.display = 'none';
                    elements.finishBtn.style.display = 'block';
                    log('üéì Artigo conclu√≠do! Gere o resumo e salve em PDF.', 'success');
                    break;
            }
        }

        // --- BOT√ÉO: INICIAR O PROCESSO GERAL ---
        elements.startBtn.addEventListener('click', async () => {
            userInputs = {
                titulo: document.getElementById('titulo').value,
                autor: document.getElementById('autor').value
                //... outros campos
            };
            if (!userInputs.titulo || !userInputs.autor) {
                log('‚ùå Preencha t√≠tulo e autor.', 'error');
                return;
            }
            elements.startBtn.disabled = true;
            
            // Simula a otimiza√ß√£o de tema e o in√≠cio do artigo
            elements.initialForm.style.display = 'none';
            elements.interactiveControls.style.display = 'block';
            elements.currentSectionNameSpan.textContent = sectionDisplayNames[currentSection];
            updateInteractiveUIState('ready_to_start_section');
        });

        // --- BOT√ÉO: INICIAR SE√á√ÉO (IN√çCIO) ---
        elements.startSectionBtn.addEventListener('click', async () => {
            updateInteractiveUIState('loading'); // Desabilita tudo temporariamente
            
            const prompt = `Escreva o par√°grafo INICIAL e introdut√≥rio para a se√ß√£o de "${sectionDisplayNames[currentSection]}" de um artigo sobre "${userInputs.titulo}". O par√°grafo deve apresentar o que ser√° discutido nesta se√ß√£o de forma clara e concisa. Tamanho ideal: 80-120 palavras.`;
            
            try {
                const content = await callPuterAI(prompt);
                articleContent[currentSection].push(content);
                displayABNTDocument(); // Fun√ß√£o para renderizar o HTML
                updateInteractiveUIState('developing_section');
            } catch (error) {
                updateInteractiveUIState('ready_to_start_section'); // Volta ao estado anterior em caso de erro
            }
        });

        // --- BOT√ÉO: DESENVOLVER IDEIA (MEIO) ---
        elements.developSectionBtn.addEventListener('click', async () => {
            updateInteractiveUIState('loading');

            const lastTwoParagraphs = articleContent[currentSection].slice(-2).join(' ');
            const prompt = `
                Voc√™ √© um escritor acad√™mico. Sua tarefa √© escrever o PR√ìXIMO par√°grafo para a se√ß√£o de "${sectionDisplayNames[currentSection]}" de um artigo sobre "${userInputs.titulo}".

                **Contexto (√öltimos par√°grafos):** "${lastTwoParagraphs}"

                **INSTRU√á√ÉO CR√çTICA:** Evite a repeti√ß√£o de estruturas iniciais. N√ÉO comece o par√°grafo com "Al√©m de...", "Adicionalmente...", "Outro aspecto...", ou sin√¥nimos. Crie uma transi√ß√£o original e um in√≠cio de par√°grafo estruturalmente novo.

                O par√°grafo deve desenvolver uma nova faceta do tema, ter 80-120 palavras e ser √∫nico.`;

            try {
                const content = await callPuterAI(prompt);
                articleContent[currentSection].push(content);
                displayABNTDocument();
                updateInteractiveUIState('developing_section'); // Permanece no estado de desenvolvimento
            } catch (error) {
                updateInteractiveUIState('developing_section');
            }
        });

        // --- BOT√ÉO: CONCLUIR SE√á√ÉO (FIM) ---
        elements.endSectionBtn.addEventListener('click', async () => {
            updateInteractiveUIState('loading');

            const fullSectionText = articleContent[currentSection].join(' ');
            const prompt = `Baseado no conte√∫do da se√ß√£o: "${fullSectionText}", escreva um par√°grafo de CONCLUS√ÉO para a se√ß√£o de "${sectionDisplayNames[currentSection]}". O par√°grafo deve resumir os pontos principais discutidos e fornecer uma transi√ß√£o suave para a pr√≥xima parte do artigo. Tamanho: 80-120 palavras.`;

            try {
                const content = await callPuterAI(prompt);
                articleContent[currentSection].push(content);
                displayABNTDocument();
                updateInteractiveUIState('section_concluded');
                
                // Prepara para a pr√≥xima etapa
                const currentIndex = sectionOrder.indexOf(currentSection);
                if (currentIndex < sectionOrder.length - 1) {
                    currentSection = sectionOrder[currentIndex + 1];
                    elements.currentSectionNameSpan.textContent = sectionDisplayNames[currentSection];
                    setTimeout(() => updateInteractiveUIState('ready_to_start_section'), 1000); // D√° tempo para o usu√°rio ler o status
                } else {
                    // Todas as se√ß√µes foram conclu√≠das
                    updateInteractiveUIState('article_finished');
                    // Aqui voc√™ pode chamar a fun√ß√£o para gerar resumo/abstract
                }
            } catch (error) {
                updateInteractiveUIState('developing_section');
            }
        });

        // --- BOT√ÉO FINAL ---
        elements.finishBtn.addEventListener('click', () => {
             alert(`üéâ Artigo finalizado! Agora voc√™ pode salv√°-lo como PDF.`);
             log(`üéì Artigo conclu√≠do! Salve seu trabalho.`, 'success');
        });

        // Fun√ß√£o para exibir o documento (simplificada)
        function displayABNTDocument() {
            let html = '';
            sectionOrder.forEach(key => {
                if (articleContent[key].length > 0) {
                    html += `<div class="section-title">${sectionDisplayNames[key]}</div>`;
                    articleContent[key].forEach(pText => {
                        html += `<p>${pText}</p>`;
                    });
                }
            });
            elements.outputDiv.innerHTML = html;
        }

        elements.savePdfBtn.addEventListener('click', () => window.print());

    </script>
</body>
</html>
