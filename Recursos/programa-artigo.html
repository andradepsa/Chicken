<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Gerador de Artigo Cient√≠fico com IA</title>
    <script src="https://js.puter.com/v2/"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Arial&display=swap');
        body { background-color: #e0e0e0; font-family: Arial, sans-serif; padding: 20px; }
        .main-container { display: flex; justify-content: center; align-items: flex-start; gap: 20px; }
        
        @page {
            size: A4;
            margin-top: 3cm; margin-bottom: 2cm; margin-left: 3cm; margin-right: 2cm;
            @bottom-center { content: element(footer); font-family: Arial, sans-serif; font-size: 10pt; color: #000; text-align: center; }
        }
        #footer { position: running(footer); font-family: Arial, sans-serif; font-size: 10pt; text-align: center; width: 100%; display: none; }

        @media print {
            body { background-color: #fff; padding: 0; margin: 0; }
            .control-panel, #save-controls { display: none !important; }
            .page-container { box-shadow: none; margin: 0; padding: 0; width: 100%; min-height: auto; border: none; }
            .email-autor { display: block !important; }
            #footer { display: block; }
        }
        
        .control-panel { position: sticky; top: 20px; width: 400px; background: #f9f9f9; padding: 20px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); z-index: 10; }
        .control-panel h2 { margin-top: 0; text-align: center; color: #333; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-group input, .form-group button { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: 14px; }
        .control-panel button { background-color: #1a73e8; color: white; font-weight: bold; cursor: pointer; border: none; }
        .control-panel button:hover:not(:disabled) { filter: brightness(90%); }
        .control-panel button:disabled { background-color: #999; cursor: not-allowed; }
        
        #interactive-controls button { margin-top: 10px; }
        #startSectionBtn { background-color: #1a73e8; } 
        #developSectionBtn { background-color: #28a745; }
        #endSectionBtn { background-color: #fd7e14; }
        #finishBtn { background-color: #dc3545; }

        #status { font-weight: bold; text-align: center; margin-top: 10px; min-height: 20px; font-size: 12px; padding: 10px; border-radius: 4px; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background-color: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        
        .page-container { width: 21cm; min-height: 29.7cm; padding: 3cm 2cm 2cm 3cm; background: white; box-shadow: 0 0 10px rgba(0,0,0,0.5); box-sizing: border-box; }
        
        /* --- ESTILOS ABNT RESTAURADOS --- */
        .abnt-content { font-family: Arial, sans-serif; font-size: 12pt; line-height: 1.5; text-align: justify; }
        .nome-universidade { text-align: center; font-size: 12pt; font-weight: bold; margin-bottom: 2em; }
        .titulo-trabalho { font-size: 14pt; text-align: center; font-weight: bold; text-transform: none; margin-bottom: 2em; }
        .autor { text-align: center; font-size: 12pt; margin-bottom: 4em; }
        .autor sup { font-size: 10pt; }
        .email-autor { text-align: left; font-size: 10pt; margin-top: 2em; border-top: 1px solid #000; padding-top: 10px; }
        .section-title { font-weight: bold; text-transform: uppercase; text-align: left; font-size: 12pt; margin-top: 2em; margin-bottom: 1em; }
        .abnt-content p { margin-bottom: 1.5em; text-indent: 1.25cm; }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="control-panel">
            <div id="initial-form">
                <h2>üéì Gerador de Artigo ABNT</h2>
                <div class="form-group"><label>Universidade:</label><input id="universidade" type="text" value="Universidade Federal"></div>
                <div class="form-group"><label>T√≠tulo do Trabalho:</label><input id="titulo" type="text" placeholder="Escreva um tema conciso"></div>
                <div class="form-group"><label>Autor(es):</label><input id="autor" type="text" placeholder="Nome Sobrenome"></div>
                <!-- CAMPO DE E-MAIL RESTAURADO -->
                <div class="form-group"><label>Email do Autor:</label><input id="email" type="email" value="seu.email@exemplo.com"></div>
                <button id="startBtn">üöÄ Iniciar Artigo</button>
            </div>
            
            <div id="interactive-controls" style="display: none;">
                <h2>üìù Escrevendo: <strong id="current-section-name"></strong></h2>
                <button id="startSectionBtn">‚ñ∂Ô∏è Iniciar Se√ß√£o</button>
                <button id="developSectionBtn">‚ûï Desenvolver Ideia</button>
                <button id="endSectionBtn">üèÅ Concluir Se√ß√£o</button>
                <button id="finishBtn" style="display: none;">‚úÖ Finalizar e Gerar Resumo</button>
            </div>

            <div id="save-controls" style="margin-top: 20px; border-top: 1px solid #ccc; padding-top: 15px;"><button id="savePdfBtn">üìÑ Salvar como PDF</button></div>
            <div id="status" class="info">üéØ Preencha os dados e clique em "Iniciar"</div>
        </div>
        
        <div class="page-container">
            <div class="abnt-content" id="content-output"><!-- Conte√∫do Gerado --></div>
            <div id="footer"></div>
        </div>
    </div>

    <script>
        const elements = {
            startBtn: document.getElementById('startBtn'),
            startSectionBtn: document.getElementById('startSectionBtn'),
            developSectionBtn: document.getElementById('developSectionBtn'),
            endSectionBtn: document.getElementById('endSectionBtn'),
            finishBtn: document.getElementById('finishBtn'),
            savePdfBtn: document.getElementById('savePdfBtn'),
            outputDiv: document.getElementById('content-output'),
            statusDiv: document.getElementById('status'),
            currentSectionNameSpan: document.getElementById('current-section-name'),
            initialForm: document.getElementById('initial-form'),
            interactiveControls: document.getElementById('interactive-controls'),
            footerDiv: document.getElementById('footer'),
        };

        let userInputs = {};
        let articleContent = { introducao: [], desenvolvimento: [], conclusao: [] };
        let currentSection = 'introducao';
        const sectionOrder = ['introducao', 'desenvolvimento', 'conclusao'];
        const sectionDisplayNames = { 'introducao': 'Introdu√ß√£o', 'desenvolvimento': 'Desenvolvimento', 'conclusao': 'Conclus√£o' };

        async function callPuterAI(prompt) {
            try {
                log('ü§ñ Gerando conte√∫do com a IA...', 'info');
                const response = await puter.ai.chat([{ role: 'user', content: prompt }]);
                if (!response || !response.message || !response.message.content) throw new Error('Resposta inv√°lida da IA.');
                return response.message.content.trim();
            } catch (error) {
                log(`‚ùå Erro na IA: ${error.message || 'Erro desconhecido.'}`, 'error');
                throw error;
            }
        }
        
        function log(message, type = 'info') {
            const icons = { success: '‚úÖ', error: '‚ùå', warning: '‚ö†Ô∏è', info: '‚ÑπÔ∏è' };
            elements.statusDiv.className = type;
            elements.statusDiv.innerHTML = `<div>${icons[type] || '‚ÑπÔ∏è'} ${message}</div>`;
        }

        function updateInteractiveUIState(state) {
            const { startSectionBtn, developSectionBtn, endSectionBtn } = elements;
            startSectionBtn.disabled = true;
            developSectionBtn.disabled = true;
            endSectionBtn.disabled = true;

            switch (state) {
                case 'ready_to_start_section':
                    startSectionBtn.disabled = false;
                    log(`Pronto para iniciar a se√ß√£o: ${sectionDisplayNames[currentSection]}`, 'info');
                    break;
                case 'developing_section':
                    developSectionBtn.disabled = false;
                    endSectionBtn.disabled = false;
                    log(`Desenvolvendo a se√ß√£o. Adicione par√°grafos ou conclua.`, 'info');
                    break;
                case 'article_finished':
                    elements.interactiveControls.style.display = 'none';
                    elements.finishBtn.style.display = 'block';
                    log('üéì Artigo conclu√≠do! Gere o resumo e salve em PDF.', 'success');
                    break;
                case 'loading':
                    log('Processando...', 'info');
                    break;
            }
        }

        elements.startBtn.addEventListener('click', () => {
            userInputs = {
                universidade: document.getElementById('universidade').value,
                titulo: document.getElementById('titulo').value,
                autor: document.getElementById('autor').value,
                // CAPTURA DO E-MAIL RESTAURADA
                email: document.getElementById('email').value,
            };
            if (!userInputs.titulo || !userInputs.autor) { log('‚ùå Preencha t√≠tulo e autor.', 'error'); return; }
            
            elements.initialForm.style.display = 'none';
            elements.interactiveControls.style.display = 'block';
            elements.currentSectionNameSpan.textContent = sectionDisplayNames[currentSection];
            elements.footerDiv.innerHTML = `${userInputs.universidade || 'Universidade'}, ${new Date().getFullYear()}`;
            displayABNTDocument(); // Exibe o cabe√ßalho inicial
            updateInteractiveUIState('ready_to_start_section');
        });

        // Prompts continuam aprimorados para qualidade e concis√£o
        elements.startSectionBtn.addEventListener('click', async () => {
            updateInteractiveUIState('loading');
            const prompt = `Escreva um par√°grafo INICIAL, claro e objetivo para a se√ß√£o de "${sectionDisplayNames[currentSection]}" de um artigo sobre "${userInputs.titulo}". O objetivo √© servir como um roteiro para o leitor, apresentando os pontos-chave que ser√£o discutidos nesta se√ß√£o sem rodeios. Seja conciso e informativo. Tamanho: 70-100 palavras.`;
            try {
                const content = await callPuterAI(prompt);
                articleContent[currentSection].push(content);
                displayABNTDocument();
                updateInteractiveUIState('developing_section');
            } catch (error) {
                updateInteractiveUIState('ready_to_start_section');
            }
        });

        elements.developSectionBtn.addEventListener('click', async () => {
            updateInteractiveUIState('loading');
            const lastTwoParagraphs = articleContent[currentSection].slice(-2).join(' ');
            const prompt = `Voc√™ √© um escritor acad√™mico focado em subst√¢ncia. Sua tarefa √© escrever o PR√ìXIMO par√°grafo para a se√ß√£o de "${sectionDisplayNames[currentSection]}" de um artigo sobre "${userInputs.titulo}". Contexto: "${lastTwoParagraphs}". INSTRU√á√ïES CR√çTICAS: 1. N√ÉO ENCHA LINGUI√áA. Adicione valor real (ideia nova, dado, exemplo). 2. EVITE REPETI√á√ÉO ESTRUTURAL. N√£o comece com "Al√©m de...". 3. SEJA DIRETO. O par√°grafo deve ser denso, significativo e ter entre 70-100 palavras.`;
            try {
                const content = await callPuterAI(prompt);
                articleContent[currentSection].push(content);
                displayABNTDocument();
                updateInteractiveUIState('developing_section');
            } catch (error) {
                updateInteractiveUIState('developing_section');
            }
        });

        elements.endSectionBtn.addEventListener('click', async () => {
            updateInteractiveUIState('loading');
            const fullSectionText = articleContent[currentSection].join(' ');
            const prompt = `Escreva um par√°grafo de CONCLUS√ÉO impactante e conciso para a se√ß√£o de "${sectionDisplayNames[currentSection]}", baseado neste conte√∫do: "${fullSectionText}". Sintetize as ideias-chave em uma nova formula√ß√£o que reforce a import√¢ncia do que foi discutido e finalize com uma transi√ß√£o clara. Tamanho: 70-100 palavras.`;
            try {
                const content = await callPuterAI(prompt);
                articleContent[currentSection].push(content);
                displayABNTDocument();
                const currentIndex = sectionOrder.indexOf(currentSection);
                if (currentIndex < sectionOrder.length - 1) {
                    currentSection = sectionOrder[currentIndex + 1];
                    elements.currentSectionNameSpan.textContent = sectionDisplayNames[currentSection];
                    updateInteractiveUIState('ready_to_start_section');
                } else {
                    updateInteractiveUIState('article_finished');
                }
            } catch (error) {
                updateInteractiveUIState('developing_section');
            }
        });

        elements.finishBtn.addEventListener('click', () => {
             alert(`Artigo finalizado! Agora voc√™ pode salv√°-lo como PDF.`);
             log(`üéì Artigo conclu√≠do! Salve seu trabalho.`, 'success');
        });

        function displayABNTDocument() {
            let html = `
                <div class="nome-universidade">${userInputs.universidade || ''}</div>
                <div class="titulo-trabalho">${userInputs.titulo || ''}</div>
                <div class="autor">${userInputs.autor || ''}<sup>1</sup></div>
            `;
            
            sectionOrder.forEach(key => {
                if (articleContent[key].length > 0) {
                    html += `<div class="section-title">${sectionDisplayNames[key]}</div>`;
                    articleContent[key].forEach(pText => {
                        html += `<p>${pText}</p>`;
                    });
                }
            });

            // GERA√á√ÉO DA NOTA DE RODAP√â RESTAURADA
            if (userInputs.email) {
                html += `<div class="email-autor"><sup>1</sup> ${userInputs.universidade || ''}, ${userInputs.email}</div>`;
            }

            elements.outputDiv.innerHTML = html;
        }

        elements.savePdfBtn.addEventListener('click', () => {
             alert('A caixa de di√°logo de impress√£o ser√° aberta.\n\nNo campo "Destino", escolha "Salvar como PDF".');
             window.print();
        });

    </script>
</body>
</html>
