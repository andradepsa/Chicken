<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Gerador de Artigo Cient√≠fico com IA</title>
    <script src="https://js.puter.com/v2/"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Arial&display=swap');
        body { background-color: #e0e0e0; font-family: Arial, sans-serif; padding: 20px; counter-reset: page; }
        .main-container { display: flex; justify-content: center; align-items: flex-start; gap: 20px; }
        @page { size: A4; margin: 3cm 2cm 2cm 3cm; }
        @media print { body { background-color: #fff; padding: 0; margin: 0; counter-reset: page 1; } .control-panel, .modal, #save-controls { display: none !important; } .page-container { box-shadow: none; margin: 0; page-break-after: always; } .email-autor { display: block !important; } .page-container:first-of-type .page-number { display: none; } }
        .control-panel { position: sticky; top: 20px; width: 400px; background: #f9f9f9; padding: 20px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); z-index: 10; }
        .control-panel h2 { margin-top: 0; text-align: center; color: #333; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        /* --- CSS ALTERADO para incluir o <select> --- */
        .form-group input, .form-group select, .form-group button { 
            width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: 14px; 
        }
        .control-panel button { background-color: #1a73e8; color: white; font-weight: bold; cursor: pointer; border: none; }
        .control-panel button:hover:not(:disabled) { filter: brightness(90%); }
        .control-panel button:disabled { background-color: #999; cursor: not-allowed; }
        #interactive-controls button { margin-top: 10px; }
        #startSectionBtn { background-color: #1a73e8; } 
        #developSectionBtn { background-color: #28a745; }
        #endSectionBtn { background-color: #fd7e14; }
        #finishBtn { background-color: #dc3545; }
        #status { font-weight: bold; text-align: center; margin-top: 10px; min-height: 20px; font-size: 12px; padding: 10px; border-radius: 4px; }
        .success, .error, .warning, .info { border: 1px solid; }
        .success { background-color: #d4edda; color: #155724; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border-color: #f5c6cb; }
        .warning { background-color: #fff3cd; color: #856404; border-color: #ffeaa7; }
        .info { background-color: #d1ecf1; color: #0c5460; border-color: #bee5eb; }
        
        .page-container { position: relative; width: 21cm; min-height: 29.7cm; padding: 3cm 2cm 2cm 3cm; background: white; box-shadow: 0 0 10px rgba(0,0,0,0.5); box-sizing: border-box; margin-bottom: 20px; }
        .page-number { position: absolute; top: 1cm; right: 0cm; font-family: Arial, sans-serif; font-size: 12pt; color: #000; }
        .page-number::after { counter-increment: page; content: counter(page); }
        
        .abnt-content { font-family: Arial, sans-serif; font-size: 12pt; line-height: 1.5; text-align: justify; }
        .nome-universidade, .titulo-trabalho, .autor { text-align: center; }
        .nome-universidade { font-size: 12pt; font-weight: bold; margin-bottom: 2em; }
        .titulo-trabalho { font-size: 14pt; font-weight: bold; text-transform: none; margin-bottom: 2em; }
        .autor { font-size: 12pt; margin-bottom: 4em; }
        .autor sup { font-size: 10pt; }
        .section-title { font-weight: bold; text-transform: uppercase; text-align: left; font-size: 12pt; margin-top: 2em; margin-bottom: 1em; }
        .abnt-content p { margin-bottom: 1.5em; text-indent: 1.25cm; }
        
        .email-autor { text-align: left; font-size: 10pt; line-height: 1.2; }
        .email-autor::before { content: ""; display: block; width: 5cm; margin-top: 2em; margin-bottom: 1em; border-top: 1px solid #000; }
        
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 100; justify-content: center; align-items: center; }
        .modal-content { background: white; padding: 20px; border-radius: 8px; width: 700px; max-height: 80vh; overflow-y: auto; }
        #topic-list label { cursor: pointer; display: block; padding: 5px; border-radius: 4px; }
        #topic-list input[type="radio"] { margin-right: 10px; }
        #topic-list div:hover { background-color: #f0f8ff; }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="control-panel">
            <div id="initial-form">
                <h2>üéì Gerador de Artigo ABNT</h2>
                <div class="form-group"><label for="universidade">Universidade:</label><input id="universidade" type="text" value="Universidade Federal"></div>
                <div class="form-group"><label for="titulo">T√≠tulo do Trabalho:</label><input id="titulo" type="text" placeholder="Escreva uma ideia ou tema"></div>
                <div class="form-group"><label for="autor">Autor(es):</label><input id="autor" type="text" placeholder="Nome Sobrenome"></div>
                
                <!-- =============== CAMPO ADICIONADO =============== -->
                <div class="form-group">
                    <label for="qualificacao">Qualifica√ß√£o:</label>
                    <select id="qualificacao">
                        <option value="graduando">Graduando(a)</option>
                        <option value="especializando">Especializando(a)</option>
                        <option value="mestrando">Mestrando(a)</option>
                        <option value="doutorando">Doutorando(a)</option>
                        <option value="professor">Professor(a)</option>
                        <option value="pesquisador">Pesquisador(a)</option>
                    </select>
                </div>
                <!-- ============================================== -->

                <div class="form-group"><label for="email">Email do Autor:</label><input id="email" type="email" value="seu.email@exemplo.com"></div>
                <button id="startBtn">üöÄ Iniciar e Otimizar Tema</button>
            </div>
            <div id="interactive-controls" style="display: none;">
                <h2>üìù Escrevendo: <strong id="current-section-name"></strong></h2>
                <button id="startSectionBtn">‚ñ∂Ô∏è Iniciar Se√ß√£o</button>
                <button id="developSectionBtn">‚ûï Desenvolver Ideia</button>
                <button id="endSectionBtn">üèÅ Concluir Se√ß√£o</button>
                <button id="finishBtn" style="display: none;">‚úÖ Finalizar e Gerar Resumo</button>
            </div>
            <div id="save-controls" style="margin-top: 20px; border-top: 1px solid #ccc; padding-top: 15px;"><button id="savePdfBtn">üìÑ Salvar como PDF</button></div>
            <div id="status" class="info">üéØ Preencha os dados e clique em "Iniciar"</div>
        </div>
        
        <div class="page-container">
            <div class="page-number"></div>
            <div class="abnt-content" id="content-output"></div>
        </div>
    </div>

    <div id="topic-suggestion-modal" class="modal">
        <div class="modal-content">
            <h3>‚ú® Sugest√µes para o seu Tema</h3>
            <p>Analisamos sua ideia. Escolha a melhor op√ß√£o abaixo para continuar:</p>
            <div id="topic-list" style="margin: 20px 0;"></div>
            <button id="confirm-topic-btn" style="background-color: #28a745;">‚úÖ Confirmar Tema e Iniciar</button>
        </div>
    </div>

    <script>
        const elements = {
            startBtn: document.getElementById('startBtn'), startSectionBtn: document.getElementById('startSectionBtn'), developSectionBtn: document.getElementById('developSectionBtn'), endSectionBtn: document.getElementById('endSectionBtn'), finishBtn: document.getElementById('finishBtn'), savePdfBtn: document.getElementById('savePdfBtn'), outputDiv: document.getElementById('content-output'), statusDiv: document.getElementById('status'), currentSectionNameSpan: document.getElementById('current-section-name'), initialForm: document.getElementById('initial-form'), interactiveControls: document.getElementById('interactive-controls'), topicSuggestionModal: document.getElementById('topic-suggestion-modal'), topicListDiv: document.getElementById('topic-list'), confirmTopicBtn: document.getElementById('confirm-topic-btn'),
        };
        let userInputs = {}; let articleContent = { introducao: [], desenvolvimento: [], conclusao: [] }; let currentSection = 'introducao'; const sectionOrder = ['introducao', 'desenvolvimento', 'conclusao']; const sectionDisplayNames = { 'introducao': 'Introdu√ß√£o', 'desenvolvimento': 'Desenvolvimento', 'conclusao': 'Conclus√£o' };
        async function callPuterAI(prompt) { try { log('ü§ñ Gerando conte√∫do com a IA...', 'info'); const response = await puter.ai.chat([{ role: 'user', content: prompt }]); if (!response || !response.message || !response.message.content) throw new Error('Resposta inv√°lida da IA.'); return response.message.content.trim(); } catch (error) { log(`‚ùå Erro na IA: ${error.message || 'Erro desconhecido.'}`, 'error'); throw error; } }
        function log(message, type = 'info') { const icons = { success: '‚úÖ', error: '‚ùå', warning: '‚ö†Ô∏è', info: '‚ÑπÔ∏è' }; elements.statusDiv.className = type; elements.statusDiv.innerHTML = `<div>${icons[type] || '‚ÑπÔ∏è'} ${message}</div>`; }
        function updateInteractiveUIState(state) { const { startSectionBtn, developSectionBtn, endSectionBtn } = elements; startSectionBtn.disabled = true; developSectionBtn.disabled = true; endSectionBtn.disabled = true; switch (state) { case 'ready_to_start_section': startSectionBtn.disabled = false; log(`Pronto para iniciar a se√ß√£o: ${sectionDisplayNames[currentSection]}`, 'info'); break; case 'developing_section': developSectionBtn.disabled = false; endSectionBtn.disabled = false; log(`Desenvolvendo a se√ß√£o. Adicione par√°grafos ou conclua.`, 'info'); break; case 'article_finished': elements.interactiveControls.style.display = 'none'; elements.finishBtn.style.display = 'block'; log('üéì Artigo conclu√≠do! Gere o resumo e salve em PDF.', 'success'); break; case 'loading': log('Processando...', 'info'); break; } }
        async function refineAndSuggestTopics(originalTitle) { log('Analisando tema...', 'info'); const prompt = `Analise o tema: "${originalTitle}". 1. corrected_title: Apenas corrija erros de gram√°tica/digita√ß√£o. MANTENHA A FORMULA√á√ÉO ORIGINAL. N√£o reescreva por estilo. 2. suggestions: Gere 9 temas alternativos, criativos e acad√™micos. Retorne APENAS JSON com as chaves "corrected_title" e "suggestions".`; try { const response = await callPuterAI(prompt); const jsonString = response.substring(response.indexOf('{'), response.lastIndexOf('}') + 1); return JSON.parse(jsonString); } catch (error) { log('‚ö†Ô∏è N√£o foi poss√≠vel gerar sugest√µes.', 'warning'); return { corrected_title: originalTitle, suggestions: [] }; } }
        function populateAndShowTopicModal(topicData, originalTitle) { let html = `<p style="background-color:#e8f4f8; padding:10px; border-radius:4px;"><strong>Sua Ideia Original:</strong> <em>${originalTitle}</em></p><div style="max-height: 300px; overflow-y: auto; border: 1px solid #ddd; padding: 10px;"><div><label><input type="radio" name="topic-choice" value="${topicData.corrected_title}" checked> <strong>${topicData.corrected_title} (Tema Corrigido)</strong></label></div>`; topicData.suggestions.forEach((suggestion) => { html += `<div><label><input type="radio" name="topic-choice" value="${suggestion}"> ${suggestion}</label></div>`; }); html += `</div>`; elements.topicListDiv.innerHTML = html; elements.topicSuggestionModal.style.display = 'flex'; }
        function proceedToWritingInterface() { elements.initialForm.style.display = 'none'; elements.interactiveControls.style.display = 'block'; elements.currentSectionNameSpan.textContent = sectionDisplayNames[currentSection]; displayABNTDocument(); updateInteractiveUIState('ready_to_start_section'); }
        
        elements.startBtn.addEventListener('click', async () => { 
            // *** ALTERA√á√ÉO 1: Capturar o novo campo de qualifica√ß√£o ***
            userInputs = { 
                universidade: document.getElementById('universidade').value, 
                titulo: document.getElementById('titulo').value, 
                autor: document.getElementById('autor').value, 
                qualificacao: document.getElementById('qualificacao').value, // NOVO
                email: document.getElementById('email').value, 
            }; 
            if (!userInputs.titulo || !userInputs.autor) { log('‚ùå Preencha t√≠tulo e autor.', 'error'); return; } 
            elements.startBtn.disabled = true; 
            try { const topicData = await refineAndSuggestTopics(userInputs.titulo); if (topicData && topicData.suggestions.length > 0) { populateAndShowTopicModal(topicData, userInputs.titulo); } else { proceedToWritingInterface(); } } catch (error) { proceedToWritingInterface(); } 
        });

        elements.confirmTopicBtn.addEventListener('click', () => { const selectedTopic = document.querySelector('input[name="topic-choice"]:checked').value; userInputs.titulo = selectedTopic; document.getElementById('titulo').value = selectedTopic; elements.topicSuggestionModal.style.display = 'none'; log(`‚úÖ Tema selecionado: "${selectedTopic}"`, 'success'); proceedToWritingInterface(); });
        elements.startSectionBtn.addEventListener('click', async () => { updateInteractiveUIState('loading'); const prompt = `Escreva um par√°grafo INICIAL, claro e objetivo para a se√ß√£o de "${sectionDisplayNames[currentSection]}" de um artigo sobre "${userInputs.titulo}". Objetivo: servir como roteiro para o leitor, apresentando os pontos-chave da se√ß√£o sem rodeios. Tamanho: 70-100 palavras.`; try { const content = await callPuterAI(prompt); articleContent[currentSection].push(content); displayABNTDocument(); updateInteractiveUIState('developing_section'); } catch (error) { updateInteractiveUIState('ready_to_start_section'); } });
        elements.developSectionBtn.addEventListener('click', async () => { updateInteractiveUIState('loading'); const lastTwoParagraphs = articleContent[currentSection].slice(-2).join(' '); const prompt = `Voc√™ √© um escritor acad√™mico focado em subst√¢ncia. Escreva o PR√ìXIMO par√°grafo para a se√ß√£o de "${sectionDisplayNames[currentSection]}" sobre "${userInputs.titulo}". Contexto: "${lastTwoParagraphs}". INSTRU√á√ïES CR√çTICAS: 1. N√ÉO ENCHA LINGUI√áA (adicione valor real: ideia nova, dado, exemplo). 2. EVITE REPETI√á√ÉO ESTRUTURAL (n√£o comece com "Al√©m de..."). 3. SEJA DIRETO. Tamanho: 70-100 palavras.`; try { const content = await callPuterAI(prompt); articleContent[currentSection].push(content); displayABNTDocument(); updateInteractiveUIState('developing_section'); } catch (error) { updateInteractiveUIState('developing_section'); } });
        elements.endSectionBtn.addEventListener('click', async () => { updateInteractiveUIState('loading'); const fullSectionText = articleContent[currentSection].join(' '); const prompt = `Escreva um par√°grafo de CONCLUS√ÉO impactante e conciso para a se√ß√£o de "${sectionDisplayNames[currentSection]}", baseado em: "${fullSectionText}". Sintetize as ideias-chave em uma nova formula√ß√£o que reforce a import√¢ncia do discutido. Tamanho: 70-100 palavras.`; try { const content = await callPuterAI(prompt); articleContent[currentSection].push(content); displayABNTDocument(); const currentIndex = sectionOrder.indexOf(currentSection); if (currentIndex < sectionOrder.length - 1) { currentSection = sectionOrder[currentIndex + 1]; elements.currentSectionNameSpan.textContent = sectionDisplayNames[currentSection]; updateInteractiveUIState('ready_to_start_section'); } else { updateInteractiveUIState('article_finished'); } } catch (error) { updateInteractiveUIState('developing_section'); } });
        elements.finishBtn.addEventListener('click', () => { alert(`Artigo finalizado!`); log(`üéì Artigo conclu√≠do!`, 'success'); });
        elements.savePdfBtn.addEventListener('click', () => { alert('A caixa de di√°logo de impress√£o ser√° aberta.\n\nNo campo "Destino", escolha "Salvar como PDF".'); window.print(); });

        function displayABNTDocument() {
            let html = `<div class="nome-universidade">${userInputs.universidade || ''}</div>
                        <div class="titulo-trabalho">${userInputs.titulo || ''}</div>
                        <div class="autor">${userInputs.autor || ''}<sup>1</sup></div>`;

            let sectionCounter = 1; 

            sectionOrder.forEach(key => {
                if (articleContent[key].length > 0) {
                    html += `<div class="section-title">${sectionCounter} ${sectionDisplayNames[key].toUpperCase()}</div>`;
                    articleContent[key].forEach(pText => html += `<p>${pText}</p>`);
                    sectionCounter++;
                }
            });

            // *** ALTERA√á√ÉO 2: Usar a qualifica√ß√£o selecionada na nota de rodap√© ***
            if (userInputs.email && userInputs.qualificacao) {
                const selectElement = document.getElementById('qualificacao');
                const qualificacaoTexto = selectElement.options[selectElement.selectedIndex].text; // Pega o texto vis√≠vel da op√ß√£o (ex: "Mestrando(a)")
                
                html += `<div class="email-autor"><sup>1</sup>${qualificacaoTexto}. Institui√ß√£o: ${userInputs.universidade || ''}. E-mail: ${userInputs.email}</div>`;
            }

            elements.outputDiv.innerHTML = html;
        }
    </script>
</body>
</html>
