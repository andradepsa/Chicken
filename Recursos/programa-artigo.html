<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Gerador de Artigo Cient√≠fico com IA</title>
    <script src="https://js.puter.com/v2/"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Arial&display=swap');
        body { background-color: #e0e0e0; font-family: Arial, sans-serif; padding: 20px; }
        .main-container { display: flex; justify-content: center; align-items: flex-start; gap: 20px; }
        
        /* Estilos de impress√£o e p√°gina ABNT */
        @page {
            size: A4;
            margin: 3cm 2cm 2cm 3cm;
        }
        @media print {
            body { background-color: #fff; padding: 0; margin: 0; }
            .control-panel, .modal, #save-controls { display: none !important; }
            .page-container { box-shadow: none; margin: 0; padding: 0; width: 100%; min-height: auto; border: none; }
            /* A nota de rodap√© com e-mail n√£o aparece na impress√£o final, conforme padr√£o */
            .email-autor { display: none !important; }
        }
        
        .control-panel { position: sticky; top: 20px; width: 400px; background: #f9f9f9; padding: 20px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); z-index: 10; }
        .control-panel h2 { margin-top: 0; text-align: center; color: #333; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        /* CSS ATUALIZADO para incluir o <select> */
        .form-group input, .form-group select, .form-group button { 
            width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: 14px; 
        }
        .control-panel button { background-color: #1a73e8; color: white; font-weight: bold; cursor: pointer; border:none; }
        .control-panel button:hover:not(:disabled) { filter: brightness(90%); }
        .control-panel button:disabled { background-color: #999; cursor: not-allowed; }
        #interactive-controls button { margin-top: 10px; }
        #continueBtn { background-color: #28a745; }
        #concludeBtn { background-color: #fd7e14; }
        #finalizeBtn { background-color: #ffc107; color: black; }
        #finishBtn { background-color: #dc3545; }

        #status { font-weight: bold; text-align: center; margin-top: 10px; min-height: 20px; font-size: 12px; padding: 10px; border-radius: 4px; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background-color: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        
        .page-container { width: 21cm; min-height: 29.7cm; padding: 3cm 2cm 2cm 3cm; background: white; box-shadow: 0 0 10px rgba(0,0,0,0.5); box-sizing: border-box; }
        
        .abnt-content { font-family: Arial, sans-serif; font-size: 12pt; line-height: 1.5; text-align: justify; }
        .nome-universidade { text-align: center; font-size: 12pt; font-weight: bold; margin-bottom: 2em; }
        .titulo-trabalho { font-size: 14pt; text-align: center; font-weight: bold; text-transform: none; margin-bottom: 2em; }
        .autor { text-align: center; font-size: 12pt; margin-bottom: 4em; }
        .autor sup { font-size: 10pt; }
        .resumo-titulo { font-weight: bold; text-align: center; font-size: 12pt; margin-top: 2em; margin-bottom: 1em; text-transform: uppercase; }
        .resumo-texto { text-align: justify; margin-bottom: 1em; }
        .palavras-chave { text-align: left; margin-bottom: 2em; }
        .palavras-chave strong { font-weight: bold; }
        .abstract-titulo { font-weight: bold; font-style: italic; text-align: center; font-size: 12pt; margin-top: 1em; margin-bottom: 1em; text-transform: uppercase; }
        .keywords { text-align: left; margin-bottom: 2em; }
        .keywords strong { font-weight: bold; font-style: italic; }
        .section-title { font-weight: bold; text-transform: uppercase; text-align: left; font-size: 12pt; margin-top: 2em; margin-bottom: 1em; }
        .abnt-content p { margin-bottom: 1.5em; cursor: pointer; text-indent: 1.25cm; }
        .abnt-content p:hover { background-color: #f0f8ff; }

        /* Estilo da nota de rodap√© */
        .email-autor { text-align: left; font-size: 10pt; line-height: 1.2; }
        .email-autor::before { content: ""; display: block; width: 5cm; margin-top: 2em; margin-bottom: 1em; border-top: 1px solid #000; }
        
        /* Estilos dos Modais (Cita√ß√£o e Sugest√£o de Tema) */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 100; justify-content: center; align-items: center; }
        .modal-content { background: white; padding: 20px; border-radius: 8px; width: 700px; max-height: 80vh; overflow-y: auto; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        .modal-content h3 { margin-top: 0; }
        .modal-content ul { list-style: none; padding: 0; }
        .modal-content li { margin-bottom: 15px; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        .modal-content li label { cursor: pointer; font-size: 14px; line-height: 1.4; }
        .modal-content button { margin-top: 10px; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; margin-right: 10px; }
        .modal-content .close-btn { background: #dc3545; color: white; }
        #add-references-btn, #confirm-topic-btn { background: #28a745; color: white; }
        .search-info { background: #e8f4f8; padding: 10px; border-radius: 4px; margin-bottom: 15px; font-size: 13px; }
        .citation-example { background: #e7f3ff; padding: 10px; border-radius: 4px; margin-bottom: 15px; font-size: 12px; }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="control-panel">
            <div id="initial-form">
                <h2>üéì Gerador de Artigo ABNT</h2>
                <div class="form-group"><label for="universidade">Universidade:</label><input id="universidade" type="text" value="Universidade Federal"></div>
                <div class="form-group"><label for="titulo">T√≠tulo do Trabalho:</label><input id="titulo" type="text" placeholder="Escreva uma ideia ou tema"></div>
                <div class="form-group"><label for="autor">Autor(es):</label><input id="autor" type="text" placeholder="Nome Sobrenome"></div>
                
                <!-- =============== CAMPO DE QUALIFICA√á√ÉO ADICIONADO =============== -->
                <div class="form-group">
                    <label for="qualificacao">Qualifica√ß√£o:</label>
                    <select id="qualificacao">
                        <option value="graduando">Graduando(a)</option>
                        <option value="especializando">Especializando(a)</option>
                        <option value="mestrando">Mestrando(a)</option>
                        <option value="doutorando">Doutorando(a)</option>
                        <option value="professor">Professor(a)</option>
                        <option value="pesquisador">Pesquisador(a)</option>
                    </select>
                </div>
                <!-- ================================================================ -->

                <div class="form-group"><label for="email">Email do Autor:</label><input id="email" type="email" value="seu.email@exemplo.com"></div>
                <button id="startBtn">üöÄ Iniciar e Otimizar Tema</button>
            </div>
            
            <div id="interactive-controls" style="display: none;">
                <h2>üìù Modo Interativo</h2>
                <p>Trabalhando em: <strong id="current-section-name"></strong></p>
                <button id="continueBtn">‚ûï Adicionar Par√°grafo</button>
                <button id="concludeBtn">üîö Finalizar Se√ß√£o</button>
                <button id="finalizeBtn">‚è≠ Pr√≥xima Se√ß√£o</button>
                <button id="finishBtn" style="display: none;">‚úÖ Finalizar Artigo</button>
            </div>

            <div id="save-controls" style="margin-top: 20px; border-top: 1px solid #ccc; padding-top: 15px;">
                <button id="savePdfBtn">üìÑ Salvar como PDF</button>
            </div>

            <div id="status" class="info">üéØ Preencha os dados e clique em "Iniciar"</div>
        </div>
        
        <div class="page-container">
            <div class="abnt-content" id="content-output"></div>
        </div>
        
        <div id="reference-modal" class="modal">
            <div class="modal-content">
                <h3>üìö Adicionar Refer√™ncias</h3>
                <div class="citation-example"><strong>üìñ Exemplo de cita√ß√£o:</strong> "...avan√ßo cient√≠fico (SILVA, 2023)."</div>
                <div id="search-info" class="search-info" style="display: none;"></div>
                <p>Selecione as refer√™ncias para adicionar ao par√°grafo:</p>
                <ul id="reference-list"></ul>
                <button id="add-references-btn">‚úÖ Adicionar</button>
                <button class="close-btn" id="close-modal-btn">‚ùå Fechar</button>
            </div>
        </div>

        <div id="topic-suggestion-modal" class="modal">
            <div class="modal-content">
                <h3>‚ú® Sugest√µes para o seu Tema</h3>
                <p>Analisamos seu tema. Escolha a melhor op√ß√£o abaixo:</p>
                <div id="topic-list" style="margin: 20px 0;"></div>
                <button id="confirm-topic-btn">‚úÖ Confirmar Tema e Iniciar</button>
            </div>
        </div>
    </div>

    <script>
        // --- ELEMENTOS DA UI (COMPLETO) ---
        const elements = {
            startBtn: document.getElementById('startBtn'),
            continueBtn: document.getElementById('continueBtn'),
            concludeBtn: document.getElementById('concludeBtn'),
            finalizeBtn: document.getElementById('finalizeBtn'),
            finishBtn: document.getElementById('finishBtn'),
            outputDiv: document.getElementById('content-output'),
            statusDiv: document.getElementById('status'),
            currentSectionNameSpan: document.getElementById('current-section-name'),
            referenceModal: document.getElementById('reference-modal'),
            referenceList: document.getElementById('reference-list'),
            addReferencesBtn: document.getElementById('add-references-btn'),
            closeModalBtn: document.getElementById('close-modal-btn'),
            searchInfoDiv: document.getElementById('search-info'),
            savePdfBtn: document.getElementById('savePdfBtn'),
            topicSuggestionModal: document.getElementById('topic-suggestion-modal'),
            topicListDiv: document.getElementById('topic-list'),
            confirmTopicBtn: document.getElementById('confirm-topic-btn'),
        };

        // --- ESTADO DA APLICA√á√ÉO (COMPLETO) ---
        let userInputs = {};
        let articleContent = { introducao: [], desenvolvimento: [], conclusao: [] };
        let finalReferences = []; 
        let currentParagraphId = null;
        let currentSection = 'introducao';
        const sectionOrder = ['introducao', 'desenvolvimento', 'conclusao'];
        let currentModalReferences = [];

        // --- FUN√á√ÉO AUXILIAR DE FORMATA√á√ÉO (ADICIONADA) ---
        function toProperCase(str) {
            if (!str) return '';
            return str.trim().toLowerCase().split(' ').map(word => 
                word.charAt(0).toUpperCase() + word.slice(1)
            ).join(' ');
        }
        
        // --- FUN√á√ïES DE IA E FEEDBACK (PRESERVADAS) ---
        async function callPuterAI(prompt) { try { log('ü§ñ Gerando conte√∫do...', 'info'); const response = await puter.ai.chat([{ role: 'user', content: prompt }]); if (!response || !response.message || !response.message.content) throw new Error('Resposta inv√°lida da IA.'); return response.message.content.trim(); } catch (error) { log(`‚ùå Erro na IA: ${error.message || 'Erro.'}`, 'error'); throw error; } }
        function log(message, type = 'info') { const icons = { success: '‚úÖ', error: '‚ùå', warning: '‚ö†Ô∏è', info: '‚ÑπÔ∏è' }; elements.statusDiv.className = type; elements.statusDiv.innerHTML = `<div>${icons[type] || '‚ÑπÔ∏è'} ${message}</div>`; }
        async function refineAndSuggestTopics(originalTitle) { log('Analisando tema...', 'info'); const prompt = `Analise o tema: "${originalTitle}". 1. corrected_title: Corrija gram√°tica/digita√ß√£o. 2. suggestions: Gere 9 temas alternativos. Retorne APENAS JSON com as chaves "corrected_title" e "suggestions".`; try { const response = await callPuterAI(prompt); const jsonString = response.substring(response.indexOf('{'), response.lastIndexOf('}') + 1); return JSON.parse(jsonString); } catch (error) { return { corrected_title: originalTitle, suggestions: [] }; } }
        function populateAndShowTopicModal(topicData, originalTitle) { let html = `<p style="background-color:#e8f4f8; padding:10px; border-radius:4px;"><strong>Sua Ideia:</strong> <em>${originalTitle}</em></p><div style="max-height: 300px; overflow-y: auto; border: 1px solid #ddd; padding: 10px;"><div><label><input type="radio" name="topic-choice" value="${topicData.corrected_title}" checked> <strong>${topicData.corrected_title} (Corrigido)</strong></label></div>`; topicData.suggestions.forEach((suggestion) => { html += `<div><label><input type="radio" name="topic-choice" value="${suggestion}"> ${suggestion}</label></div>`; }); html += `</div>`; elements.topicListDiv.innerHTML = html; elements.topicSuggestionModal.style.display = 'flex'; }

        // --- L√ìGICA DE REFER√äNCIAS (PRESERVADA) ---
        function extractRelevantTerms(text, title = '') { const stopwords = ['a', 'o', 'de', 'da', 'do', 'e', 'em', 'para', 'com', 'um', 'uma', 'que', 'se', 'por', 'como']; const words = `${title} ${text}`.toLowerCase().replace(/[^\w\s√°√©√≠√≥√∫√¢√™√Æ√¥√ª√ß]/g, ' ').split(/\s+/).filter(w => w.length > 3 && !stopwords.includes(w)); return [...new Set(words)].slice(0, 5); }
        async function fetchParagraphReferences(paragraphText, articleTitle) { log('Buscando refer√™ncias...', 'info'); try { const query = extractRelevantTerms(paragraphText, articleTitle).join(' '); elements.searchInfoDiv.innerHTML = `<strong>üîç Buscando por:</strong> <em>${query}</em>`; elements.searchInfoDiv.style.display = 'block'; const url = `https://api.semanticscholar.org/graph/v1/paper/search?query=${encodeURIComponent(query)}&limit=10&fields=title,authors,year,url`; const response = await fetch(url, { signal: AbortSignal.timeout(10000) }); const data = await response.json(); const papers = (data.data || []).filter(p => p.title && p.authors && p.authors.length > 0 && p.year); log(`${papers.length} refer√™ncias encontradas!`, 'success'); return papers.map(p => ({ id: p.paperId, title: p.title, authors: p.authors.map(a => a.name), year: p.year, url: p.url })); } catch (error) { log('‚ö†Ô∏è Erro ao buscar refer√™ncias.', 'error'); return []; } }
        async function openReferenceModal(paragraphId, paragraphText, articleTitle) { currentParagraphId = paragraphId; elements.referenceList.innerHTML = '<p>Buscando...</p>'; elements.addReferencesBtn.disabled = true; elements.referenceModal.style.display = 'flex'; const references = await fetchParagraphReferences(paragraphText, articleTitle); currentModalReferences = references; if (references.length > 0) { elements.referenceList.innerHTML = references.map((ref, index) => { const isUsed = finalReferences.some(e => e.id === ref.id); return `<li style="${isUsed ? 'background-color:#f0f0f0;':''}"> <input type="checkbox" id="ref-${index}" value="${index}"> <label for="ref-${index}"><strong>${ref.authors[0].split(' ').pop()} (${ref.year})</strong> - <em>${ref.title}</em> ${isUsed ? '[J√Å USADA]':''}</label></li>`; }).join(''); elements.addReferencesBtn.disabled = false; } else { elements.referenceList.innerHTML = '<p>Nenhuma refer√™ncia encontrada.</p>'; } }
        function addSelectedReferences() { const selectedIndices = Array.from(document.querySelectorAll('#reference-list input:checked')).map(i => parseInt(i.value)); if (selectedIndices.length === 0) return; const paragraphElement = document.querySelector(`p[data-id="${currentParagraphId}"]`); const originalText = articleContent[currentParagraphId.split('-')[0]][parseInt(currentParagraphId.split('-')[1])]; const selectedRefs = selectedIndices.map(index => currentModalReferences[index]); const citations = selectedRefs.map(ref => `${ref.authors[0].split(' ').pop().toUpperCase()}, ${ref.year}`); const cleanText = originalText.replace(/\s*\([A-Z√Ä-√ô\s,]+\d{4}\)\.?$/g, '').trim(); paragraphElement.textContent = `${cleanText} (${citations.join('; ')}).`; const [sectionKey, index] = currentParagraphId.split('-'); articleContent[sectionKey][parseInt(index)] = paragraphElement.textContent; selectedRefs.forEach(ref => { if (!finalReferences.some(e => e.id === ref.id)) finalReferences.push(ref); }); displayABNTDocument(); elements.referenceModal.style.display = 'none'; log(`‚úÖ Refer√™ncia(s) adicionada(s)!`, 'success'); }
        function formatarReferenciasABNT() { const sorted = [...finalReferences].sort((a, b) => a.authors[0].split(' ').pop().localeCompare(b.authors[0].split(' ').pop())); return sorted.map(ref => { const authors = ref.authors.map(author => { const names = author.split(' '); return `${names.pop().toUpperCase()}, ${names.join(' ')}`; }); return `${authors.join('; ')}. <strong>${ref.title}</strong>. ${ref.year}. Dispon√≠vel em: <${ref.url}>.`; }).join('<br><br>'); }

        // --- GERA√á√ÉO DE RESUMO E ABSTRACT (PRESERVADA) ---
        async function generateResumoAndAbstract() { try { log('Gerando resumo...', 'info'); const allContent = Object.values(articleContent).flat().join(' '); const resumoPrompt = `Baseado no artigo "${userInputs.titulo}" com o conte√∫do "${allContent}", escreva um resumo ABNT de 150-250 palavras.`; userInputs.resumo = await callPuterAI(resumoPrompt); const palavrasPrompt = `Extraia 5 palavras-chave do resumo: "${userInputs.resumo}". Responda apenas com as palavras separadas por ponto final.`; userInputs.palavrasChave = await callPuterAI(palavrasPrompt); const abstractPrompt = `Traduza para o ingl√™s o resumo: "${userInputs.resumo}"`; userInputs.abstract = await callPuterAI(abstractPrompt); const keywordsPrompt = `Traduza para o ingl√™s as palavras-chave: "${userInputs.palavrasChave}"`; userInputs.keywords = await callPuterAI(keywordsPrompt); log('‚úÖ Resumo e abstract gerados!', 'success'); } catch (error) { log('‚ö†Ô∏è Erro ao gerar resumo.', 'warning'); } }

        // --- FUN√á√ÉO DE EXIBI√á√ÉO (ATUALIZADA) ---
        function displayABNTDocument() {
            let content = `<div class="nome-universidade">${userInputs.universidade || ''}</div><div class="titulo-trabalho">${userInputs.titulo || ''}</div><div class="autor">${userInputs.autor || ''}<sup>1</sup></div>`;
            if (userInputs.resumo) { content += `<div class="resumo-titulo">Resumo</div><div class="resumo-texto">${userInputs.resumo}</div><div class="palavras-chave"><strong>Palavras-chave:</strong> ${userInputs.palavrasChave}</div>`; }
            if (userInputs.abstract) { content += `<div class="abstract-titulo">Abstract</div><div class="resumo-texto">${userInputs.abstract}</div><div class="keywords"><strong>Keywords:</strong> ${userInputs.keywords}</div>`; }
            
            let sectionCounter = 1;
            const sectionNames = { introducao: 'INTRODU√á√ÉO', desenvolvimento: 'DESENVOLVIMENTO', conclusao: 'CONCLUS√ÉO' };
            sectionOrder.forEach(key => {
                if (articleContent[key].length > 0) {
                    content += `<div class="section-title">${sectionCounter} ${sectionNames[key]}</div>`;
                    articleContent[key].forEach((text, index) => { content += `<p data-id="${key}-${index}" title="Clique para adicionar refer√™ncias">${text}</p>`; });
                    sectionCounter++;
                }
            });

            if (finalReferences.length > 0) { content += `<div class="section-title">REFER√äNCIAS</div><div style="font-size:12pt; text-align:left;">${formatarReferenciasABNT()}</div>`; }
            
            // --- NOTA DE RODAP√â ATUALIZADA DINAMICAMENTE ---
            if (userInputs.email && userInputs.qualificacao) {
                const selectElement = document.getElementById('qualificacao');
                const qualificacaoTexto = selectElement.options[selectElement.selectedIndex].text;
                content += `<div class="email-autor"><sup>1</sup>${qualificacaoTexto}. Institui√ß√£o: ${userInputs.universidade}. E-mail: ${userInputs.email}</div>`;
            }

            elements.outputDiv.innerHTML = content;
        }
        
        // --- EVENTOS E CONTROLE DE FLUXO (IN√çCIO ATUALIZADO) ---
        async function proceedToWriting() { document.getElementById('initial-form').style.display = 'none'; document.getElementById('interactive-controls').style.display = 'block'; elements.currentSectionNameSpan.textContent = 'Introdu√ß√£o'; log('‚úÖ Artigo iniciado! Adicione o primeiro par√°grafo.', 'success'); }
        
        elements.startBtn.addEventListener('click', async () => {
            // --- L√ìGICA DE CORRE√á√ÉO AUTOM√ÅTICA ADICIONADA AQUI ---
            const universidadeInput = document.getElementById('universidade');
            const autorInput = document.getElementById('autor');
            const emailInput = document.getElementById('email');

            const correctedUniversidade = toProperCase(universidadeInput.value);
            const correctedAutor = toProperCase(autorInput.value);
            const correctedEmail = emailInput.value.trim().toLowerCase();

            universidadeInput.value = correctedUniversidade;
            autorInput.value = correctedAutor;
            emailInput.value = correctedEmail;

            userInputs = { 
                universidade: correctedUniversidade,
                titulo: document.getElementById('titulo').value.trim(), 
                autor: correctedAutor,
                qualificacao: document.getElementById('qualificacao').value, 
                email: correctedEmail, 
            }; 
            // --- FIM DA L√ìGICA DE CORRE√á√ÉO ---

            if (!userInputs.titulo || !userInputs.autor) { log('‚ùå Preencha t√≠tulo e autor.', 'error'); return; }
            elements.startBtn.disabled = true;
            const topicData = await refineAndSuggestTopics(userInputs.titulo);
            if (topicData.suggestions.length > 0) { populateAndShowTopicModal(topicData, userInputs.titulo); } 
            else { proceedToWriting(); }
        });

        elements.confirmTopicBtn.addEventListener('click', () => { userInputs.titulo = document.querySelector('input[name="topic-choice"]:checked').value; document.getElementById('titulo').value = userInputs.titulo; elements.topicSuggestionModal.style.display = 'none'; log(`‚úÖ Tema selecionado!`, 'success'); proceedToWriting(); });

        // --- RESTANTE DOS EVENTOS (PRESERVADOS) ---
        async function handleSectionGeneration(type) { const btn = type === 'continue' ? elements.continueBtn : elements.concludeBtn; btn.disabled = true; const sectionName = { 'introducao': 'introdu√ß√£o', 'desenvolvimento': 'desenvolvimento', 'conclusao': 'conclus√£o' }[currentSection]; const fullText = Object.values(articleContent).flat().join(' '); const action = type === 'continue' ? 'o PR√ìXIMO par√°grafo' : 'um par√°grafo de FINALIZA√á√ÉO'; const instruction = type === 'continue' ? 'N√ÉO REPITA ideias.' : 'Sintetize as ideias da se√ß√£o.'; const prompt = `Artigo: "${userInputs.titulo}". Conte√∫do: "${fullText}". Escreva ${action} para a se√ß√£o de "${sectionName}". ${instruction}`; try { const content = await callPuterAI(prompt); articleContent[currentSection].push(content); displayABNTDocument(); } finally { btn.disabled = false; } }
        elements.continueBtn.addEventListener('click', () => handleSectionGeneration('continue'));
        elements.concludeBtn.addEventListener('click', () => handleSectionGeneration('conclude'));
        elements.finalizeBtn.addEventListener('click', async () => { const currentIndex = sectionOrder.indexOf(currentSection); if (currentIndex < sectionOrder.length - 1) { currentSection = sectionOrder[currentIndex + 1]; const sectionDisplayName = { 'desenvolvimento': 'Desenvolvimento', 'conclusao': 'Conclus√£o' }[currentSection]; elements.currentSectionNameSpan.textContent = sectionDisplayName; log(`‚úÖ Se√ß√£o '${sectionDisplayName}' iniciada!`, 'success'); } else { elements.finalizeBtn.style.display = 'none'; await generateResumoAndAbstract(); displayABNTDocument(); elements.finishBtn.style.display = 'block'; } });
        elements.finishBtn.addEventListener('click', () => { alert(`Artigo finalizado!`); log(`üéì Artigo conclu√≠do!`, 'success'); });
        elements.outputDiv.addEventListener('click', (e) => { const p = e.target.closest('p[data-id]'); if (p) { const text = p.textContent.replace(/\s*\([A-Z√Ä-√ô\s,]+\d{4}\)\.?$/g, '').trim(); openReferenceModal(p.dataset.id, text, userInputs.titulo); } });
        elements.addReferencesBtn.addEventListener('click', addSelectedReferences);
        elements.closeModalBtn.addEventListener('click', () => { elements.referenceModal.style.display = 'none'; });
        elements.savePdfBtn.addEventListener('click', () => { alert('No campo "Destino", escolha "Salvar como PDF".'); window.print(); });
        
        log('üéØ Preencha os dados e clique em "Iniciar"', 'info');
    </script>
</body>
</html>
